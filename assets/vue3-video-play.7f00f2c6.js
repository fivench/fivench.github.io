import{i as Oe,o as Q,c as J,I as Ie,J as we,u as j,at as Pe,au as Fe,T as Te,G as je,a as V,av as it,d as ke,f as Et,P as fe,Q as he,U as se,S as de,_ as Ye,e as dt,h as ut,B as ct,V as te,O as $e,W as et,F as ze,a4 as Xe,X as Tt,K as bt,M as St,a6 as He,n as ft,Z as At}from"./@vue.401191f6.js";var Lt=Object.defineProperty,kt=Object.defineProperties,Dt=Object.getOwnPropertyDescriptors,at=Object.getOwnPropertySymbols,Rt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable,nt=(N,w,h)=>w in N?Lt(N,w,{enumerable:!0,configurable:!0,writable:!0,value:h}):N[w]=h,tt=(N,w)=>{for(var h in w||(w={}))Rt.call(w,h)&&nt(N,h,w[h]);if(at)for(var h of at(w))_t.call(w,h)&&nt(N,h,w[h]);return N},rt=(N,w)=>kt(N,Dt(w));function st(N,w,h,_){var T,L=!1,R=0;function x(){T&&clearTimeout(T)}function D(){for(var o=arguments.length,A=new Array(o),m=0;m<o;m++)A[m]=arguments[m];var f=this,E=Date.now()-R;function y(){R=Date.now(),h.apply(f,A)}function u(){T=void 0}L||(_&&!T&&y(),x(),_===void 0&&E>N?y():w!==!0&&(T=setTimeout(_?u:y,_===void 0?N-E:N)))}return typeof w!="boolean"&&(_=h,h=w,w=void 0),D.cancel=function(){x(),L=!0},D}function ot(N,w,h){return h===void 0?st(N,w,!1):st(N,h,w!==!1)}function xt(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var ht={exports:{}};typeof window!="undefined"&&(ht.exports=function(N){var w={};function h(_){if(w[_])return w[_].exports;var T=w[_]={i:_,l:!1,exports:{}};return N[_].call(T.exports,T,T.exports,h),T.l=!0,T.exports}return h.m=N,h.c=w,h.d=function(_,T,L){h.o(_,T)||Object.defineProperty(_,T,{enumerable:!0,get:L})},h.r=function(_){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},h.t=function(_,T){if(1&T&&(_=h(_)),8&T||4&T&&typeof _=="object"&&_&&_.__esModule)return _;var L=Object.create(null);if(h.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:_}),2&T&&typeof _!="string")for(var R in _)h.d(L,R,function(x){return _[x]}.bind(null,R));return L},h.n=function(_){var T=_&&_.__esModule?function(){return _.default}:function(){return _};return h.d(T,"a",T),T},h.o=function(_,T){return Object.prototype.hasOwnProperty.call(_,T)},h.p="/dist/",h(h.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(N,w,h){var _=Object.prototype.hasOwnProperty,T="~";function L(){}function R(A,m,f){this.fn=A,this.context=m,this.once=f||!1}function x(A,m,f,E,y){if(typeof f!="function")throw new TypeError("The listener must be a function");var u=new R(f,E||A,y),e=T?T+m:m;return A._events[e]?A._events[e].fn?A._events[e]=[A._events[e],u]:A._events[e].push(u):(A._events[e]=u,A._eventsCount++),A}function D(A,m){--A._eventsCount==0?A._events=new L:delete A._events[m]}function o(){this._events=new L,this._eventsCount=0}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(T=!1)),o.prototype.eventNames=function(){var A,m,f=[];if(this._eventsCount===0)return f;for(m in A=this._events)_.call(A,m)&&f.push(T?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(A)):f},o.prototype.listeners=function(A){var m=T?T+A:A,f=this._events[m];if(!f)return[];if(f.fn)return[f.fn];for(var E=0,y=f.length,u=new Array(y);E<y;E++)u[E]=f[E].fn;return u},o.prototype.listenerCount=function(A){var m=T?T+A:A,f=this._events[m];return f?f.fn?1:f.length:0},o.prototype.emit=function(A,m,f,E,y,u){var e=T?T+A:A;if(!this._events[e])return!1;var n,t,s=this._events[e],d=arguments.length;if(s.fn){switch(s.once&&this.removeListener(A,s.fn,void 0,!0),d){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,m),!0;case 3:return s.fn.call(s.context,m,f),!0;case 4:return s.fn.call(s.context,m,f,E),!0;case 5:return s.fn.call(s.context,m,f,E,y),!0;case 6:return s.fn.call(s.context,m,f,E,y,u),!0}for(t=1,n=new Array(d-1);t<d;t++)n[t-1]=arguments[t];s.fn.apply(s.context,n)}else{var a,l=s.length;for(t=0;t<l;t++)switch(s[t].once&&this.removeListener(A,s[t].fn,void 0,!0),d){case 1:s[t].fn.call(s[t].context);break;case 2:s[t].fn.call(s[t].context,m);break;case 3:s[t].fn.call(s[t].context,m,f);break;case 4:s[t].fn.call(s[t].context,m,f,E);break;default:if(!n)for(a=1,n=new Array(d-1);a<d;a++)n[a-1]=arguments[a];s[t].fn.apply(s[t].context,n)}}return!0},o.prototype.on=function(A,m,f){return x(this,A,m,f,!1)},o.prototype.once=function(A,m,f){return x(this,A,m,f,!0)},o.prototype.removeListener=function(A,m,f,E){var y=T?T+A:A;if(!this._events[y])return this;if(!m)return D(this,y),this;var u=this._events[y];if(u.fn)u.fn!==m||E&&!u.once||f&&u.context!==f||D(this,y);else{for(var e=0,n=[],t=u.length;e<t;e++)(u[e].fn!==m||E&&!u[e].once||f&&u[e].context!==f)&&n.push(u[e]);n.length?this._events[y]=n.length===1?n[0]:n:D(this,y)}return this},o.prototype.removeAllListeners=function(A){var m;return A?(m=T?T+A:A,this._events[m]&&D(this,m)):(this._events=new L,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=T,o.EventEmitter=o,N.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(N,w,h){var _,T,L,R,x;_=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,T=/^([^\/?#]*)([^]*)$/,L=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,x={buildAbsoluteURL:function(D,o,A){if(A=A||{},D=D.trim(),!(o=o.trim())){if(!A.alwaysNormalize)return D;var m=x.parseURL(D);if(!m)throw new Error("Error trying to parse base URL.");return m.path=x.normalizePath(m.path),x.buildURLFromParts(m)}var f=x.parseURL(o);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return A.alwaysNormalize?(f.path=x.normalizePath(f.path),x.buildURLFromParts(f)):o;var E=x.parseURL(D);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var y=T.exec(E.path);E.netLoc=y[1],E.path=y[2]}E.netLoc&&!E.path&&(E.path="/");var u={scheme:E.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(u.netLoc=E.netLoc,f.path[0]!=="/"))if(f.path){var e=E.path,n=e.substring(0,e.lastIndexOf("/")+1)+f.path;u.path=x.normalizePath(n)}else u.path=E.path,f.params||(u.params=E.params,f.query||(u.query=E.query));return u.path===null&&(u.path=A.alwaysNormalize?x.normalizePath(f.path):f.path),x.buildURLFromParts(u)},parseURL:function(D){var o=_.exec(D);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(L,"");D.length!==(D=D.replace(R,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}},N.exports=x},"./node_modules/webworkify-webpack/index.js":function(N,w,h){function _(o){var A={};function m(E){if(A[E])return A[E].exports;var y=A[E]={i:E,l:!1,exports:{}};return o[E].call(y.exports,y,y.exports,m),y.l=!0,y.exports}m.m=o,m.c=A,m.i=function(E){return E},m.d=function(E,y,u){m.o(E,y)||Object.defineProperty(E,y,{configurable:!1,enumerable:!0,get:u})},m.r=function(E){Object.defineProperty(E,"__esModule",{value:!0})},m.n=function(E){var y=E&&E.__esModule?function(){return E.default}:function(){return E};return m.d(y,"a",y),y},m.o=function(E,y){return Object.prototype.hasOwnProperty.call(E,y)},m.p="/",m.oe=function(E){throw console.error(E),E};var f=m(m.s=ENTRY_MODULE);return f.default||f}var T="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function R(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function x(o,A,m){var f={};f[m]=[];var E=A.toString(),y=E.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!y)return f;for(var u,e=y[1],n=new RegExp("(\\\\n|\\W)"+R(e)+L,"g");u=n.exec(E);)u[3]!=="dll-reference"&&f[m].push(u[3]);for(n=new RegExp("\\("+R(e)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+L,"g");u=n.exec(E);)o[u[2]]||(f[m].push(u[1]),o[u[2]]=h(u[1]).m),f[u[2]]=f[u[2]]||[],f[u[2]].push(u[4]);for(var t,s=Object.keys(f),d=0;d<s.length;d++)for(var a=0;a<f[s[d]].length;a++)t=f[s[d]][a],isNaN(1*t)||(f[s[d]][a]=1*f[s[d]][a]);return f}function D(o){return Object.keys(o).reduce(function(A,m){return A||o[m].length>0},!1)}N.exports=function(o,A){A=A||{};var m={main:h.m},f=A.all?{main:Object.keys(m.main)}:function(n,t){for(var s={main:[t]},d={main:[]},a={main:{}};D(s);)for(var l=Object.keys(s),p=0;p<l.length;p++){var v=l[p],g=s[v].pop();if(a[v]=a[v]||{},!a[v][g]&&n[v][g]){a[v][g]=!0,d[v]=d[v]||[],d[v].push(g);for(var r=x(n,n[v][g],v),i=Object.keys(r),c=0;c<i.length;c++)s[i[c]]=s[i[c]]||[],s[i[c]]=s[i[c]].concat(r[i[c]])}}return d}(m,o),E="";Object.keys(f).filter(function(n){return n!=="main"}).forEach(function(n){for(var t=0;f[n][t];)t++;f[n].push(t),m[n][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",E=E+"var "+n+" = ("+_.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+f[n].map(function(s){return JSON.stringify(s)+": "+m[n][s].toString()}).join(",")+`});
`}),E=E+"new (("+_.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+f.main.map(function(n){return JSON.stringify(n)+": "+m.main[n].toString()}).join(",")+"}))(self);";var y=new window.Blob([E],{type:"text/javascript"});if(A.bare)return y;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(y),e=new window.Worker(u);return e.objectURL=u,e}},"./src/config.ts":function(N,w,h){h.r(w),h.d(w,"hlsDefaultConfig",function(){return l}),h.d(w,"mergeConfig",function(){return p}),h.d(w,"enableStreamingMode",function(){return v});var _=h("./src/controller/abr-controller.ts"),T=h("./src/controller/audio-stream-controller.ts"),L=h("./src/controller/audio-track-controller.ts"),R=h("./src/controller/subtitle-stream-controller.ts"),x=h("./src/controller/subtitle-track-controller.ts"),D=h("./src/controller/buffer-controller.ts"),o=h("./src/controller/timeline-controller.ts"),A=h("./src/controller/cap-level-controller.ts"),m=h("./src/controller/fps-controller.ts"),f=h("./src/controller/eme-controller.ts"),E=h("./src/utils/xhr-loader.ts"),y=h("./src/utils/fetch-loader.ts"),u=h("./src/utils/cues.ts"),e=h("./src/utils/mediakeys-helper.ts"),n=h("./src/utils/logger.ts");function t(){return(t=Object.assign||function(g){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(g[c]=i[c])}return g}).apply(this,arguments)}function s(g,r){var i=Object.keys(g);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(g);r&&(c=c.filter(function(b){return Object.getOwnPropertyDescriptor(g,b).enumerable})),i.push.apply(i,c)}return i}function d(g){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?s(Object(i),!0).forEach(function(c){a(g,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(c){Object.defineProperty(g,c,Object.getOwnPropertyDescriptor(i,c))})}return g}function a(g,r,i){return r in g?Object.defineProperty(g,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):g[r]=i,g}var l=d(d({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:E.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:_.default,bufferController:D.default,capLevelController:A.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:x.default,timelineController:o.TimelineController,audioStreamController:T.default,audioTrackController:L.default,emeController:f.default});function p(g,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},g,r)}function v(g){var r=g.loader;r!==y.default&&r!==E.default?(n.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),g.progressive=!1):Object(y.fetchSupported)()&&(g.loader=y.default,g.progressive=!0,g.enableSoftwareAES=!0,n.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),T=h("./src/utils/ewma-bandwidth-estimator.ts"),L=h("./src/events.ts"),R=h("./src/utils/buffer-helper.ts"),x=h("./src/errors.ts"),D=h("./src/types/loader.ts"),o=h("./src/utils/logger.ts");function A(f,E){for(var y=0;y<E.length;y++){var u=E[y];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(f,u.key,u)}}var m=function(){function f(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var n=e.config;this.bwEstimator=new T.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var E,y,u=f.prototype;return u.registerListeners=function(){var e=this.hls;e.on(L.Events.FRAG_LOADING,this.onFragLoading,this),e.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var e=this.hls;e.off(L.Events.FRAG_LOADING,this.onFragLoading,this),e.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(e,n){var t,s=n.frag;s.type===D.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=s,this.partCurrent=(t=n.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)))},u.onLevelLoaded=function(e,n){var t=this.hls.config;n.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var e=this.fragCurrent,n=this.partCurrent,t=this.hls,s=t.autoLevelEnabled,d=t.config,a=t.media;if(e&&a){var l=n?n.stats:e.stats,p=n?n.duration:e.duration;if(l.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(s&&!a.paused&&a.playbackRate&&a.readyState){var v=performance.now()-l.loading.start,g=Math.abs(a.playbackRate);if(!(v<=500*p/g)){var r=t.levels,i=t.minAutoLevel,c=r[e.level],b=l.total||Math.max(l.loaded,Math.round(p*c.maxBitrate/8)),S=Math.max(1,l.bwEstimate?l.bwEstimate/8:1e3*l.loaded/v),k=(b-l.loaded)/S,C=a.currentTime,I=(R.BufferHelper.bufferInfo(a,C,d.maxBufferHole).end-C)/g;if(!(I>=2*p/g||k<=I)){var O,P=Number.POSITIVE_INFINITY;for(O=e.level-1;O>i&&!((P=p*r[O].maxBitrate/(6.4*S))<I);O--);if(!(P>=k)){var F=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+e.sn+(n?" part "+n.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+O+`
      Current BW estimate: `+(Object(_.isFiniteNumber)(F)?(F/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+k.toFixed(3)+` s
      Estimated load time for the next fragment: `+P.toFixed(3)+` s
      Time to underbuffer: `+I.toFixed(3)+" s"),t.nextLoadLevel=O,this.bwEstimator.sample(v,l.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),t.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:n,stats:l})}}}}}},u.onFragLoaded=function(e,n){var t=n.frag,s=n.part;if(t.type===D.PlaylistLevelType.MAIN&&Object(_.isFiniteNumber)(t.sn)){var d=s?s.stats:t.stats,a=s?s.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var l=this.hls.levels[t.level],p=(l.loaded?l.loaded.bytes:0)+d.loaded,v=(l.loaded?l.loaded.duration:0)+a;l.loaded={bytes:p,duration:v},l.realBitrate=Math.round(8*p/v)}if(t.bitrateTest){var g={stats:d,frag:t,part:s,id:t.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,g),t.bitrateTest=!1}}},u.onFragBuffered=function(e,n){var t=n.frag,s=n.part,d=s?s.stats:t.stats;if(!d.aborted&&t.type===D.PlaylistLevelType.MAIN&&t.sn!=="initSegment"){var a=d.parsing.end-d.loading.start;this.bwEstimator.sample(a,d.loaded),d.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},u.onError=function(e,n){switch(n.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var e=this.fragCurrent,n=this.partCurrent,t=this.hls,s=t.maxAutoLevel,d=t.config,a=t.minAutoLevel,l=t.media,p=n?n.duration:e?e.duration:0,v=l?l.currentTime:0,g=l&&l.playbackRate!==0?Math.abs(l.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,i=(R.BufferHelper.bufferInfo(l,v,d.maxBufferHole).end-v)/g,c=this.findBestLevel(r,a,s,i,d.abrBandWidthFactor,d.abrBandWidthUpFactor);if(c>=0)return c;o.logger.trace((i?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var b=p?Math.min(p,d.maxStarvationDelay):d.maxStarvationDelay,S=d.abrBandWidthFactor,k=d.abrBandWidthUpFactor;if(!i){var C=this.bitrateTestDelay;C&&(b=(p?Math.min(p,d.maxLoadingDelay):d.maxLoadingDelay)-C,o.logger.trace("bitrate test took "+Math.round(1e3*C)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*b)+" ms"),S=k=1)}return c=this.findBestLevel(r,a,s,i+b,S,k),Math.max(c,0)},u.findBestLevel=function(e,n,t,s,d,a){for(var l,p=this.fragCurrent,v=this.partCurrent,g=this.lastLoadedFragLevel,r=this.hls.levels,i=r[g],c=!(i==null||(l=i.details)===null||l===void 0||!l.live),b=i==null?void 0:i.codecSet,S=v?v.duration:p?p.duration:0,k=t;k>=n;k--){var C=r[k];if(C&&(!b||C.codecSet===b)){var I=C.details,O=(v?I==null?void 0:I.partTarget:I==null?void 0:I.averagetargetduration)||S,P=void 0;P=k<=g?d*e:a*e;var F=r[k].maxBitrate,M=F*O/P;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(P)+"/"+F+"/"+O+"/"+s+"/"+M),P>F&&(!M||c&&!this.bitrateTestDelay||M<s))return k}}return-1},E=f,(y=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,n=this.bwEstimator;if(!(e===-1||n&&n.canEstimate()))return e;var t=this.getNextABRAutoLevel();return e!==-1&&(t=Math.min(e,t)),t},set:function(e){this._nextAutoLevel=e}}])&&A(E.prototype,y),f}();w.default=m},"./src/controller/audio-stream-controller.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),T=h("./src/controller/base-stream-controller.ts"),L=h("./src/events.ts"),R=h("./src/utils/buffer-helper.ts"),x=h("./src/controller/fragment-tracker.ts"),D=h("./src/types/level.ts"),o=h("./src/types/loader.ts"),A=h("./src/loader/fragment.ts"),m=h("./src/demux/chunk-cache.ts"),f=h("./src/demux/transmuxer-interface.ts"),E=h("./src/types/transmuxer.ts"),y=h("./src/controller/fragment-finders.ts"),u=h("./src/utils/discontinuities.ts"),e=h("./src/errors.ts"),n=h("./src/utils/logger.ts");function t(){return(t=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(a[v]=p[v])}return a}).apply(this,arguments)}function s(a,l){return(s=Object.setPrototypeOf||function(p,v){return p.__proto__=v,p})(a,l)}var d=function(a){var l,p;function v(r,i){var c;return(c=a.call(this,r,i,"[audio-stream-controller]")||this).videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c._registerListeners(),c}p=a,(l=v).prototype=Object.create(p.prototype),l.prototype.constructor=l,s(l,p);var g=v.prototype;return g.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},g._registerListeners=function(){var r=this.hls;r.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(L.Events.ERROR,this.onError,this),r.on(L.Events.BUFFER_RESET,this.onBufferReset,this),r.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var r=this.hls;r.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(L.Events.ERROR,this.onError,this),r.off(L.Events.BUFFER_RESET,this.onBufferReset,this),r.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onInitPtsFound=function(r,i){var c=i.frag,b=i.id,S=i.initPTS;if(b==="main"){var k=c.cc;this.initPTS[c.cc]=S,this.log("InitPTS for cc: "+k+" found from main: "+S),this.videoTrackCC=k,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},g.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=T.State.STOPPED);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,i>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},g.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:var r,i=this.levels,c=this.trackId,b=i==null||(r=i[c])===null||r===void 0?void 0:r.details;if(b){if(this.waitForCdnTuneIn(b))break;this.state=T.State.WAITING_INIT_PTS}break;case T.State.FRAG_LOADING_WAITING_RETRY:var S,k=performance.now(),C=this.retryDate;(!C||k>=C||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break;case T.State.WAITING_INIT_PTS:var I=this.waitingData;if(I){var O=I.frag,P=I.part,F=I.cache,M=I.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var B={frag:O,part:P,payload:F.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),M&&a.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)n.logger.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),G=R.BufferHelper.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);Object(y.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,O)<0&&(n.logger.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}this.onTickEnd()},g.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},g.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var i=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&i.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},g.doTickIdle=function(){var r,i,c=this.hls,b=this.levels,S=this.media,k=this.trackId,C=c.config;if(b&&b[k]&&(S||!this.startFragRequested&&C.startFragPrefetch)){var I=b[k].details;if(!I||I.live&&this.levelLastLoaded!==k||this.waitForCdnTuneIn(I))this.state=T.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,A.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var O=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(O!==null){var P=O.len,F=this.getMaxBufferLength(),M=this.audioSwitch;if(!(P>=F)||M){if(!M&&this._streamEnded(O,I))return c.trigger(L.Events.BUFFER_EOS,{type:"audio"}),void(this.state=T.State.ENDED);var B=I.fragments[0].start,U=O.end;if(M){var G=this.getLoadPosition();U=G,I.PTSKnown&&G<B&&(O.end>B||O.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),S.currentTime=B+.05)}var K=this.getNextFragment(U,I);K?((r=K.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(i=K.decryptdata)!==null&&i!==void 0&&i.key?this.loadFragment(K,I,U):this.loadKey(K,I):this.bufferFlushed=!0}}}}},g.getMaxBufferLength=function(){var r=a.prototype.getMaxBufferLength.call(this),i=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return i===null?r:Math.max(r,i.len)},g.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},g.onAudioTracksUpdated=function(r,i){var c=i.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(b){return new D.Level(b)})},g.onAudioTrackSwitching=function(r,i){var c=!!i.url;this.trackId=i.id;var b=this.fragCurrent;b!=null&&b.loader&&b.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(100):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},g.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},g.onLevelLoaded=function(r,i){this.mainDetails=i.details},g.onAudioTrackLoaded=function(r,i){var c,b=this.levels,S=i.details,k=i.id;if(b){this.log("Track "+k+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var C=b[k],I=0;if(S.live||(c=C.details)!==null&&c!==void 0&&c.live){var O=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!O)return;!C.details&&S.hasProgramDateTime&&O.hasProgramDateTime?(Object(u.alignPDT)(S,O),I=S.fragments[0].start):I=this.alignPlaylists(S,C.details)}C.details=S,this.levelLastLoaded=k,this.startFragRequested||!this.mainDetails&&S.live||this.setStartPosition(C.details,I),this.state!==T.State.WAITING_TRACK||this.waitForCdnTuneIn(S)||(this.state=T.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+k)},g._handleFragmentLoadProgress=function(r){var i,c=r.frag,b=r.part,S=r.payload,k=this.config,C=this.trackId,I=this.levels;if(I){var O=I[C];console.assert(O,"Audio track is defined on fragment load progress");var P=O.details;console.assert(P,"Audio track details are defined on fragment load progress");var F=k.defaultAudioCodec||O.audioCodec||"mp4a.40.2",M=this.transmuxer;M||(M=this.transmuxer=new f.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[c.cc],U=(i=c.initSegment)===null||i===void 0?void 0:i.data;if(B!==void 0){var G=b?b.index:-1,K=G!==-1,H=new E.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,S.byteLength,G,K);M.push(S,U,F,"",c,b,P.totalduration,!1,H,B)}else n.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+P.startSN+" ,"+P.endSN+"],track "+C),(this.waitingData=this.waitingData||{frag:c,part:b,cache:new m.default,complete:!1}).cache.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},g._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:a.prototype._handleFragmentLoadComplete.call(this,r)},g.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},g.onBufferCreated=function(r,i){var c=i.tracks.audio;c&&(this.mediaBuffer=c.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},g.onFragBuffered=function(r,i){var c=i.frag,b=i.part;c.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(c)?this.warn("Fragment "+c.sn+(b?" p: "+b.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(c.sn!=="initSegment"&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,b)))},g.onError=function(r,i){switch(i.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,i);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=i.fatal?T.State.ERROR:T.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var c=!0,b=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);b&&b.len>.5&&(c=!this.reduceMaxBufferLength(b.len)),c&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},g.onBufferFlushed=function(r,i){i.type===A.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},g._handleTransmuxComplete=function(r){var i,c="audio",b=this.hls,S=r.remuxResult,k=r.chunkMeta,C=this.getCurrentContext(k);if(!C)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var I=C.frag,O=C.part,P=S.audio,F=S.text,M=S.id3,B=S.initSegment;if(!this.fragContextChanged(I)){if(this.state=T.State.PARSING,this.audioSwitch&&P&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,I,k),b.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:c,tracks:B.tracks})),P){var U=P.startPTS,G=P.endPTS,K=P.startDTS,H=P.endDTS;O&&(O.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:G,startDTS:K,endDTS:H}),I.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,U,G,K,H),this.bufferFragmentData(P,I,O,k)}if(M!=null&&(i=M.samples)!==null&&i!==void 0&&i.length){var q=t({frag:I,id:c},M);b.trigger(L.Events.FRAG_PARSING_METADATA,q)}if(F){var W=t({frag:I,id:c},F);b.trigger(L.Events.FRAG_PARSING_USERDATA,W)}}},g._bufferInitSegment=function(r,i,c){if(this.state===T.State.PARSING){r.video&&delete r.video;var b=r.audio;if(b){b.levelCodec=b.codec,b.id="audio",this.log("Init audio buffer, container:"+b.container+", codecs[parsed]=["+b.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,r);var S=b.initSegment;if(S!=null&&S.byteLength){var k={type:"audio",frag:i,part:null,chunkMeta:c,parent:i.type,data:S};this.hls.trigger(L.Events.BUFFER_APPENDING,k)}this.tick()}}},g.loadFragment=function(r,i,c){var b=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||b===x.FragmentState.NOT_LOADED||b===x.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):i.live&&!Object(_.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,r,i,c)))},g.completeAudioSwitch=function(){var r=this.hls,i=this.media,c=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:c})},v}(T.default);w.default=d},"./src/controller/audio-track-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),T=h("./src/errors.ts"),L=h("./src/controller/base-playlist-controller.ts"),R=h("./src/types/loader.ts");function x(A,m){for(var f=0;f<m.length;f++){var E=m[f];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(A,E.key,E)}}function D(A,m){return(D=Object.setPrototypeOf||function(f,E){return f.__proto__=E,f})(A,m)}var o=function(A){var m,f;function E(n){var t;return(t=A.call(this,n,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}f=A,(m=E).prototype=Object.create(f.prototype),m.prototype.constructor=m,D(m,f);var y,u,e=E.prototype;return e.registerListeners=function(){var n=this.hls;n.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(_.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var n=this.hls;n.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(_.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,A.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},e.onManifestParsed=function(n,t){this.tracks=t.audioTracks||[]},e.onAudioTrackLoaded=function(n,t){var s=t.id,d=t.details,a=this.tracksInGroup[s];if(a){var l=a.details;a.details=t.details,this.log("audioTrack "+s+" loaded ["+d.startSN+"-"+d.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,t,l))}else this.warn("Invalid audio track id "+s)},e.onLevelLoading=function(n,t){this.switchLevel(t.level)},e.onLevelSwitching=function(n,t){this.switchLevel(t.level)},e.switchLevel=function(n){var t=this.hls.levels[n];if(t!=null&&t.audioGroupIds){var s=t.audioGroupIds[t.urlId];if(this.groupId!==s){this.groupId=s;var d=this.tracks.filter(function(l){return!s||l.groupId===s});this.selectDefaultTrack&&!d.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=d;var a={audioTracks:d};this.log("Updating audio tracks, "+d.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(_.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},e.onError=function(n,t){A.prototype.onError.call(this,n,t),!t.fatal&&t.context&&t.context.type===R.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},e.setAudioTrack=function(n){var t=this.tracksInGroup;if(n<0||n>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var s=t[this.trackId];this.log("Now switching to audio-track index "+n);var d=t[n],a=d.id,l=d.groupId,p=l===void 0?"":l,v=d.name,g=d.type,r=d.url;if(this.trackId=n,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:p,name:v,type:g,url:r}),!d.details||d.details.live){var i=this.switchParams(d.url,s==null?void 0:s.details);this.loadPlaylist(i)}}},e.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,s=this.findTrackId(t)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},e.findTrackId=function(n){for(var t=this.tracksInGroup,s=0;s<t.length;s++){var d=t[s];if((!this.selectDefaultTrack||d.default)&&(!n||n===d.name))return d.id}return-1},e.loadPlaylist=function(n){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var s=t.id,d=t.groupId,a=t.url;if(n)try{a=n.addDirectives(a)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(_.Events.AUDIO_TRACK_LOADING,{url:a,id:s,groupId:d,deliveryDirectives:n||null})}},y=E,(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}])&&x(y.prototype,u),E}(L.default);w.default=o},"./src/controller/base-playlist-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return D});var _=h("./src/polyfills/number.ts"),T=h("./src/types/level.ts"),L=h("./src/controller/level-helper.ts"),R=h("./src/utils/logger.ts"),x=h("./src/errors.ts"),D=function(){function o(m,f){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=R.logger.log.bind(R.logger,f+":"),this.warn=R.logger.warn.bind(R.logger,f+":"),this.hls=m}var A=o.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(m,f){f.fatal&&f.type===x.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(m,f){var E=f==null?void 0:f.renditionReports;if(E)for(var y=0;y<E.length;y++){var u=E[y],e=""+u.URI;if(e===m.substr(-e.length)){var n=parseInt(u["LAST-MSN"]),t=parseInt(u["LAST-PART"]);if(f&&this.hls.config.lowLatencyMode){var s=Math.min(f.age-f.partTarget,f.targetduration);t!==void 0&&s>f.partTarget&&(t+=1)}if(Object(_.isFiniteNumber)(n))return new T.HlsUrlParameters(n,Object(_.isFiniteNumber)(t)?t:void 0,T.HlsSkip.No)}}},A.loadPlaylist=function(m){},A.shouldLoadTrack=function(m){return this.canLoad&&m&&!!m.url&&(!m.details||m.details.live)},A.playlistLoaded=function(m,f,E){var y=this,u=f.details,e=f.stats,n=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(u.advancedDateTime=Date.now()-n,u.live||E!=null&&E.live){if(u.reloaded(E),E&&this.log("live playlist "+m+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),E&&u.fragments.length>0&&Object(L.mergeDetails)(E,u),!this.canLoad||!u.live)return;var t,s=void 0,d=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var a=this.hls.config.lowLatencyMode,l=u.lastPartSn,p=u.endSN,v=u.lastPartIndex,g=l===p;v!==-1?(s=g?p+1:l,d=g?a?0:v:v+1):s=p+1;var r=u.age,i=r+u.ageHeader,c=Math.min(i-u.partTarget,1.5*u.targetduration);if(c>0){if(E&&c>E.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+E.tuneInGoal+" to: "+c+" with playlist age: "+u.age),c=0;else{var b=Math.floor(c/u.targetduration);s+=b,d!==void 0&&(d+=Math.round(c%u.targetduration/u.partTarget)),this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+c+" skip sn "+b+" to part "+d)}u.tuneInGoal=c}if(t=this.getDeliveryDirectives(u,f.deliveryDirectives,s,d),a||!g)return void this.loadPlaylist(t)}else t=this.getDeliveryDirectives(u,f.deliveryDirectives,s,d);var S=Object(L.computeReloadInterval)(u,e);s!==void 0&&u.canBlockReload&&(S-=u.partTarget||1),this.log("reload live playlist "+m+" in "+Math.round(S)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(t)},S)}else this.clearTimer()},A.getDeliveryDirectives=function(m,f,E,y){var u=Object(T.getSkipValue)(m,E);return f!=null&&f.skip&&m.deltaUpdateFailed&&(E=f.msn,y=f.part,u=T.HlsSkip.No),new T.HlsUrlParameters(E,y,u)},A.retryLoadingOrFail=function(m){var f,E=this,y=this.hls.config,u=this.retryCount<y.levelLoadingMaxRetry;if(u)if(this.retryCount++,m.details.indexOf("LoadTimeOut")>-1&&(f=m.context)!==null&&f!==void 0&&f.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+m.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+m.details+'"')}else this.warn('cannot recover from error "'+m.details+'"'),this.clearTimer(),m.fatal=!0;return u},o}()},"./src/controller/base-stream-controller.ts":function(N,w,h){h.r(w),h.d(w,"State",function(){return a}),h.d(w,"default",function(){return l});var _=h("./src/polyfills/number.ts"),T=h("./src/task-loop.ts"),L=h("./src/controller/fragment-tracker.ts"),R=h("./src/utils/buffer-helper.ts"),x=h("./src/utils/logger.ts"),D=h("./src/events.ts"),o=h("./src/errors.ts"),A=h("./src/types/transmuxer.ts"),m=h("./src/utils/mp4-tools.ts"),f=h("./src/utils/discontinuities.ts"),E=h("./src/controller/fragment-finders.ts"),y=h("./src/controller/level-helper.ts"),u=h("./src/loader/fragment-loader.ts"),e=h("./src/crypt/decrypter.ts"),n=h("./src/utils/time-ranges.ts"),t=h("./src/types/loader.ts");function s(p,v){for(var g=0;g<v.length;g++){var r=v[g];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(p,r.key,r)}}function d(p,v){return(d=Object.setPrototypeOf||function(g,r){return g.__proto__=r,g})(p,v)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},l=function(p){var v,g;function r(S,k,C){var I;return(I=p.call(this)||this).hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=a.STOPPED,I.media=void 0,I.mediaBuffer=void 0,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=C,I.log=x.logger.log.bind(x.logger,C+":"),I.warn=x.logger.warn.bind(x.logger,C+":"),I.hls=S,I.fragmentLoader=new u.default(S.config),I.fragmentTracker=k,I.config=S.config,I.decrypter=new e.default(S,S.config),S.on(D.Events.KEY_LOADED,I.onKeyLoaded,function(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}(I)),I}g=p,(v=r).prototype=Object.create(g.prototype),v.prototype.constructor=v,d(v,g);var i,c,b=r.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(S){},b.stopLoad=function(){this.fragmentLoader.abort();var S=this.fragCurrent;S&&this.fragmentTracker.removeFragment(S),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},b._streamEnded=function(S,k){var C=this.fragCurrent,I=this.fragmentTracker;if(!k.live&&C&&C.sn===k.endSN&&!S.nextStart){var O=I.getState(C);return O===L.FragmentState.PARTIAL||O===L.FragmentState.OK}return!1},b.onMediaAttached=function(S,k){var C=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),C.addEventListener("seeking",this.onvseeking),C.addEventListener("ended",this.onvended);var I=this.config;this.levels&&I.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(I.startPosition)},b.onMediaDetaching=function(){var S=this.media;S!=null&&S.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),S&&(S.removeEventListener("seeking",this.onvseeking),S.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var S=this.config,k=this.fragCurrent,C=this.media,I=this.mediaBuffer,O=this.state,P=C?C.currentTime:0,F=R.BufferHelper.bufferInfo(I||C,P,S.maxBufferHole);if(this.log("media seeking to "+(Object(_.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+O),O===a.ENDED)this.resetLoadingState();else if(k&&!F.len){var M=S.maxFragLookUpTolerance,B=k.start-M,U=P>k.start+k.duration+M;(P<B||U)&&(U&&k.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),k.loader.abort()),this.resetLoadingState())}C&&(this.lastCurrentTime=P),this.loadedmetadata||F.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(S,k){if(this.state===a.KEY_LOADING&&k.frag===this.fragCurrent&&this.levels){this.state=a.IDLE;var C=this.levels[k.frag.level].details;C&&this.loadFragment(k.frag,C,k.frag.start)}},b.onHandlerDestroying=function(){this.stopLoad(),p.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,p.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(S,k){this.log("Loading key for "+S.sn+" of ["+k.startSN+"-"+k.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level),this.state=a.KEY_LOADING,this.fragCurrent=S,this.hls.trigger(D.Events.KEY_LOADING,{frag:S})},b.loadFragment=function(S,k,C){this._loadFragForPlayback(S,k,C)},b._loadFragForPlayback=function(S,k,C){var I=this;this._doFragLoad(S,k,C,function(O){if(I.fragContextChanged(S))return I.warn("Fragment "+S.sn+(O.part?" p: "+O.part.index:"")+" of level "+S.level+" was dropped during download."),void I.fragmentTracker.removeFragment(S);S.stats.chunkCount++,I._handleFragmentLoadProgress(O)}).then(function(O){if(O){I.fragLoadError=0;var P=I.state;if(!I.fragContextChanged(S))return"payload"in O&&(I.log("Loaded fragment "+S.sn+" of level "+S.level),I.hls.trigger(D.Events.FRAG_LOADED,O),I.state===a.BACKTRACKING)?(I.fragmentTracker.backtrack(S,O),void I.resetFragmentLoading(S)):void I._handleFragmentLoadComplete(O);(P===a.FRAG_LOADING||P===a.BACKTRACKING||!I.fragCurrent&&P===a.PARSING)&&(I.fragmentTracker.removeFragment(S),I.state=a.IDLE)}}).catch(function(O){I.warn(O),I.resetFragmentLoading(S)})},b.flushMainBuffer=function(S,k,C){if(C===void 0&&(C=null),S-k){var I={startOffset:S,endOffset:k,type:C};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,I)}},b._loadInitSegment=function(S){var k=this;this._doFragLoad(S).then(function(C){if(!C||k.fragContextChanged(S)||!k.levels)throw new Error("init load aborted");return C}).then(function(C){var I=k.hls,O=C.payload,P=S.decryptdata;if(O&&O.byteLength>0&&P&&P.key&&P.iv&&P.method==="AES-128"){var F=self.performance.now();return k.decrypter.webCryptoDecrypt(new Uint8Array(O),P.key.buffer,P.iv.buffer).then(function(M){var B=self.performance.now();return I.trigger(D.Events.FRAG_DECRYPTED,{frag:S,payload:M,stats:{tstart:F,tdecrypt:B}}),C.payload=M,C})}return C}).then(function(C){var I=k.fragCurrent,O=k.hls,P=k.levels;if(!P)throw new Error("init load aborted, missing levels");var F=P[S.level].details;console.assert(F,"Level details are defined when init segment is loaded");var M=S.stats;k.state=a.IDLE,k.fragLoadError=0,S.data=new Uint8Array(C.payload),M.parsing.start=M.buffering.start=self.performance.now(),M.parsing.end=M.buffering.end=self.performance.now(),C.frag===I&&O.trigger(D.Events.FRAG_BUFFERED,{stats:M,frag:I,part:null,id:S.type}),k.tick()}).catch(function(C){k.warn(C),k.resetFragmentLoading(S)})},b.fragContextChanged=function(S){var k=this.fragCurrent;return!S||!k||S.level!==k.level||S.sn!==k.sn||S.urlId!==k.urlId},b.fragBufferedComplete=function(S,k){var C=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+S.type+" sn: "+S.sn+(k?" part: "+k.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level+" "+n.default.toString(R.BufferHelper.getBuffered(C))),this.state=a.IDLE,this.tick()},b._handleFragmentLoadComplete=function(S){var k=this.transmuxer;if(k){var C=S.frag,I=S.part,O=S.partsLoaded,P=!O||O.length===0||O.some(function(M){return!M}),F=new A.ChunkMetadata(C.level,C.sn,C.stats.chunkCount+1,0,I?I.index:-1,!P);k.flush(F)}},b._handleFragmentLoadProgress=function(S){},b._doFragLoad=function(S,k,C,I){var O=this;if(C===void 0&&(C=null),!this.levels)throw new Error("frag load aborted, missing levels");if(C=Math.max(S.start,C||0),this.config.lowLatencyMode&&k){var P=k.partList;if(P&&I){C>S.end&&k.fragmentHint&&(S=k.fragmentHint);var F=this.getNextPart(P,S,C);if(F>-1){var M=P[F];return this.log("Loading part sn: "+S.sn+" p: "+M.index+" cc: "+S.cc+" of playlist ["+k.startSN+"-"+k.endSN+"] parts [0-"+F+"-"+(P.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(C.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=a.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:S,part:P[F],targetBufferTime:C}),this.doFragPartsLoad(S,P,F,I).catch(function(B){return O.handleFragLoadError(B)})}if(!S.url||this.loadedEndOfParts(P,C))return Promise.resolve(null)}}return this.log("Loading fragment "+S.sn+" cc: "+S.cc+" "+(k?"of ["+k.startSN+"-"+k.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(C.toFixed(3))),Object(_.isFiniteNumber)(S.sn)&&!this.bitrateTest&&(this.nextLoadPosition=S.start+S.duration),this.state=a.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:S,targetBufferTime:C}),this.fragmentLoader.load(S,I).catch(function(B){return O.handleFragLoadError(B)})},b.doFragPartsLoad=function(S,k,C,I){var O=this;return new Promise(function(P,F){var M=[];(function B(U){var G=k[U];O.fragmentLoader.loadPart(S,G,I).then(function(K){M[G.index]=K;var H=K.part;O.hls.trigger(D.Events.FRAG_LOADED,K);var q=k[U+1];if(!q||q.fragment!==S)return P({frag:S,part:H,partsLoaded:M});B(U+1)}).catch(F)})(C)})},b.handleFragLoadError=function(S){var k=S.data;return k&&k.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(k.frag,k.part):this.hls.trigger(D.Events.ERROR,k),null},b._handleTransmuxerFlush=function(S){var k=this.getCurrentContext(S);if(k&&this.state===a.PARSING){var C=k.frag,I=k.part,O=k.level,P=self.performance.now();C.stats.parsing.end=P,I&&(I.stats.parsing.end=P),this.updateLevelTiming(C,I,O,S.partial)}else this.fragCurrent||(this.state=a.IDLE)},b.getCurrentContext=function(S){var k=this.levels,C=S.level,I=S.sn,O=S.part;if(!k||!k[C])return this.warn("Levels object was unset while buffering fragment "+I+" of level "+C+". The current chunk will not be buffered."),null;var P=k[C],F=O>-1?Object(y.getPartWith)(P,I,O):null,M=F?F.fragment:Object(y.getFragmentWithSN)(P,I,this.fragCurrent);return M?{frag:M,part:F,level:P}:null},b.bufferFragmentData=function(S,k,C,I){if(S&&this.state===a.PARSING){var O=S.data1,P=S.data2,F=O;if(O&&P&&(F=Object(m.appendUint8Array)(O,P)),F&&F.length){var M={type:S.type,frag:k,part:C,chunkMeta:I,parent:k.type,data:F};this.hls.trigger(D.Events.BUFFER_APPENDING,M),S.dropped&&S.independent&&!C&&this.flushBufferGap(k)}}},b.flushBufferGap=function(S){var k=this.media;if(k)if(R.BufferHelper.isBuffered(k,k.currentTime)){var C=k.currentTime,I=R.BufferHelper.bufferInfo(k,C,0),O=S.duration,P=Math.min(2*this.config.maxFragLookUpTolerance,.25*O),F=Math.max(Math.min(S.start-P,I.end-P),C+P);S.start-F>P&&this.flushMainBuffer(F,S.start)}else this.flushMainBuffer(0,S.start)},b.getFwdBufferInfo=function(S,k){var C=this.config,I=this.getLoadPosition();if(!Object(_.isFiniteNumber)(I))return null;var O=R.BufferHelper.bufferInfo(S,I,C.maxBufferHole);if(O.len===0&&O.nextStart!==void 0){var P=this.fragmentTracker.getBufferedFrag(I,k);if(P&&O.nextStart<P.end)return R.BufferHelper.bufferInfo(S,I,Math.max(O.nextStart,C.maxBufferHole))}return O},b.getMaxBufferLength=function(S){var k,C=this.config;return k=S?Math.max(8*C.maxBufferSize/S,C.maxBufferLength):C.maxBufferLength,Math.min(k,C.maxMaxBufferLength)},b.reduceMaxBufferLength=function(S){var k=this.config,C=S||k.maxBufferLength;return k.maxMaxBufferLength>=C&&(k.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+k.maxMaxBufferLength+"s"),!0)},b.getNextFragment=function(S,k){var C,I,O=k.fragments,P=O.length;if(!P)return null;var F,M=this.config,B=O[0].start;if(k.live){var U=M.initialLiveManifestSize;if(P<U)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+U+")"),null;k.PTSKnown||this.startFragRequested||this.startPosition!==-1||(F=this.getInitialLiveFragment(k,O),this.startPosition=F?this.hls.liveSyncPosition||F.start:S)}else S<=B&&(F=O[0]);if(!F){var G=M.lowLatencyMode?k.partEnd:k.fragmentEnd;F=this.getFragmentAtPosition(S,G,k)}return(C=F)===null||C===void 0||!C.initSegment||(I=F)!==null&&I!==void 0&&I.initSegment.data||this.bitrateTest||(F=F.initSegment),F},b.getNextPart=function(S,k,C){for(var I=-1,O=!1,P=!0,F=0,M=S.length;F<M;F++){var B=S[F];if(P=P&&!B.independent,I>-1&&C<B.start)break;var U=B.loaded;!U&&(O||B.independent||P)&&B.fragment===k&&(I=F),O=U}return I},b.loadedEndOfParts=function(S,k){var C=S[S.length-1];return C&&k>C.start&&C.loaded},b.getInitialLiveFragment=function(S,k){var C=this.fragPrevious,I=null;if(C){if(S.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+C.programDateTime),I=Object(E.findFragmentByPDT)(k,C.endProgramDateTime,this.config.maxFragLookUpTolerance)),!I){var O=C.sn+1;if(O>=S.startSN&&O<=S.endSN){var P=k[O-S.startSN];C.cc===P.cc&&(I=P,this.log("Live playlist, switching playlist, load frag with next SN: "+I.sn))}I||(I=Object(E.findFragWithCC)(k,C.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+I.sn)}}else{var F=this.hls.liveSyncPosition;F!==null&&(I=this.getFragmentAtPosition(F,this.bitrateTest?S.fragmentEnd:S.edge,S))}return I},b.getFragmentAtPosition=function(S,k,C){var I,O=this.config,P=this.fragPrevious,F=C.fragments,M=C.endSN,B=C.fragmentHint,U=O.maxFragLookUpTolerance,G=!!(O.lowLatencyMode&&C.partList&&B);if(G&&B&&!this.bitrateTest&&(F=F.concat(B),M=B.sn),S<k){var K=S>k-U?0:U;I=Object(E.findFragmentByPTS)(P,F,S,K)}else I=F[F.length-1];if(I){var H=I.sn-C.startSN,q=P&&I.level===P.level,W=F[H+1];if(this.fragmentTracker.getState(I)===L.FragmentState.BACKTRACKED){I=null;for(var Y=H;F[Y]&&this.fragmentTracker.getState(F[Y])===L.FragmentState.BACKTRACKED;)I=P?F[Y--]:F[--Y];I||(I=W)}else P&&I.sn===P.sn&&!G&&q&&(I.sn<M&&this.fragmentTracker.getState(W)!==L.FragmentState.OK?(this.log("SN "+I.sn+" just loaded, load next one: "+W.sn),I=W):I=null)}return I},b.synchronizeToLiveEdge=function(S){var k=this.config,C=this.media;if(C){var I=this.hls.liveSyncPosition,O=C.currentTime,P=S.fragments[0].start,F=S.edge,M=O>=P-k.maxFragLookUpTolerance&&O<=F;if(I!==null&&C.duration>I&&(O<I||!M)){var B=k.liveMaxLatencyDuration!==void 0?k.liveMaxLatencyDuration:k.liveMaxLatencyDurationCount*S.targetduration;(!M&&C.readyState<4||O<F-B)&&(this.loadedmetadata||(this.nextLoadPosition=I),C.readyState&&(this.warn("Playback: "+O.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+I.toFixed(3)),C.currentTime=I))}}},b.alignPlaylists=function(S,k){var C=this.levels,I=this.levelLastLoaded,O=this.fragPrevious,P=I!==null?C[I]:null,F=S.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var M=S.fragments[0].start,B=!k,U=S.alignedSliding&&Object(_.isFiniteNumber)(M);if(B||!U&&!M){Object(f.alignStream)(O,P,S);var G=S.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(k?k.startSN:"na")+"->"+S.startSN+" prev-sn: "+(O?O.sn:"na")+" fragments: "+F),G}return M},b.waitForCdnTuneIn=function(S){return S.live&&S.canBlockReload&&S.tuneInGoal>Math.max(S.partHoldBack,3*S.partTarget)},b.setStartPosition=function(S,k){var C=this.startPosition;if(C<k&&(C=-1),C===-1||this.lastCurrentTime===-1){var I=S.startTimeOffset;Object(_.isFiniteNumber)(I)?(C=k+I,I<0&&(C+=S.totalduration),C=Math.min(Math.max(k,C),k+S.totalduration),this.log("Start time offset "+I+" found in playlist, adjust startPosition to "+C),this.startPosition=C):S.live?C=this.hls.liveSyncPosition||k:this.startPosition=C=0,this.lastCurrentTime=C}this.nextLoadPosition=C},b.getLoadPosition=function(){var S=this.media,k=0;return this.loadedmetadata&&S?k=S.currentTime:this.nextLoadPosition&&(k=this.nextLoadPosition),k},b.handleFragLoadAborted=function(S,k){this.transmuxer&&S.sn!=="initSegment"&&S.stats.aborted&&(this.warn("Fragment "+S.sn+(k?" part"+k.index:"")+" of level "+S.level+" was aborted"),this.resetFragmentLoading(S))},b.resetFragmentLoading=function(S){this.fragCurrent&&this.fragContextChanged(S)||(this.state=a.IDLE)},b.onFragmentOrKeyLoadError=function(S,k){if(!k.fatal){var C=k.frag;if(C&&C.type===S){var I=this.fragCurrent;console.assert(I&&C.sn===I.sn&&C.level===I.level&&C.urlId===I.urlId,"Frag load error must match current frag to retry");var O=this.config;if(this.fragLoadError+1<=O.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(C.level))return;var P=Math.min(Math.pow(2,this.fragLoadError)*O.fragLoadingRetryDelay,O.fragLoadingMaxRetryTimeout);this.warn("Fragment "+C.sn+" of "+S+" "+C.level+" failed to load, retrying in "+P+"ms"),this.retryDate=self.performance.now()+P,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else k.levelRetry?(S===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(x.logger.error(k.details+" reaches max retry, redispatch as fatal ..."),k.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}}},b.afterBufferFlushed=function(S,k,C){if(S){var I=R.BufferHelper.getBuffered(S);this.fragmentTracker.detectEvictedFragments(k,I,C),this.state===a.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},b.resetLiveStartWhenNotLoaded=function(S){if(!this.loadedmetadata){this.startFragRequested=!1;var k=this.levels?this.levels[S].details:null;if(k!=null&&k.live)return this.startPosition=-1,this.setStartPosition(k,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},b.updateLevelTiming=function(S,k,C,I){var O=this,P=C.details;console.assert(!!P,"level.details must be defined"),Object.keys(S.elementaryStreams).reduce(function(F,M){var B=S.elementaryStreams[M];if(B){var U=B.endPTS-B.startPTS;if(U<=0)return O.warn("Could not parse fragment "+S.sn+" "+M+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),O.resetTransmuxer(),F||!1;var G=I?0:Object(y.updateFragPTSDTS)(P,S,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return O.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:P,level:C,drift:G,type:M,frag:S,start:B.startPTS,end:B.endPTS}),!0}return F},!1)?(this.state=a.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:S,part:k})):this.resetLoadingState()},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=r,(c=[{key:"state",get:function(){return this._state},set:function(S){var k=this._state;k!==S&&(this._state=S,this.log(k+"->"+S))}}])&&s(i.prototype,c),r}(T.default)},"./src/controller/buffer-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return E});var _=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),L=h("./src/utils/logger.ts"),R=h("./src/errors.ts"),x=h("./src/utils/buffer-helper.ts"),D=h("./src/utils/mediasource-helper.ts"),o=h("./src/loader/fragment.ts"),A=h("./src/controller/buffer-operation-queue.ts"),m=Object(D.getMediaSource)(),f=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function y(e){var n=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=n.hls,s=n.media,d=n.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),s&&(n.updateMediaElementDuration(),t.trigger(T.Events.MEDIA_ATTACHED,{media:s})),d&&d.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var u=y.prototype;return u.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},u.destroy=function(){this.unregisterListeners(),this.details=null},u.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.Events.BUFFER_RESET,this.onBufferReset,this),e.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.Events.BUFFER_EOS,this.onBufferEos,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.Events.FRAG_PARSED,this.onFragParsed,this),e.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},u.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.Events.BUFFER_RESET,this.onBufferReset,this),e.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.Events.BUFFER_EOS,this.onBufferEos,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.Events.FRAG_PARSED,this.onFragParsed,this),e.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},u._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new A.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},u.onManifestParsed=function(e,n){var t=2;(n.audio&&!n.video||!n.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},u.onMediaAttaching=function(e,n){var t=this.media=n.media;if(t&&m){var s=this.mediaSource=new m;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(s),this._objectUrl=t.src}},u.onMediaDetaching=function(){var e=this.media,n=this.mediaSource,t=this._objectUrl;if(n){if(L.logger.log("[buffer-controller]: media source detaching"),n.readyState==="open")try{n.endOfStream()}catch(s){L.logger.warn("[buffer-controller]: onMediaDetaching: "+s.message+" while calling endOfStream")}this.onBufferReset(),n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},u.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(n){var t=e.sourceBuffer[n];try{t&&(e.removeBufferListeners(n),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[n]=void 0)}catch(s){L.logger.warn("[buffer-controller]: Failed to reset the "+n+" buffer",s)}}),this._initSourceBuffer()},u.onBufferCodecs=function(e,n){var t=this,s=this.getSourceBufferTypes().length;Object.keys(n).forEach(function(d){if(s){var a=t.tracks[d];if(a&&typeof a.buffer.changeType=="function"){var l=n[d],p=l.codec,v=l.levelCodec,g=l.container;if((a.levelCodec||a.codec).replace(f,"$1")!==(v||p).replace(f,"$1")){var r=g+";codecs="+(v||p);t.appendChangeType(d,r)}}}else t.pendingTracks[d]=n[d]}),s||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},u.appendChangeType=function(e,n){var t=this,s=this.operationQueue,d={execute:function(){var a=t.sourceBuffer[e];a&&(L.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+n),a.changeType(n)),s.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(a){L.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",a)}};s.append(d,e)},u.onBufferAppending=function(e,n){var t=this,s=this.hls,d=this.operationQueue,a=this.tracks,l=n.data,p=n.type,v=n.frag,g=n.part,r=n.chunkMeta,i=r.buffering[p],c=self.performance.now();i.start=c;var b=v.stats.buffering,S=g?g.stats.buffering:null;b.start===0&&(b.start=c),S&&S.start===0&&(S.start=c);var k=a.audio,C=p==="audio"&&r.id===1&&(k==null?void 0:k.container)==="audio/mpeg",I={execute:function(){if(i.executeStart=self.performance.now(),C){var O=t.sourceBuffer[p];if(O){var P=v.start-O.timestampOffset;Math.abs(P)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+v.start+" (delta: "+P+") sn: "+v.sn+")"),O.timestampOffset=v.start)}}t.appendExecutor(l,p)},onStart:function(){},onComplete:function(){var O=self.performance.now();i.executeEnd=i.end=O,b.first===0&&(b.first=O),S&&S.first===0&&(S.first=O);var P=t.sourceBuffer,F={};for(var M in P)F[M]=x.BufferHelper.getBuffered(P[M]);t.appendError=0,t.hls.trigger(T.Events.BUFFER_APPENDED,{type:p,frag:v,part:g,chunkMeta:r,parent:v.type,timeRanges:F})},onError:function(O){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+p+" SourceBuffer",O);var P={type:R.ErrorTypes.MEDIA_ERROR,parent:v.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?P.details=R.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,P.details=R.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>s.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+s.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),P.fatal=!0)),s.trigger(T.Events.ERROR,P)}};d.append(I,p)},u.onBufferFlushing=function(e,n){var t=this,s=this.operationQueue,d=function(a){return{execute:t.removeExecutor.bind(t,a,n.startOffset,n.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(T.Events.BUFFER_FLUSHED,{type:a})},onError:function(l){L.logger.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",l)}}};n.type?s.append(d(n.type),n.type):this.getSourceBufferTypes().forEach(function(a){s.append(d(a),a)})},u.onFragParsed=function(e,n){var t=this,s=n.frag,d=n.part,a=[],l=d?d.elementaryStreams:s.elementaryStreams;l[o.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(l[o.ElementaryStreamTypes.AUDIO]&&a.push("audio"),l[o.ElementaryStreamTypes.VIDEO]&&a.push("video")),a.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(function(){var p=self.performance.now();s.stats.buffering.end=p,d&&(d.stats.buffering.end=p);var v=d?d.stats:s.stats;t.hls.trigger(T.Events.FRAG_BUFFERED,{frag:s,part:d,stats:v,id:s.type})},a)},u.onFragChanged=function(e,n){this.flushBackBuffer()},u.onBufferEos=function(e,n){var t=this;this.getSourceBufferTypes().reduce(function(s,d){var a=t.sourceBuffer[d];return n.type&&n.type!==d||a&&!a.ended&&(a.ended=!0,L.logger.log("[buffer-controller]: "+d+" sourceBuffer now EOS")),s&&!(a&&!a.ended)},!0)&&this.blockBuffers(function(){var s=t.mediaSource;s&&s.readyState==="open"&&s.endOfStream()})},u.onLevelUpdated=function(e,n){var t=n.details;t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},u.flushBackBuffer=function(){var e=this.hls,n=this.details,t=this.media,s=this.sourceBuffer;if(t&&n!==null){var d=this.getSourceBufferTypes();if(d.length){var a=n.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(_.isFiniteNumber)(a)&&!(a<0)){var l=t.currentTime,p=n.levelTargetDuration,v=Math.max(a,p),g=Math.floor(l/p)*p-v;d.forEach(function(r){var i=s[r];if(i){var c=x.BufferHelper.getBuffered(i);c.length>0&&g>c.start(0)&&(e.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:g}),n.live&&e.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:g}),e.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:g,type:r}))}})}}}},u.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,n=this.hls,t=this.media,s=this.mediaSource,d=e.fragments[0].start+e.totalduration,a=t.duration,l=Object(_.isFiniteNumber)(s.duration)?s.duration:0;e.live&&n.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(d>l&&d>a||!Object(_.isFiniteNumber)(a))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+d.toFixed(3)),s.duration=d)}},u.updateSeekableRange=function(e){var n=this.mediaSource,t=e.fragments;if(t.length&&e.live&&n!=null&&n.setLiveSeekableRange){var s=Math.max(0,t[0].start),d=Math.max(s,s+e.totalduration);n.setLiveSeekableRange(s,d)}},u.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,n=this.operationQueue,t=this.pendingTracks,s=Object.keys(t).length;if(s&&!e||s===2){this.createSourceBuffers(t),this.pendingTracks={};var d=this.getSourceBufferTypes();if(d.length===0)return void this.hls.trigger(T.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});d.forEach(function(a){n.executeNext(a)})}},u.createSourceBuffers=function(e){var n=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var s=0;for(var d in e)if(!n[d]){var a=e[d];if(!a)throw Error("source buffer exists for track "+d+", however track does not");var l=a.levelCodec||a.codec,p=a.container+";codecs="+l;L.logger.log("[buffer-controller]: creating sourceBuffer("+p+")");try{var v=n[d]=t.addSourceBuffer(p),g=d;this.addBufferListener(g,"updatestart",this._onSBUpdateStart),this.addBufferListener(g,"updateend",this._onSBUpdateEnd),this.addBufferListener(g,"error",this._onSBUpdateError),this.tracks[d]={buffer:v,codec:l,container:a.container,levelCodec:a.levelCodec,id:a.id},s++}catch(r){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(T.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:p})}}s&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},u._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},u._onSBUpdateEnd=function(e){var n=this.operationQueue;n.current(e).onComplete(),n.shiftAndExecuteNext(e)},u._onSBUpdateError=function(e,n){L.logger.error("[buffer-controller]: "+e+" SourceBuffer error",n),this.hls.trigger(T.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(n)},u.removeExecutor=function(e,n,t){var s=this.media,d=this.mediaSource,a=this.operationQueue,l=this.sourceBuffer[e];if(!s||!d||!l)return L.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(e);var p=Object(_.isFiniteNumber)(s.duration)?s.duration:1/0,v=Object(_.isFiniteNumber)(d.duration)?d.duration:1/0,g=Math.max(0,n),r=Math.min(t,p,v);r>g?(L.logger.log("[buffer-controller]: Removing ["+g+","+r+"] from the "+e+" SourceBuffer"),console.assert(!l.updating,e+" sourceBuffer must not be updating"),l.remove(g,r)):a.shiftAndExecuteNext(e)},u.appendExecutor=function(e,n){var t=this.operationQueue,s=this.sourceBuffer[n];if(!s)return L.logger.warn("[buffer-controller]: Attempting to append to the "+n+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(n);s.ended=!1,console.assert(!s.updating,n+" sourceBuffer must not be updating"),s.appendBuffer(e)},u.blockBuffers=function(e,n){var t=this;if(n===void 0&&(n=this.getSourceBufferTypes()),!n.length)return L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var s=this.operationQueue,d=n.map(function(a){return s.appendBlocker(a)});Promise.all(d).then(function(){e(),n.forEach(function(a){var l=t.sourceBuffer[a];l&&l.updating||s.shiftAndExecuteNext(a)})})},u.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},u.addBufferListener=function(e,n,t){var s=this.sourceBuffer[e];if(s){var d=t.bind(this,e);this.listeners[e].push({event:n,listener:d}),s.addEventListener(n,d)}},u.removeBufferListeners=function(e){var n=this.sourceBuffer[e];n&&this.listeners[e].forEach(function(t){n.removeEventListener(t.event,t.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return T});var _=h("./src/utils/logger.ts"),T=function(){function L(x){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=x}var R=L.prototype;return R.append=function(x,D){var o=this.queues[D];o.push(x),o.length===1&&this.buffers[D]&&this.executeNext(D)},R.insertAbort=function(x,D){this.queues[D].unshift(x),this.executeNext(D)},R.appendBlocker=function(x){var D,o=new Promise(function(m){D=m}),A={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(A,x),o},R.executeNext=function(x){var D=this.buffers,o=this.queues,A=D[x],m=o[x];if(m.length){var f=m[0];try{f.execute()}catch(E){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),f.onError(E),A&&A.updating||(m.shift(),this.executeNext(x))}}},R.shiftAndExecuteNext=function(x){this.queues[x].shift(),this.executeNext(x)},R.current=function(x){return this.queues[x][0]},L}()},"./src/controller/cap-level-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts");function T(R,x){for(var D=0;D<x.length;D++){var o=x[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(R,o.key,o)}}var L=function(){function R(m){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=m,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var x,D,o,A=R.prototype;return A.setStreamController=function(m){this.streamController=m},A.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},A.registerListeners=function(){var m=this.hls;m.on(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.unregisterListener=function(){var m=this.hls;m.off(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.onFpsDropLevelCapping=function(m,f){R.isLevelAllowed(f.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(f.droppedLevel)},A.onMediaAttaching=function(m,f){this.media=f.media instanceof HTMLVideoElement?f.media:null},A.onManifestParsed=function(m,f){var E=this.hls;this.restrictedLevels=[],this.firstLevel=f.firstLevel,E.config.capLevelToPlayerSize&&f.video&&this.startCapping()},A.onBufferCodecs=function(m,f){this.hls.config.capLevelToPlayerSize&&f.video&&this.startCapping()},A.onMediaDetaching=function(){this.stopCapping()},A.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var f=this.hls;f.autoLevelCapping=this.getMaxLevel(m.length-1),f.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=f.autoLevelCapping}}},A.getMaxLevel=function(m){var f=this,E=this.hls.levels;if(!E.length)return-1;var y=E.filter(function(u,e){return R.isLevelAllowed(e,f.restrictedLevels)&&e<=m});return this.clientRect=null,R.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},A.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},A.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},A.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,f={width:0,height:0};if(m){var E=m.getBoundingClientRect();f.width=E.width,f.height=E.height,f.width||f.height||(f.width=E.right-E.left||m.width||0,f.height=E.bottom-E.top||m.height||0)}return this.clientRect=f,f},R.isLevelAllowed=function(m,f){return f===void 0&&(f=[]),f.indexOf(m)===-1},R.getMaxLevelByMediaSize=function(m,f,E){if(!m||!m.length)return-1;for(var y,u,e=m.length-1,n=0;n<m.length;n+=1){var t=m[n];if((t.width>=f||t.height>=E)&&(y=t,!(u=m[n+1])||y.width!==u.width||y.height!==u.height)){e=n;break}}return e},x=R,o=[{key:"contentScaleFactor",get:function(){var m=1;try{m=self.devicePixelRatio}catch{}return m}}],(D=[{key:"mediaWidth",get:function(){return this.getDimensions().width*R.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*R.contentScaleFactor}}])&&T(x.prototype,D),o&&T(x,o),R}();w.default=L},"./src/controller/eme-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),T=h("./src/errors.ts"),L=h("./src/utils/logger.ts"),R=h("./src/utils/mediakeys-helper.ts");function x(o,A){for(var m=0;m<A.length;m++){var f=A[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(o,f.key,f)}}var D=function(){function o(E){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=E,this._config=E.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var A,m,f=o.prototype;return f.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},f._registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},f._unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},f.getLicenseServerUrl=function(E){switch(E){case R.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+E+'"')},f._attemptKeySystemAccess=function(E,y,u){var e=this,n=function(s,d,a,l){switch(s){case R.KeySystems.WIDEVINE:return function(p,v,g){var r={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(i){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+i+'"',robustness:g.audioRobustness||""})}),v.forEach(function(i){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+i+'"',robustness:g.videoRobustness||""})}),[r]}(d,a,l);default:throw new Error("Unknown key-system: "+s)}}(E,y,u,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(E,n);this.mediaKeysPromise=t.then(function(s){return e._onMediaKeySystemAccessObtained(E,s)}),t.catch(function(s){L.logger.error('Failed to obtain key-system "'+E+'" access:',s)})},f._onMediaKeySystemAccessObtained=function(E,y){var u=this;L.logger.log('Access for key-system "'+E+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:y,mediaKeySystemDomain:E};this._mediaKeysList.push(e);var n=Promise.resolve().then(function(){return y.createMediaKeys()}).then(function(t){return e.mediaKeys=t,L.logger.log('Media-keys created for key-system "'+E+'"'),u._onMediaKeysCreated(),t});return n.catch(function(t){L.logger.error("Failed to create media-keys:",t)}),n},f._onMediaKeysCreated=function(){var E=this;this._mediaKeysList.forEach(function(y){y.mediaKeysSession||(y.mediaKeysSession=y.mediaKeys.createSession(),E._onNewMediaKeySession(y.mediaKeysSession))})},f._onNewMediaKeySession=function(E){var y=this;L.logger.log("New key-system session "+E.sessionId),E.addEventListener("message",function(u){y._onKeySessionMessage(E,u.message)},!1)},f._onKeySessionMessage=function(E,y){L.logger.log("Got EME message event, creating license request"),this._requestLicense(y,function(u){L.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),E.update(u)})},f.onMediaEncrypted=function(E){var y=this;if(L.logger.log('Media is encrypted using "'+E.initDataType+'" init data type'),!this.mediaKeysPromise)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var u=function(e){y._media&&(y._attemptSetMediaKeys(e),y._generateRequestWithPreferredKeySession(E.initDataType,E.initData))};this.mediaKeysPromise.then(u).catch(u)},f._attemptSetMediaKeys=function(E){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var y=this._mediaKeysList[0];if(!y||!y.mediaKeys)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(y.mediaKeys),this._hasSetMediaKeys=!0}},f._generateRequestWithPreferredKeySession=function(E,y){var u=this,e=this._mediaKeysList[0];if(!e)return L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)L.logger.warn("Key-Session already initialized but requested again");else{var n=e.mediaKeysSession;if(!n)return L.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!y)return L.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});L.logger.log('Generating key-session request for "'+E+'" init data type'),e.mediaKeysSessionInitialized=!0,n.generateRequest(E,y).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(t){L.logger.error("Error generating key-session request:",t),u.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},f._createLicenseXhr=function(E,y,u){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,E,y,u);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,e,E),n=void 0}catch(t){L.logger.error(t)}try{e.readyState||e.open("POST",E,!0),n&&n.call(this.hls,e,E)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},f._onLicenseRequestReadyStageChange=function(E,y,u,e){switch(E.readyState){case 4:if(E.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var n=E.response,t=this._licenseResponseCallback;if(t)try{n=t.call(this.hls,E,y)}catch(d){L.logger.error(d)}e(n)}else{if(L.logger.error("License Request XHR failed ("+y+"). Status: "+E.status+" ("+E.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var s=3-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(u,e)}}},f._generateLicenseRequestChallenge=function(E,y){switch(E.mediaKeySystemDomain){case R.KeySystems.WIDEVINE:return y}throw new Error("unsupported key-system: "+E.mediaKeySystemDomain)},f._requestLicense=function(E,y){L.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u)return L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var e=this.getLicenseServerUrl(u.mediaKeySystemDomain),n=this._createLicenseXhr(e,E,y);L.logger.log("Sending license request to URL: "+e);var t=this._generateLicenseRequestChallenge(u,E);n.send(t)}catch(s){L.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},f.onMediaAttached=function(E,y){if(this._emeEnabled){var u=y.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},f.onMediaDetached=function(){var E=this._media,y=this._mediaKeysList;E&&(E.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(y.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return E.setMediaKeys(null)}).catch(function(){}))},f.onManifestParsed=function(E,y){if(this._emeEnabled){var u=y.levels.map(function(n){return n.audioCodec}).filter(function(n){return!!n}),e=y.levels.map(function(n){return n.videoCodec}).filter(function(n){return!!n});this._attemptKeySystemAccess(R.KeySystems.WIDEVINE,u,e)}},A=o,(m=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&x(A.prototype,m),o}();w.default=D},"./src/controller/fps-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),T=h("./src/utils/logger.ts"),L=function(){function R(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var x=R.prototype;return x.setStreamController=function(D){this.streamController=D},x.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},x.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching)},x.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},x.onMediaAttaching=function(D,o){var A=this.hls.config;if(A.capLevelOnFPSDrop){var m=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),A.fpsDroppedMonitoringPeriod)}},x.checkFPS=function(D,o,A){var m=performance.now();if(o){if(this.lastTime){var f=m-this.lastTime,E=A-this.lastDroppedFrames,y=o-this.lastDecodedFrames,u=1e3*E/f,e=this.hls;if(e.trigger(_.Events.FPS_DROP,{currentDropped:E,currentDecoded:y,totalDroppedFrames:A}),u>0&&E>e.config.fpsDroppedMonitoringThreshold*y){var n=e.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+n),n>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=n)&&(n-=1,e.trigger(_.Events.FPS_DROP_LEVEL_CAPPING,{level:n,droppedLevel:e.currentLevel}),e.autoLevelCapping=n,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=A,this.lastDecodedFrames=o}},x.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var o=D.getVideoPlaybackQuality();this.checkFPS(D,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},R}();w.default=L},"./src/controller/fragment-finders.ts":function(N,w,h){h.r(w),h.d(w,"findFragmentByPDT",function(){return L}),h.d(w,"findFragmentByPTS",function(){return R}),h.d(w,"fragmentWithinToleranceTest",function(){return x}),h.d(w,"pdtWithinToleranceTest",function(){return D}),h.d(w,"findFragWithCC",function(){return o});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/binary-search.ts");function L(A,m,f){if(m===null||!Array.isArray(A)||!A.length||!Object(_.isFiniteNumber)(m)||m<(A[0].programDateTime||0)||m>=(A[A.length-1].endProgramDateTime||0))return null;f=f||0;for(var E=0;E<A.length;++E){var y=A[E];if(D(m,f,y))return y}return null}function R(A,m,f,E){f===void 0&&(f=0),E===void 0&&(E=0);var y=null;if(A?y=m[A.sn-m[0].sn+1]||null:f===0&&m[0].start===0&&(y=m[0]),y&&x(f,E,y)===0)return y;var u=T.default.search(m,x.bind(null,f,E));return u||y}function x(A,m,f){A===void 0&&(A=0),m===void 0&&(m=0);var E=Math.min(m,f.duration+(f.deltaPTS?f.deltaPTS:0));return f.start+f.duration-E<=A?1:f.start-E>A&&f.start?-1:0}function D(A,m,f){var E=1e3*Math.min(m,f.duration+(f.deltaPTS?f.deltaPTS:0));return(f.endProgramDateTime||0)-E>A}function o(A,m){return T.default.search(A,function(f){return f.cc<m?1:f.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(N,w,h){h.r(w),h.d(w,"FragmentState",function(){return _}),h.d(w,"FragmentTracker",function(){return x});var _,T,L=h("./src/events.ts"),R=h("./src/types/loader.ts");(T=_||(_={})).NOT_LOADED="NOT_LOADED",T.BACKTRACKED="BACKTRACKED",T.APPENDING="APPENDING",T.PARTIAL="PARTIAL",T.OK="OK";var x=function(){function A(f){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=f,this._registerListeners()}var m=A.prototype;return m._registerListeners=function(){var f=this.hls;f.on(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),f.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),f.on(L.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var f=this.hls;f.off(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),f.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),f.off(L.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(f,E){if(E===R.PlaylistLevelType.MAIN){var y=this.activeFragment,u=this.activeParts;if(!y)return null;if(u)for(var e=u.length;e--;){var n=u[e],t=n?n.end:y.appendedPTS;if(n.start<=f&&t!==void 0&&f<=t)return e>9&&(this.activeParts=u.slice(e-9)),n}else if(y.start<=f&&y.appendedPTS!==void 0&&f<=y.appendedPTS)return y}return this.getBufferedFrag(f,E)},m.getBufferedFrag=function(f,E){for(var y=this.fragments,u=Object.keys(y),e=u.length;e--;){var n=y[u[e]];if((n==null?void 0:n.body.type)===E&&n.buffered){var t=n.body;if(t.start<=f&&f<=t.end)return t}}return null},m.detectEvictedFragments=function(f,E,y){var u=this;Object.keys(this.fragments).forEach(function(e){var n=u.fragments[e];if(n)if(n.buffered){var t=n.range[f];t&&t.time.some(function(s){var d=!u.isTimeBuffered(s.startPTS,s.endPTS,E);return d&&u.removeFragment(n.body),d})}else n.body.type===y&&u.removeFragment(n.body)})},m.detectPartialFragments=function(f){var E=this,y=this.timeRanges,u=f.frag,e=f.part;if(y&&u.sn!=="initSegment"){var n=o(u),t=this.fragments[n];t&&(Object.keys(y).forEach(function(s){var d=u.elementaryStreams[s];if(d){var a=y[s],l=e!==null||d.partial===!0;t.range[s]=E.getBufferedTimes(u,e,l,a)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},m.fragBuffered=function(f){var E=o(f),y=this.fragments[E];y&&(y.backtrack=y.loaded=null,y.buffered=!0)},m.getBufferedTimes=function(f,E,y,u){for(var e={time:[],partial:y},n=E?E.start:f.start,t=E?E.end:f.end,s=f.minEndPTS||t,d=f.maxStartPTS||n,a=0;a<u.length;a++){var l=u.start(a)-this.bufferPadding,p=u.end(a)+this.bufferPadding;if(d>=l&&s<=p){e.time.push({startPTS:Math.max(n,u.start(a)),endPTS:Math.min(t,u.end(a))});break}if(n<p&&t>l)e.partial=!0,e.time.push({startPTS:Math.max(n,u.start(a)),endPTS:Math.min(t,u.end(a))});else if(t<=l)break}return e},m.getPartialFragment=function(f){var E,y,u,e=null,n=0,t=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach(function(d){var a=s[d];a&&D(a)&&(y=a.body.start-t,u=a.body.end+t,f>=y&&f<=u&&(E=Math.min(f-y,u-f),n<=E&&(e=a.body,n=E)))}),e},m.getState=function(f){var E=o(f),y=this.fragments[E];return y?y.buffered?D(y)?_.PARTIAL:_.OK:y.backtrack?_.BACKTRACKED:_.APPENDING:_.NOT_LOADED},m.backtrack=function(f,E){var y=o(f),u=this.fragments[y];if(!u||u.backtrack)return null;var e=u.backtrack=E||u.loaded;return u.loaded=null,e},m.getBacktrackData=function(f){var E=o(f),y=this.fragments[E];if(y){var u,e=y.backtrack;if(e!=null&&(u=e.payload)!==null&&u!==void 0&&u.byteLength)return e;this.removeFragment(f)}return null},m.isTimeBuffered=function(f,E,y){for(var u,e,n=0;n<y.length;n++){if(u=y.start(n)-this.bufferPadding,e=y.end(n)+this.bufferPadding,f>=u&&E<=e)return!0;if(E<=u)return!1}return!1},m.onFragLoaded=function(f,E){var y=E.frag,u=E.part;if(y.sn!=="initSegment"&&!y.bitrateTest&&!u){var e=o(y);this.fragments[e]={body:y,loaded:E,backtrack:null,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(f,E){var y=this,u=E.frag,e=E.part,n=E.timeRanges;if(u.type===R.PlaylistLevelType.MAIN)if(this.activeFragment=u,e){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(e)}else this.activeParts=null;this.timeRanges=n,Object.keys(n).forEach(function(s){var d=n[s];if(y.detectEvictedFragments(s,d),!e)for(var a=0;a<d.length;a++)u.appendedPTS=Math.max(d.end(a),u.appendedPTS||0)})},m.onFragBuffered=function(f,E){this.detectPartialFragments(E)},m.hasFragment=function(f){var E=o(f);return!!this.fragments[E]},m.removeFragmentsInRange=function(f,E,y){var u=this;Object.keys(this.fragments).forEach(function(e){var n=u.fragments[e];if(n&&n.buffered){var t=n.body;t.type===y&&t.start<E&&t.end>f&&u.removeFragment(t)}})},m.removeFragment=function(f){var E=o(f);f.stats.loaded=0,f.clearElementaryStreamInfo(),delete this.fragments[E]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function D(A){var m,f;return A.buffered&&(((m=A.range.video)===null||m===void 0?void 0:m.partial)||((f=A.range.audio)===null||f===void 0?void 0:f.partial))}function o(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(N,w,h){h.r(w),h.d(w,"STALL_MINIMUM_DURATION_MS",function(){return x}),h.d(w,"MAX_START_GAP_JUMP",function(){return D}),h.d(w,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),h.d(w,"SKIP_BUFFER_RANGE_START",function(){return A}),h.d(w,"default",function(){return m});var _=h("./src/utils/buffer-helper.ts"),T=h("./src/errors.ts"),L=h("./src/events.ts"),R=h("./src/utils/logger.ts"),x=250,D=2,o=.1,A=.05,m=function(){function f(y,u,e,n){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=u,this.fragmentTracker=e,this.hls=n}var E=f.prototype;return E.destroy=function(){this.hls=this.fragmentTracker=this.media=null},E.poll=function(y){var u=this.config,e=this.media,n=this.stalled,t=e.currentTime,s=e.seeking,d=this.seeking&&!s,a=!this.seeking&&s;if(this.seeking=s,t===y){if((a||d)&&(this.stalled=null),!e.paused&&!e.ended&&e.playbackRate!==0&&_.BufferHelper.getBuffered(e).length){var l=_.BufferHelper.bufferInfo(e,t,0),p=l.len>0,v=l.nextStart||0;if(p||v){if(s){var g=l.len>D,r=!v||v-t>D&&!this.fragmentTracker.getPartialFragment(t);if(g||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var i,c=Math.max(v,l.start||0)-t,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=!(b==null||(i=b.details)===null||i===void 0)&&i.live?2*b.details.targetduration:D;if(c>0&&c<=S)return void this._trySkipBufferHole(null)}var k=self.performance.now();if(n!==null){var C=k-n;!s&&C>=x&&this._reportStall(l.len);var I=_.BufferHelper.bufferInfo(e,t,u.maxBufferHole);this._tryFixBufferStall(I,C)}else this.stalled=k}}}else if(this.moved=!0,n!==null){if(this.stallReported){var O=self.performance.now()-n;R.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(O)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},E._tryFixBufferStall=function(y,u){var e=this.config,n=this.fragmentTracker,t=this.media.currentTime,s=n.getPartialFragment(t);s&&this._trySkipBufferHole(s)||y.len>e.maxBufferHole&&u>1e3*e.highBufferWatchdogPeriod&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},E._reportStall=function(y){var u=this.hls,e=this.media;this.stallReported||(this.stallReported=!0,R.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+y+")"),u.trigger(L.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y}))},E._trySkipBufferHole=function(y){for(var u=this.config,e=this.hls,n=this.media,t=n.currentTime,s=0,d=_.BufferHelper.getBuffered(n),a=0;a<d.length;a++){var l=d.start(a);if(t+u.maxBufferHole>=s&&t<l){var p=Math.max(l+A,n.currentTime+o);return R.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+p),this.moved=!0,this.stalled=null,n.currentTime=p,y&&e.trigger(L.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+p,frag:y}),p}s=d.end(a)}return 0},E._tryNudgeBuffer=function(){var y=this.config,u=this.hls,e=this.media,n=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<y.nudgeMaxRetry){var s=n+t*y.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+n+" to "+s),e.currentTime=s,u.trigger(L.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+y.nudgeMaxRetry+" nudges"),u.trigger(L.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},f}()},"./src/controller/id3-track-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),T=h("./src/utils/texttrack-utils.ts"),L=h("./src/demux/id3.ts"),R=function(){function x(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var D=x.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var o=this.hls;o.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var o=this.hls;o.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(o,A){this.media=A.media},D.onMediaDetaching=function(){this.id3Track&&(Object(T.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(o){if(this.media){for(var A=0;A<o.length;A++){var m=o[A];if(m.kind==="metadata"&&m.label==="id3")return Object(T.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(o,A){if(this.media){var m=A.frag,f=A.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var E=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,y=0;y<f.length;y++){var u=L.getID3Frames(f[y].data);if(u){var e=f[y].pts,n=y<f.length-1?f[y+1].pts:m.end;n-e<=0&&(n=e+.25);for(var t=0;t<u.length;t++){var s=u[t];if(!L.isTimeStampFrame(s)){var d=new E(e,n,"");d.value=s,this.id3Track.addCue(d)}}}}}},D.onBufferFlushing=function(o,A){var m=A.startOffset,f=A.endOffset,E=A.type;if(!E||E==="audio"){var y=this.id3Track;y&&Object(T.removeCuesInRange)(y,m,f)}},x}();w.default=R},"./src/controller/latency-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return x});var _=h("./src/errors.ts"),T=h("./src/events.ts"),L=h("./src/utils/logger.ts");function R(D,o){for(var A=0;A<o.length;A++){var m=o[A];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(D,m.key,m)}}var x=function(){function D(f){var E=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return E.timeupdate()},this.hls=f,this.config=f.config,this.registerListeners()}var o,A,m=D.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},m.onMediaAttached=function(f,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(f,E){var y=E.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(f,E){E.details===_.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var f=this.media,E=this.levelDetails;if(f&&E){this.currentTime=f.currentTime;var y=this.computeLatency();if(y!==null){this._latency=y;var u=this.config,e=u.lowLatencyMode,n=u.maxLiveSyncPlaybackRate;if(e&&n!==1){var t=this.targetLatency;if(t!==null){var s=y-t,d=s<Math.min(this.maxLatency,t+E.targetduration);if(E.live&&d&&s>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,n)),l=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;f.playbackRate=Math.min(a,Math.max(1,l))}else f.playbackRate!==1&&f.playbackRate!==0&&(f.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var f=this.levelDetails;return f===null?null:f.edge+f.age},m.computeLatency=function(){var f=this.estimateLiveEdge();return f===null?null:f-this.currentTime},o=D,(A=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var f=this.config,E=this.levelDetails;return f.liveMaxLatencyDuration!==void 0?f.liveMaxLatencyDuration:E?f.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var f=this.levelDetails;if(f===null)return null;var E=f.holdBack,y=f.partHoldBack,u=f.targetduration,e=this.config,n=e.liveSyncDuration,t=e.liveSyncDurationCount,s=e.lowLatencyMode,d=this.hls.userConfig,a=s&&y||E;(d.liveSyncDuration||d.liveSyncDurationCount||a===0)&&(a=n!==void 0?n:t*u);var l=u;return a+Math.min(1*this.stallCount,l)}},{key:"liveSyncPosition",get:function(){var f=this.estimateLiveEdge(),E=this.targetLatency,y=this.levelDetails;if(f===null||E===null||y===null)return null;var u=y.edge,e=f-E-this.edgeStalled,n=u-y.totalduration,t=u-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(n,e),t)}},{key:"drift",get:function(){var f=this.levelDetails;return f===null?1:f.drift}},{key:"edgeStalled",get:function(){var f=this.levelDetails;if(f===null)return 0;var E=3*(this.config.lowLatencyMode&&f.partTarget||f.targetduration);return Math.max(f.age-E,0)}},{key:"forwardBufferLength",get:function(){var f=this.media,E=this.levelDetails;if(!f||!E)return 0;var y=f.buffered.length;return y?f.buffered.end(y-1):E.edge-this.currentTime}}])&&R(o.prototype,A),D}()},"./src/controller/level-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return y});var _=h("./src/types/level.ts"),T=h("./src/events.ts"),L=h("./src/errors.ts"),R=h("./src/utils/codecs.ts"),x=h("./src/controller/level-helper.ts"),D=h("./src/controller/base-playlist-controller.ts"),o=h("./src/types/loader.ts");function A(){return(A=Object.assign||function(u){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(u[t]=n[t])}return u}).apply(this,arguments)}function m(u,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(u,t.key,t)}}function f(u,e){return(f=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(u,e)}var E=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),y=function(u){var e,n;function t(l){var p;return(p=u.call(this,l,"[level-controller]")||this)._levels=[],p._firstLevel=-1,p._startLevel=void 0,p.currentLevelIndex=-1,p.manualLevelIndex=-1,p.onParsedComplete=void 0,p._registerListeners(),p}n=u,(e=t).prototype=Object.create(n.prototype),e.prototype.constructor=e,f(e,n);var s,d,a=t.prototype;return a._registerListeners=function(){var l=this.hls;l.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(T.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var l=this.hls;l.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(T.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(l){l.loadError=0}),u.prototype.startLoad.call(this)},a.onManifestLoaded=function(l,p){var v,g,r=[],i=[],c=[],b={},S=!1,k=!1,C=!1;if(p.levels.forEach(function(F){var M=F.attrs;S=S||!(!F.width||!F.height),k=k||!!F.videoCodec,C=C||!!F.audioCodec,E&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var B=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;(g=b[B])?g.url.push(F.url):(g=new _.Level(F),b[B]=g,r.push(g)),M&&(M.AUDIO&&Object(x.addGroupId)(g,"audio",M.AUDIO),M.SUBTITLES&&Object(x.addGroupId)(g,"text",M.SUBTITLES))}),(S||k)&&C&&(r=r.filter(function(F){var M=F.videoCodec,B=F.width,U=F.height;return!!M||!(!B||!U)})),r=r.filter(function(F){var M=F.audioCodec,B=F.videoCodec;return(!M||Object(R.isCodecSupportedInMp4)(M,"audio"))&&(!B||Object(R.isCodecSupportedInMp4)(B,"video"))}),p.audioTracks&&(i=p.audioTracks.filter(function(F){return!F.audioCodec||Object(R.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(x.assignTrackIdsByGroup)(i)),p.subtitles&&(c=p.subtitles,Object(x.assignTrackIdsByGroup)(c)),r.length>0){v=r[0].bitrate,r.sort(function(F,M){return F.bitrate-M.bitrate}),this._levels=r;for(var I=0;I<r.length;I++)if(r[I].bitrate===v){this._firstLevel=I,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+v);break}var O=C&&!k,P={levels:r,audioTracks:i,subtitleTracks:c,firstLevel:this._firstLevel,stats:p.stats,audio:C,video:k,altAudio:!O&&i.some(function(F){return!!F.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,P),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:p.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(l,p){if(u.prototype.onError.call(this,l,p),!p.fatal){var v=p.context,g=this._levels[this.currentLevelIndex];if(v&&(v.type===o.PlaylistContextType.AUDIO_TRACK&&g.audioGroupIds&&v.groupId===g.audioGroupIds[g.urlId]||v.type===o.PlaylistContextType.SUBTITLE_TRACK&&g.textGroupIds&&v.groupId===g.textGroupIds[g.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,i=!1,c=!0;switch(p.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(p.frag){var b=this._levels[p.frag.level];b?(b.fragmentError++,b.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=p.frag.level)):r=p.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:v&&(v.deliveryDirectives&&(c=!1),r=v.level),i=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:r=p.level,i=!0}r!==void 0&&this.recoverLevel(p,r,i,c)}}},a.recoverLevel=function(l,p,v,g){var r=l.details,i=this._levels[p];if(i.loadError++,v){if(!this.retryLoadingOrFail(l))return void(this.currentLevelIndex=-1);l.levelRetry=!0}if(g){var c=i.url.length;if(c>1&&i.loadError<c)l.levelRetry=!0,this.redundantFailover(p);else if(this.manualLevelIndex===-1){var b=p===0?this._levels.length-1:p-1;this.currentLevelIndex!==b&&this._levels[b].loadError===0&&(this.warn(r+": switch to "+b),l.levelRetry=!0,this.hls.nextAutoLevel=b)}}},a.redundantFailover=function(l){var p=this._levels[l],v=p.url.length;if(v>1){var g=(p.urlId+1)%v;this.warn("Switching to redundant URL-id "+g),this._levels.forEach(function(r){r.urlId=g}),this.level=l}},a.onFragLoaded=function(l,p){var v=p.frag;if(v!==void 0&&v.type===o.PlaylistLevelType.MAIN){var g=this._levels[v.level];g!==void 0&&(g.fragmentError=0,g.loadError=0)}},a.onLevelLoaded=function(l,p){var v,g,r=p.level,i=p.details,c=this._levels[r];if(!c)return this.warn("Invalid level index "+r),void((g=p.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(i.deltaUpdateFailed=!0));r===this.currentLevelIndex?(c.fragmentError===0&&(c.loadError=0,this.retryCount=0),this.playlistLoaded(r,p,c.details)):(v=p.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(i.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(l,p){var v=this.hls.levels[this.currentLevelIndex];if(v&&v.audioGroupIds){for(var g=-1,r=this.hls.audioTracks[p.id].groupId,i=0;i<v.audioGroupIds.length;i++)if(v.audioGroupIds[i]===r){g=i;break}g!==v.urlId&&(v.urlId=g,this.startLoad())}},a.loadPlaylist=function(l){var p=this.currentLevelIndex,v=this._levels[p];if(this.canLoad&&v&&v.url.length>0){var g=v.urlId,r=v.url[g];if(l)try{r=l.addDirectives(r)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Attempt loading level index "+p+(l?" at sn "+l.msn+" part "+l.part:"")+" with URL-id "+g+" "+r),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:r,level:p,id:g,deliveryDirectives:l||null})}},a.removeLevel=function(l,p){var v=function(r,i){return i!==p},g=this._levels.filter(function(r,i){return i!==l||r.url.length>1&&p!==void 0&&(r.url=r.url.filter(v),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(v)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(v)),r.urlId=0,!0)}).map(function(r,i){var c=r.details;return c!=null&&c.fragments&&c.fragments.forEach(function(b){b.level=i}),r});this._levels=g,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:g})},s=t,(d=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(l){var p,v=this._levels;if(v.length!==0&&(this.currentLevelIndex!==l||(p=v[l])===null||p===void 0||!p.details)){if(l<0||l>=v.length){var g=l<0;if(this.hls.trigger(T.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:l,fatal:g,reason:"invalid level idx"}),g)return;l=Math.min(l,v.length-1)}this.clearTimer();var r=this.currentLevelIndex,i=v[r],c=v[l];this.log("switching to level "+l+" from "+r),this.currentLevelIndex=l;var b=A({},c,{level:l,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete b._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,b);var S=c.details;if(!S||S.live){var k=this.switchParams(c.uri,i==null?void 0:i.details);this.loadPlaylist(k)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(l){this.manualLevelIndex=l,this._startLevel===void 0&&(this._startLevel=l),l!==-1&&(this.level=l)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(l){this._firstLevel=l}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var l=this.hls.config.startLevel;return l!==void 0?l:this._firstLevel}return this._startLevel},set:function(l){this._startLevel=l}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(l){this.level=l,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=l)}}])&&m(s.prototype,d),t}(D.default)},"./src/controller/level-helper.ts":function(N,w,h){h.r(w),h.d(w,"addGroupId",function(){return L}),h.d(w,"assignTrackIdsByGroup",function(){return R}),h.d(w,"updatePTS",function(){return x}),h.d(w,"updateFragPTSDTS",function(){return o}),h.d(w,"mergeDetails",function(){return A}),h.d(w,"mapPartIntersection",function(){return m}),h.d(w,"mapFragmentIntersection",function(){return f}),h.d(w,"adjustSliding",function(){return E}),h.d(w,"addSliding",function(){return y}),h.d(w,"computeReloadInterval",function(){return u}),h.d(w,"getFragmentWithSN",function(){return e}),h.d(w,"getPartWith",function(){return n});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/logger.ts");function L(t,s,d){switch(s){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(d);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(d)}}function R(t){var s={};t.forEach(function(d){var a=d.groupId||"";d.id=s[a]=s[a]||0,s[a]++})}function x(t,s,d){D(t[s],t[d])}function D(t,s){var d=s.startPTS;if(Object(_.isFiniteNumber)(d)){var a,l=0;s.sn>t.sn?(l=d-t.start,a=t):(l=t.start-d,a=s),a.duration!==l&&(a.duration=l)}else s.sn>t.sn?t.cc===s.cc&&t.minEndPTS?s.start=t.start+(t.minEndPTS-t.start):s.start=t.start+t.duration:s.start=Math.max(t.start-s.duration,0)}function o(t,s,d,a,l,p){a-d<=0&&(T.logger.warn("Fragment should have a positive duration",s),a=d+s.duration,p=l+s.duration);var v=d,g=a,r=s.startPTS,i=s.endPTS;if(Object(_.isFiniteNumber)(r)){var c=Math.abs(r-d);Object(_.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(c,s.deltaPTS):s.deltaPTS=c,v=Math.max(d,r),d=Math.min(d,r),l=Math.min(l,s.startDTS),g=Math.min(a,i),a=Math.max(a,i),p=Math.max(p,s.endDTS)}s.duration=a-d;var b=d-s.start;s.appendedPTS=a,s.start=s.startPTS=d,s.maxStartPTS=v,s.startDTS=l,s.endPTS=a,s.minEndPTS=g,s.endDTS=p;var S,k=s.sn;if(!t||k<t.startSN||k>t.endSN)return 0;var C=k-t.startSN,I=t.fragments;for(I[C]=s,S=C;S>0;S--)D(I[S],I[S-1]);for(S=C;S<I.length-1;S++)D(I[S],I[S+1]);return t.fragmentHint&&D(I[I.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,b}function A(t,s){for(var d=null,a=t.fragments,l=a.length-1;l>=0;l--){var p=a[l].initSegment;if(p){d=p;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var v,g=0;if(f(t,s,function(k,C){var I;k.relurl&&(g=k.cc-C.cc),Object(_.isFiniteNumber)(k.startPTS)&&Object(_.isFiniteNumber)(k.endPTS)&&(C.start=C.startPTS=k.startPTS,C.startDTS=k.startDTS,C.appendedPTS=k.appendedPTS,C.maxStartPTS=k.maxStartPTS,C.endPTS=k.endPTS,C.endDTS=k.endDTS,C.minEndPTS=k.minEndPTS,C.duration=k.endPTS-k.startPTS,C.duration&&(v=C),s.PTSKnown=s.alignedSliding=!0),C.elementaryStreams=k.elementaryStreams,C.loader=k.loader,C.stats=k.stats,C.urlId=k.urlId,k.initSegment?(C.initSegment=k.initSegment,d=k.initSegment):C.initSegment&&C.initSegment.relurl!=((I=d)===null||I===void 0?void 0:I.relurl)||(C.initSegment=d)}),s.skippedSegments&&(s.deltaUpdateFailed=s.fragments.some(function(k){return!k}),s.deltaUpdateFailed)){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=s.skippedSegments;r--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}var i=s.fragments;if(g){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<i.length;c++)i[c].cc+=g}s.skippedSegments&&(s.startCC=s.fragments[0].cc),m(t.partList,s.partList,function(k,C){C.elementaryStreams=k.elementaryStreams,C.stats=k.stats}),v?o(s,v,v.startPTS,v.endPTS,v.startDTS,v.endDTS):E(t,s),i.length&&(s.totalduration=s.edge-i[0].start),s.driftStartTime=t.driftStartTime,s.driftStart=t.driftStart;var b=s.advancedDateTime;if(s.advanced&&b){var S=s.edge;s.driftStart||(s.driftStartTime=b,s.driftStart=S),s.driftEndTime=b,s.driftEnd=S}else s.driftEndTime=t.driftEndTime,s.driftEnd=t.driftEnd,s.advancedDateTime=t.advancedDateTime}function m(t,s,d){if(t&&s)for(var a=0,l=0,p=t.length;l<=p;l++){var v=t[l],g=s[l+a];v&&g&&v.index===g.index&&v.fragment.sn===g.fragment.sn?d(v,g):a--}}function f(t,s,d){for(var a=s.skippedSegments,l=Math.max(t.startSN,s.startSN)-s.startSN,p=(t.fragmentHint?1:0)+(a?s.endSN:Math.min(t.endSN,s.endSN))-s.startSN,v=s.startSN-t.startSN,g=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,i=l;i<=p;i++){var c=r[v+i],b=g[i];a&&!b&&i<a&&(b=s.fragments[i]=c),c&&b&&d(c,b)}}function E(t,s){var d=s.startSN+s.skippedSegments-t.startSN,a=t.fragments;d<0||d>=a.length||y(s,a[d].start)}function y(t,s){if(s){for(var d=t.fragments,a=t.skippedSegments;a<d.length;a++)d[a].start+=s;t.fragmentHint&&(t.fragmentHint.start+=s)}}function u(t,s){var d,a=1e3*t.levelTargetDuration,l=a/2,p=t.age,v=p>0&&p<3*a,g=s.loading.end-s.loading.start,r=t.availabilityDelay;if(t.updated===!1)if(v){var i=333*t.misses;d=Math.max(Math.min(l,2*g),i),t.availabilityDelay=(t.availabilityDelay||0)+d}else d=l;else v?(r=Math.min(r||a/2,p),t.availabilityDelay=r,d=r+a-p):d=a-g;return Math.round(d)}function e(t,s,d){if(!t||!t.details)return null;var a=t.details,l=a.fragments[s-a.startSN];return l||((l=a.fragmentHint)&&l.sn===s?l:s<a.startSN&&d&&d.sn===s?d:null)}function n(t,s,d){if(!t||!t.details)return null;var a=t.details.partList;if(a)for(var l=a.length;l--;){var p=a[l];if(p.index===d&&p.fragment.sn===s)return p}return null}},"./src/controller/stream-controller.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return t});var _=h("./src/polyfills/number.ts"),T=h("./src/controller/base-stream-controller.ts"),L=h("./src/is-supported.ts"),R=h("./src/events.ts"),x=h("./src/utils/buffer-helper.ts"),D=h("./src/controller/fragment-tracker.ts"),o=h("./src/types/loader.ts"),A=h("./src/loader/fragment.ts"),m=h("./src/demux/transmuxer-interface.ts"),f=h("./src/types/transmuxer.ts"),E=h("./src/controller/gap-controller.ts"),y=h("./src/errors.ts"),u=h("./src/utils/logger.ts");function e(s,d){for(var a=0;a<d.length;a++){var l=d[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}function n(s,d){return(n=Object.setPrototypeOf||function(a,l){return a.__proto__=l,a})(s,d)}var t=function(s){var d,a;function l(r,i){var c;return(c=s.call(this,r,i,"[stream-controller]")||this).audioCodecSwap=!1,c.gapController=null,c.level=-1,c._forceStartLoad=!1,c.altAudio=!1,c.audioOnly=!1,c.fragPlaying=null,c.onvplaying=null,c.onvseeked=null,c.fragLastKbps=0,c.stalled=!1,c.couldBacktrack=!1,c.audioCodecSwitch=!1,c.videoBuffer=null,c._registerListeners(),c}a=s,(d=l).prototype=Object.create(a.prototype),d.prototype.constructor=d,n(d,a);var p,v,g=l.prototype;return g._registerListeners=function(){var r=this.hls;r.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(R.Events.ERROR,this.onError,this),r.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g._unregisterListeners=function(){var r=this.hls;r.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(R.Events.ERROR,this.onError,this),r.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},g.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},g.startLoad=function(r){if(this.levels){var i=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=c.startLevel;b===-1&&(c.config.testBandwidth?(b=0,this.bitrateTest=!0):b=c.nextAutoLevel),this.level=c.nextLoadLevel=b,this.loadedmetadata=!1}i>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),r=i),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},g.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},g.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:var r,i=this.levels,c=this.level,b=i==null||(r=i[c])===null||r===void 0?void 0:r.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=T.State.IDLE;break}break;case T.State.FRAG_LOADING_WAITING_RETRY:var S,k=self.performance.now(),C=this.retryDate;(!C||k>=C||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE)}this.onTickEnd()},g.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},g.doTickIdle=function(){var r,i,c=this.hls,b=this.levelLastLoaded,S=this.levels,k=this.media,C=c.config,I=c.nextLoadLevel;if(b!==null&&(k||!this.startFragRequested&&C.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&S&&S[I]){var O=S[I];this.level=c.nextLoadLevel=I;var P=O.details;if(!P||this.state===T.State.WAITING_LEVEL||P.live&&this.levelLastLoaded!==I)this.state=T.State.WAITING_LEVEL;else{var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:k,o.PlaylistLevelType.MAIN);if(F!==null&&!(F.len>=this.getMaxBufferLength(O.maxBitrate))){if(this._streamEnded(F,P)){var M={};return this.altAudio&&(M.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,M),void(this.state=T.State.ENDED)}var B=F.end,U=this.getNextFragment(B,P);if(this.couldBacktrack&&!this.fragPrevious&&U&&U.sn!=="initSegment"){var G=U.sn-P.startSN;G>1&&(U=P.fragments[G-1],this.fragmentTracker.removeFragment(U))}if(U&&this.fragmentTracker.getState(U)===D.FragmentState.OK&&this.nextLoadPosition>B){var K=this.audioOnly&&!this.altAudio?A.ElementaryStreamTypes.AUDIO:A.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(k,K,o.PlaylistLevelType.MAIN),U=this.getNextFragment(this.nextLoadPosition,P)}U&&(!U.initSegment||U.initSegment.data||this.bitrateTest||(U=U.initSegment),((r=U.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(i=U.decryptdata)!==null&&i!==void 0&&i.key?this.loadFragment(U,P,B):this.loadKey(U,P))}}}},g.loadFragment=function(r,i,c){var b,S=this.fragmentTracker.getState(r);if(this.fragCurrent=r,S===D.FragmentState.BACKTRACKED){var k=this.fragmentTracker.getBacktrackData(r);if(k)return this._handleFragmentLoadProgress(k),void this._handleFragmentLoadComplete(k);S=D.FragmentState.NOT_LOADED}S===D.FragmentState.NOT_LOADED||S===D.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,r,i,c)):S===D.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((b=this.media)===null||b===void 0?void 0:b.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},g.getAppendedFrag=function(r){var i=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return i&&"fragment"in i?i.fragment:i},g.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},g.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},g.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},g.nextLevelSwitch=function(){var r=this.levels,i=this.media;if(i!=null&&i.readyState){var c,b=this.getAppendedFrag(i.currentTime);if(b&&b.start>1&&this.flushMainBuffer(0,b.start-1),!i.paused&&r){var S=r[this.hls.nextLoadLevel],k=this.fragLastKbps;c=k&&this.fragCurrent?this.fragCurrent.duration*S.maxBitrate/(1e3*k)+1:0}else c=0;var C=this.getBufferedFrag(i.currentTime+c);if(C){var I=this.followingBufferedFrag(C);if(I){this.abortCurrentFrag();var O=I.maxStartPTS?I.maxStartPTS:I.start,P=I.duration,F=Math.max(C.end,O+Math.min(Math.max(P-this.config.maxFragLookUpTolerance,.5*P),.75*P));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},g.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},g.flushMainBuffer=function(r,i){s.prototype.flushMainBuffer.call(this,r,i,this.altAudio?"video":null)},g.onMediaAttached=function(r,i){s.prototype.onMediaAttached.call(this,r,i);var c=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,c,this.fragmentTracker,this.hls)},g.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},g.onMediaPlaying=function(){this.tick()},g.onMediaSeeked=function(){var r=this.media,i=r?r.currentTime:null;Object(_.isFiniteNumber)(i)&&this.log("Media seeked to "+i.toFixed(3)),this.tick()},g.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},g.onManifestParsed=function(r,i){var c,b=!1,S=!1;i.levels.forEach(function(k){(c=k.audioCodec)&&(c.indexOf("mp4a.40.2")!==-1&&(b=!0),c.indexOf("mp4a.40.5")!==-1&&(S=!0))}),this.audioCodecSwitch=b&&S&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},g.onLevelLoading=function(r,i){var c=this.levels;if(c&&this.state===T.State.IDLE){var b=c[i.level];(!b.details||b.details.live&&this.levelLastLoaded!==i.level||this.waitForCdnTuneIn(b.details))&&(this.state=T.State.WAITING_LEVEL)}},g.onLevelLoaded=function(r,i){var c,b=this.levels,S=i.level,k=i.details,C=k.totalduration;if(b){this.log("Level "+S+" loaded ["+k.startSN+","+k.endSN+"], cc ["+k.startCC+", "+k.endCC+"] duration:"+C);var I=this.fragCurrent;!I||this.state!==T.State.FRAG_LOADING&&this.state!==T.State.FRAG_LOADING_WAITING_RETRY||I.level!==i.level&&I.loader&&(this.state=T.State.IDLE,I.loader.abort());var O=b[S],P=0;if(k.live||(c=O.details)!==null&&c!==void 0&&c.live){if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed)return;P=this.alignPlaylists(k,O.details)}if(O.details=k,this.levelLastLoaded=S,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:k,level:S}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(k))return;this.state=T.State.IDLE}this.startFragRequested?k.live&&this.synchronizeToLiveEdge(k):this.setStartPosition(k,P),this.tick()}else this.warn("Levels were reset while loading level "+S)},g._handleFragmentLoadProgress=function(r){var i,c=r.frag,b=r.part,S=r.payload,k=this.levels;if(k){var C=k[c.level],I=C.details;if(I){var O=C.videoCodec,P=I.PTSKnown||!I.live,F=(i=c.initSegment)===null||i===void 0?void 0:i.data,M=this._getAudioCodec(C),B=this.transmuxer=this.transmuxer||new m.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=b?b.index:-1,G=U!==-1,K=new f.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,S.byteLength,U,G),H=this.initPTS[c.cc];B.push(S,F,M,O,c,b,I.totalduration,P,K,H)}else this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},g.onAudioTrackSwitching=function(r,i){var c=this.altAudio,b=!!i.url,S=i.id;if(!b){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var k=this.fragCurrent;k!=null&&k.loader&&(this.log("Switching to main audio track, cancel main fragment load"),k.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var C=this.hls;c&&C.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),C.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:S})}},g.onAudioTrackSwitched=function(r,i){var c=i.id,b=!!this.hls.audioTracks[c].url;if(b){var S=this.videoBuffer;S&&this.mediaBuffer!==S&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=S)}this.altAudio=b,this.tick()},g.onBufferCreated=function(r,i){var c,b,S=i.tracks,k=!1;for(var C in S){var I=S[C];if(I.id==="main"){if(b=C,c=I,C==="video"){var O=S[C];O&&(this.videoBuffer=O.buffer)}}else k=!0}k&&c?(this.log("Alternate track found, use "+b+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},g.onFragBuffered=function(r,i){var c=i.frag,b=i.part;if(!c||c.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(c))return this.warn("Fragment "+c.sn+(b?" p: "+b.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===T.State.PARSED&&(this.state=T.State.IDLE));var S=b?b.stats:c.stats;this.fragLastKbps=Math.round(8*S.total/(S.buffering.end-S.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,b)}},g.onError=function(r,i){switch(i.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,i);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(i.fatal?(this.warn(""+i.details),this.state=T.State.ERROR):i.levelRetry||this.state!==T.State.WAITING_LEVEL||(this.state=T.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var c=!0,b=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);b&&b.len>.5&&(c=!this.reduceMaxBufferLength(b.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},g.checkBuffer=function(){var r=this.media,i=this.gapController;if(r&&i&&r.readyState){var c=x.BufferHelper.getBuffered(r);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):i.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},g.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},g.onBufferFlushed=function(r,i){var c=i.type;if(c!==A.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var b=(c===A.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(b,c,o.PlaylistLevelType.MAIN)}},g.onLevelsUpdated=function(r,i){this.levels=i.levels},g.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},g.seekToStartPos=function(){var r=this.media,i=r.currentTime,c=this.startPosition;if(c>=0&&i<c){if(r.seeking)return void u.logger.log("could not seek to "+c+", already seeking at "+i);var b=x.BufferHelper.getBuffered(r),S=(b.length?b.start(0):0)-c;S>0&&S<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+S+" to match buffer start"),c+=S,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+i),r.currentTime=c}},g._getAudioCodec=function(r){var i=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i=i.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),i},g._loadBitrateTestFrag=function(r){var i=this;this._doFragLoad(r).then(function(c){var b=i.hls;if(c&&!b.nextLoadLevel&&!i.fragContextChanged(r)){i.fragLoadError=0,i.state=T.State.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var S=r.stats;S.parsing.start=S.parsing.end=S.buffering.start=S.buffering.end=self.performance.now(),b.trigger(R.Events.FRAG_LOADED,c)}})},g._handleTransmuxComplete=function(r){var i,c="main",b=this.hls,S=r.remuxResult,k=r.chunkMeta,C=this.getCurrentContext(k);if(!C)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var I=C.frag,O=C.part,P=C.level,F=S.video,M=S.text,B=S.id3,U=S.initSegment,G=this.altAudio?void 0:S.audio;if(!this.fragContextChanged(I)){if(this.state=T.State.PARSING,U){U.tracks&&(this._bufferInitSegment(P,U.tracks,I,k),b.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:c,tracks:U.tracks}));var K=U.initPTS,H=U.timescale;Object(_.isFiniteNumber)(K)&&(this.initPTS[I.cc]=K,b.trigger(R.Events.INIT_PTS_FOUND,{frag:I,id:c,initPTS:K,timescale:H}))}if(F&&S.independent!==!1){if(P.details){var q=F.startPTS,W=F.endPTS,Y=F.startDTS,Z=F.endDTS;if(O)O.elementaryStreams[F.type]={startPTS:q,endPTS:W,startDTS:Y,endDTS:Z};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){if(this.getLoadPosition()+this.config.maxBufferHole<q)return void this.backtrack(I);I.setElementaryStreamInfo(F.type,I.start,W,I.start,Z,!0)}I.setElementaryStreamInfo(F.type,q,W,Y,Z),this.bufferFragmentData(F,I,O,k)}}else if(S.independent===!1)return void this.backtrack(I);if(G){var ee=G.startPTS,re=G.endPTS,X=G.startDTS,ne=G.endDTS;O&&(O.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:ee,endPTS:re,startDTS:X,endDTS:ne}),I.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,ee,re,X,ne),this.bufferFragmentData(G,I,O,k)}if(B!=null&&(i=B.samples)!==null&&i!==void 0&&i.length){var z={frag:I,id:c,samples:B.samples};b.trigger(R.Events.FRAG_PARSING_METADATA,z)}if(M){var $={frag:I,id:c,samples:M.samples};b.trigger(R.Events.FRAG_PARSING_USERDATA,$)}}},g._bufferInitSegment=function(r,i,c,b){var S=this;if(this.state===T.State.PARSING){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var k=i.audio,C=i.video,I=i.audiovideo;if(k){var O=r.audioCodec,P=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(O&&(O=O.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),k.metadata.channelCount!==1&&P.indexOf("firefox")===-1&&(O="mp4a.40.5")),P.indexOf("android")!==-1&&k.container!=="audio/mpeg"&&(O="mp4a.40.2",this.log("Android: force audio codec to "+O)),r.audioCodec&&r.audioCodec!==O&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+O+'"'),k.levelCodec=O,k.id="main",this.log("Init audio buffer, container:"+k.container+", codecs[selected/level/parsed]=["+(O||"")+"/"+(r.audioCodec||"")+"/"+k.codec+"]")}C&&(C.levelCodec=r.videoCodec,C.id="main",this.log("Init video buffer, container:"+C.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+C.codec+"]")),I&&this.log("Init audiovideo buffer, container:"+I.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+I.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,i),Object.keys(i).forEach(function(F){var M=i[F].initSegment;M!=null&&M.byteLength&&S.hls.trigger(R.Events.BUFFER_APPENDING,{type:F,data:M,frag:c,part:null,chunkMeta:b,parent:c.type})}),this.tick()}},g.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var i=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,i?this.resetFragmentLoading(r):this.state=T.State.BACKTRACKING},g.checkFragmentChanged=function(){var r=this.media,i=null;if(r&&r.readyState>1&&r.seeking===!1){var c=r.currentTime;if(x.BufferHelper.isBuffered(r,c)?i=this.getAppendedFrag(c):x.BufferHelper.isBuffered(r,c+.1)&&(i=this.getAppendedFrag(c+.1)),i){var b=this.fragPlaying,S=i.level;b&&i.sn===b.sn&&b.level===S&&i.urlId===b.urlId||(this.hls.trigger(R.Events.FRAG_CHANGED,{frag:i}),b&&b.level===S||this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:S}),this.fragPlaying=i)}}},p=l,(v=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var i=this.getAppendedFrag(r.currentTime);if(i)return i.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var i=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(i)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&e(p.prototype,v),l}(T.default)},"./src/controller/subtitle-stream-controller.ts":function(N,w,h){h.r(w),h.d(w,"SubtitleStreamController",function(){return u});var _=h("./src/events.ts"),T=h("./src/utils/logger.ts"),L=h("./src/utils/buffer-helper.ts"),R=h("./src/controller/fragment-finders.ts"),x=h("./src/utils/discontinuities.ts"),D=h("./src/controller/level-helper.ts"),o=h("./src/controller/fragment-tracker.ts"),A=h("./src/controller/base-stream-controller.ts"),m=h("./src/types/loader.ts"),f=h("./src/types/level.ts");function E(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function y(e,n){return(y=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t})(e,n)}var u=function(e){var n,t;function s(p,v){var g;return(g=e.call(this,p,v,"[subtitle-stream-controller]")||this).levels=[],g.currentTrackId=-1,g.tracksBuffered=[],g.mainDetails=null,g._registerListeners(),g}t=e,(n=s).prototype=Object.create(t.prototype),n.prototype.constructor=n,y(n,t);var d,a,l=s.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var p=this.hls;p.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.on(_.Events.ERROR,this.onError,this),p.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.on(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var p=this.hls;p.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.off(_.Events.ERROR,this.onError,this),p.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.off(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.off(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(500),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(p,v){this.mainDetails=v.details},l.onSubtitleFragProcessed=function(p,v){var g=v.frag,r=v.success;if(this.fragPrevious=g,this.state=A.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var c,b=g.start,S=0;S<i.length;S++)if(b>=i[S].start&&b<=i[S].end){c=i[S];break}var k=g.start+g.duration;c?c.end=k:(c={start:b,end:k},i.push(c)),this.fragmentTracker.fragBuffered(g)}}},l.onBufferFlushing=function(p,v){var g=v.startOffset,r=v.endOffset;if(g===0&&r!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,c=this.levels;if(!c.length||!c[i]||!c[i].details)return;var b=r-c[i].details.targetduration;if(b<=0)return;v.endOffsetSubtitles=Math.max(0,b),this.tracksBuffered.forEach(function(S){for(var k=0;k<S.length;)if(S[k].end<=b)S.shift();else{if(!(S[k].start<b))break;S[k].start=b,k++}}),this.fragmentTracker.removeFragmentsInRange(g,b,m.PlaylistLevelType.SUBTITLE)}},l.onError=function(p,v){var g,r=v.frag;r&&r.type===m.PlaylistLevelType.SUBTITLE&&((g=this.fragCurrent)!==null&&g!==void 0&&g.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},l.onSubtitleTracksUpdated=function(p,v){var g=this,r=v.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(i){return new f.Level(i)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(i){g.tracksBuffered[i.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(p,v){if(this.currentTrackId=v.id,this.levels.length&&this.currentTrackId!==-1){var g=this.levels[this.currentTrackId];g!=null&&g.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},l.onSubtitleTrackLoaded=function(p,v){var g,r=v.details,i=v.id,c=this.currentTrackId,b=this.levels;if(b.length){var S=b[c];if(!(i>=b.length||i!==c)&&S){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(g=S.details)!==null&&g!==void 0&&g.live){var k=this.mainDetails;if(r.deltaUpdateFailed||!k)return;var C=k.fragments[0];S.details?this.alignPlaylists(r,S.details)===0&&C&&Object(D.addSliding)(r,C.start):r.hasProgramDateTime&&k.hasProgramDateTime?Object(x.alignPDT)(r,k):C&&Object(D.addSliding)(r,C.start)}S.details=r,this.levelLastLoaded=i,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE&&(Object(R.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),S.details=void 0))}}},l._handleFragmentLoadComplete=function(p){var v=p.frag,g=p.payload,r=v.decryptdata,i=this.hls;if(!this.fragContextChanged(v)&&g&&g.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(g),r.key.buffer,r.iv.buffer).then(function(b){var S=performance.now();i.trigger(_.Events.FRAG_DECRYPTED,{frag:v,payload:b,stats:{tstart:c,tdecrypt:S}})})}},l.doTick=function(){if(this.media){if(this.state===A.State.IDLE){var p,v=this.currentTrackId,g=this.levels;if(!g.length||!g[v]||!g[v].details)return;var r=g[v].details,i=r.targetduration,c=this.config,b=this.media,S=L.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,b.currentTime-i,c.maxBufferHole),k=S.end;if(S.len>this.getMaxBufferLength()+i)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var C,I=r.fragments,O=I.length,P=r.edge,F=this.fragPrevious;if(k<P){var M=c.maxFragLookUpTolerance;F&&r.hasProgramDateTime&&(C=Object(R.findFragmentByPDT)(I,F.endProgramDateTime,M)),C||!(C=Object(R.findFragmentByPTS)(F,I,k,M))&&F&&F.start<I[0].start&&(C=I[0])}else C=I[O-1];(p=C)!==null&&p!==void 0&&p.encrypted?(T.logger.log("Loading key for "+C.sn),this.state=A.State.KEY_LOADING,this.hls.trigger(_.Events.KEY_LOADING,{frag:C})):C&&this.fragmentTracker.getState(C)===o.FragmentState.NOT_LOADED&&this.loadFragment(C,r,k)}}else this.state=A.State.IDLE},l.loadFragment=function(p,v,g){this.fragCurrent=p,e.prototype.loadFragment.call(this,p,v,g)},d=s,(a=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&E(d.prototype,a),s}(A.default)},"./src/controller/subtitle-track-controller.ts":function(N,w,h){h.r(w);var _=h("./src/events.ts"),T=h("./src/utils/texttrack-utils.ts"),L=h("./src/controller/base-playlist-controller.ts"),R=h("./src/types/loader.ts");function x(m,f){for(var E=0;E<f.length;E++){var y=f[E];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}function D(m,f){return(D=Object.setPrototypeOf||function(E,y){return E.__proto__=y,E})(m,f)}var o=function(m){var f,E;function y(t){var s;return(s=m.call(this,t,"[subtitle-track-controller]")||this).media=null,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.trackChangeListener=function(){return s.onTextTracksChanged()},s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s.subtitleDisplay=!0,s.registerListeners(),s}E=m,(f=y).prototype=Object.create(E.prototype),f.prototype.constructor=f,D(f,E);var u,e,n=y.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},n.registerListeners=function(){var t=this.hls;t.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(_.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(_.Events.ERROR,this.onError,this)},n.onMediaAttached=function(t,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),A(this.media.textTracks).forEach(function(t){Object(T.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(t,s){this.tracks=s.subtitleTracks},n.onSubtitleTrackLoaded=function(t,s){var d=s.id,a=s.details,l=this.trackId,p=this.tracksInGroup[l];if(p){var v=p.details;p.details=s.details,this.log("subtitle track "+d+" loaded ["+a.startSN+"-"+a.endSN+"]"),d===this.trackId&&(this.retryCount=0,this.playlistLoaded(d,s,v))}else this.warn("Invalid subtitle track id "+d)},n.onLevelLoading=function(t,s){this.switchLevel(s.level)},n.onLevelSwitching=function(t,s){this.switchLevel(s.level)},n.switchLevel=function(t){var s=this.hls.levels[t];if(s!=null&&s.textGroupIds){var d=s.textGroupIds[s.urlId];if(this.groupId!==d){var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,l=this.tracks.filter(function(g){return!d||g.groupId===d});this.tracksInGroup=l;var p=this.findTrackId(a==null?void 0:a.name)||this.findTrackId();this.groupId=d;var v={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+d+'" group-id'),this.hls.trigger(_.Events.SUBTITLE_TRACKS_UPDATED,v),p!==-1&&this.setSubtitleTrack(p,a)}}},n.findTrackId=function(t){for(var s=this.tracksInGroup,d=0;d<s.length;d++){var a=s[d];if((!this.selectDefaultTrack||a.default)&&(!t||t===a.name))return a.id}return-1},n.onError=function(t,s){m.prototype.onError.call(this,t,s),!s.fatal&&s.context&&s.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},n.loadPlaylist=function(t){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var d=s.id,a=s.groupId,l=s.url;if(t)try{l=t.addDirectives(l)}catch(p){this.warn("Could not construct new URL with HLS Delivery Directives: "+p)}this.log("Loading subtitle playlist for id "+d),this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADING,{url:l,id:d,groupId:a,deliveryDirectives:t||null})}},n.toggleTrackModes=function(t){var s=this,d=this.media,a=this.subtitleDisplay,l=this.trackId;if(d){var p=A(d.textTracks),v=p.filter(function(i){return i.groupId===s.groupId});if(t===-1)[].slice.call(p).forEach(function(i){i.mode="disabled"});else{var g=v[l];g&&(g.mode="disabled")}var r=v[t];r&&(r.mode=a?"showing":"hidden")}},n.setSubtitleTrack=function(t,s){var d,a=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(d=a[t])!==null&&d!==void 0&&d.details)||t<-1||t>=a.length)){this.clearTimer();var l=a[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,l){var p=l.id,v=l.groupId,g=v===void 0?"":v,r=l.name,i=l.type,c=l.url;this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:p,groupId:g,name:r,type:i,url:c});var b=this.switchParams(l.url,s==null?void 0:s.details);this.loadPlaylist(b)}else this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},n.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,s=A(this.media.textTracks),d=0;d<s.length;d++)if(s[d].mode==="hidden")t=d;else if(s[d].mode==="showing"){t=d;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},u=y,(e=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,s)}}])&&x(u.prototype,e),y}(L.default);function A(m){for(var f=[],E=0;E<m.length;E++){var y=m[E];y.kind==="subtitles"&&y.label&&f.push(m[E])}return f}w.default=o},"./src/controller/timeline-controller.ts":function(N,w,h){h.r(w),h.d(w,"TimelineController",function(){return f});var _=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),L=h("./src/utils/cea-608-parser.ts"),R=h("./src/utils/output-filter.ts"),x=h("./src/utils/webvtt-parser.ts"),D=h("./src/utils/texttrack-utils.ts"),o=h("./src/utils/imsc1-ttml-parser.ts"),A=h("./src/types/loader.ts"),m=h("./src/utils/logger.ts"),f=function(){function y(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var n=new R.default(this,"textTrack1"),t=new R.default(this,"textTrack2"),s=new R.default(this,"textTrack3"),d=new R.default(this,"textTrack4");this.cea608Parser1=new L.default(1,n,t),this.cea608Parser2=new L.default(3,s,d)}e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.Events.FRAG_LOADING,this.onFragLoading,this),e.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=y.prototype;return u.destroy=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.Events.FRAG_LOADING,this.onFragLoading,this),e.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(e,n,t,s,d){for(var a,l,p,v,g=!1,r=d.length;r--;){var i=d[r],c=(a=i[0],l=i[1],p=n,v=t,Math.min(l,v)-Math.max(a,p));if(c>=0&&(i[0]=Math.min(i[0],n),i[1]=Math.max(i[1],t),g=!0,c/(t-n)>.5))return}if(g||d.push([n,t]),this.config.renderTextTracksNatively){var b=this.captionsTracks[e];this.Cues.newCue(b,n,t,s)}else{var S=this.Cues.newCue(null,n,t,s);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:S,track:e})}},u.onInitPtsFound=function(e,n){var t=this,s=n.frag,d=n.id,a=n.initPTS,l=n.timescale,p=this.unparsedVttFrags;d==="main"&&(this.initPTS[s.cc]=a,this.timescale[s.cc]=l),p.length&&(this.unparsedVttFrags=[],p.forEach(function(v){t.onFragLoaded(T.Events.FRAG_LOADED,v)}))},u.getExistingTrack=function(e){var n=this.media;if(n)for(var t=0;t<n.textTracks.length;t++){var s=n.textTracks[t];if(s[e])return s}return null},u.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},u.createNativeTrack=function(e){if(!this.captionsTracks[e]){var n=this.captionsProperties,t=this.captionsTracks,s=this.media,d=n[e],a=d.label,l=d.languageCode,p=this.getExistingTrack(e);if(p)t[e]=p,Object(D.clearCurrentCues)(t[e]),Object(D.sendAddTrackEvent)(t[e],s);else{var v=this.createTextTrack("captions",a,l);v&&(v[e]=!0,t[e]=v)}}},u.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var n=this.captionsProperties[e];if(n){var t={_id:e,label:n.label,kind:"captions",default:!!n.media&&!!n.media.default,closedCaptions:n.media};this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},u.createTextTrack=function(e,n,t){var s=this.media;if(s)return s.addTextTrack(e,n,t)},u.onMediaAttaching=function(e,n){this.media=n.media,this._cleanTracks()},u.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(n){Object(D.clearCurrentCues)(e[n]),delete e[n]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var e=this.media;if(e){var n=e.textTracks;if(n)for(var t=0;t<n.length;t++)Object(D.clearCurrentCues)(n[t])}},u.onSubtitleTracksUpdated=function(e,n){var t=this;this.textTracks=[];var s=n.subtitleTracks||[],d=s.some(function(v){return v.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||d&&this.config.enableIMSC1){var a=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=s||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(v,g){var r;if(g<l.length){for(var i=null,c=0;c<l.length;c++)if(E(l[c],v)){i=l[c];break}i&&(r=i)}r?Object(D.clearCurrentCues)(r):(r=t.createTextTrack("subtitles",v.name,v.lang))&&(r.mode="disabled"),r&&(r.groupId=v.groupId,t.textTracks.push(r))})}else if(!a&&this.tracks&&this.tracks.length){var p=this.tracks.map(function(v){return{label:v.name,kind:v.type.toLowerCase(),default:v.default,subtitleTrack:v}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:p})}}},u.onManifestLoaded=function(e,n){var t=this;this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(function(s){var d=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(d){var a="textTrack"+d[1],l=t.captionsProperties[a];l&&(l.label=s.name,s.lang&&(l.languageCode=s.lang),l.media=s)}})},u.onFragLoading=function(e,n){var t=this.cea608Parser1,s=this.cea608Parser2,d=this.lastSn;if(this.enabled&&t&&s&&n.frag.type===A.PlaylistLevelType.MAIN){var a=n.frag.sn;a!==d+1&&(t.reset(),s.reset()),this.lastSn=a}},u.onFragLoaded=function(e,n){var t=n.frag,s=n.payload,d=this.initPTS,a=this.unparsedVttFrags;if(t.type===A.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(_.isFiniteNumber)(d[t.cc]))return a.push(n),void(d.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")}));var l=t.decryptdata;if(l==null||l.key==null||l.method!=="AES-128"){var p=this.tracks[t.level],v=this.vttCCs;v[t.cc]||(v[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),p&&p.textCodec===o.IMSC1_CODEC?this._parseIMSC1(t,s):this._parseVTTs(t,s,v)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(e,n){var t=this,s=this.hls;Object(o.parseIMSC1)(n,this.initPTS[e.cc],this.timescale[e.cc],function(d){t._appendCues(d,e.level),s.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(d){m.logger.log("Failed to parse IMSC1: "+d),s.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:d})})},u._parseVTTs=function(e,n,t){var s=this,d=this.hls;Object(x.parseWebVTT)(n,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(a){s._appendCues(a,e.level),d.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){s._fallbackToIMSC1(e,n),m.logger.log("Failed to parse VTT cue: "+a),d.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},u._fallbackToIMSC1=function(e,n){var t=this,s=this.tracks[e.level];s.textCodec||Object(o.parseIMSC1)(n,this.initPTS[e.cc],this.timescale[e.cc],function(){s.textCodec=o.IMSC1_CODEC,t._parseIMSC1(e,n)},function(){s.textCodec="wvtt"})},u._appendCues=function(e,n){var t=this.hls;if(this.config.renderTextTracksNatively){var s=this.textTracks[n];if(s.mode==="disabled")return;e.forEach(function(a){return Object(D.addCueToTrack)(s,a)})}else{var d=this.tracks[n].default?"default":"subtitles"+n;t.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:e,track:d})}},u.onFragDecrypted=function(e,n){var t=n.frag;if(t.type===A.PlaylistLevelType.SUBTITLE){if(!Object(_.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(n);this.onFragLoaded(T.Events.FRAG_LOADED,n)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(e,n){var t=this.cea608Parser1,s=this.cea608Parser2;if(this.enabled&&t&&s)for(var d=0;d<n.samples.length;d++){var a=n.samples[d].bytes;if(a){var l=this.extractCea608Data(a);t.addData(n.samples[d].pts,l[0]),s.addData(n.samples[d].pts,l[1])}}},u.onBufferFlushing=function(e,n){var t=n.startOffset,s=n.endOffset,d=n.endOffsetSubtitles,a=n.type,l=this.media;if(l&&!(l.currentTime<s)){if(!a||a==="video"){var p=this.captionsTracks;Object.keys(p).forEach(function(g){return Object(D.removeCuesInRange)(p[g],t,s)})}if(this.config.renderTextTracksNatively&&t===0&&d!==void 0){var v=this.textTracks;Object.keys(v).forEach(function(g){return Object(D.removeCuesInRange)(v[g],t,d)})}}},u.extractCea608Data=function(e){for(var n=31&e[0],t=2,s=[[],[]],d=0;d<n;d++){var a=e[t++],l=127&e[t++],p=127&e[t++],v=3&a;l===0&&p===0||(4&a)!=0&&(v!==0&&v!==1||(s[v].push(l),s[v].push(p)))}return s},y}();function E(y,u){return y&&y.label===u.name&&!(y.textTrack1||y.textTrack2)}},"./src/crypt/aes-crypto.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function T(L,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=L,this.aesIV=R}return T.prototype.decrypt=function(L,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,L)},T}()},"./src/crypt/aes-decryptor.ts":function(N,w,h){h.r(w),h.d(w,"removePadding",function(){return T}),h.d(w,"default",function(){return L});var _=h("./src/utils/typed-array.ts");function T(R){var x=R.byteLength,D=x&&new DataView(R.buffer).getUint8(x-1);return D?Object(_.sliceUint8)(R,0,x-D):R}var L=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var x=R.prototype;return x.uint8ArrayToUint32Array_=function(D){for(var o=new DataView(D),A=new Uint32Array(4),m=0;m<4;m++)A[m]=o.getUint32(4*m);return A},x.initTable=function(){var D=this.sBox,o=this.invSBox,A=this.subMix,m=A[0],f=A[1],E=A[2],y=A[3],u=this.invSubMix,e=u[0],n=u[1],t=u[2],s=u[3],d=new Uint32Array(256),a=0,l=0,p=0;for(p=0;p<256;p++)d[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=l^l<<1^l<<2^l<<3^l<<4;v=v>>>8^255&v^99,D[a]=v,o[v]=a;var g=d[a],r=d[g],i=d[r],c=257*d[v]^16843008*v;m[a]=c<<24|c>>>8,f[a]=c<<16|c>>>16,E[a]=c<<8|c>>>24,y[a]=c,c=16843009*i^65537*r^257*g^16843008*a,e[v]=c<<24|c>>>8,n[v]=c<<16|c>>>16,t[v]=c<<8|c>>>24,s[v]=c,a?(a=g^d[d[d[i^g]]],l^=d[d[l]]):a=l=1}},x.expandKey=function(D){for(var o=this.uint8ArrayToUint32Array_(D),A=!0,m=0;m<o.length&&A;)A=o[m]===this.key[m],m++;if(!A){this.key=o;var f=this.keySize=o.length;if(f!==4&&f!==6&&f!==8)throw new Error("Invalid aes key size="+f);var E,y,u,e,n=this.ksRows=4*(f+6+1),t=this.keySchedule=new Uint32Array(n),s=this.invKeySchedule=new Uint32Array(n),d=this.sBox,a=this.rcon,l=this.invSubMix,p=l[0],v=l[1],g=l[2],r=l[3];for(E=0;E<n;E++)E<f?u=t[E]=o[E]:(e=u,E%f==0?(e=d[(e=e<<8|e>>>24)>>>24]<<24|d[e>>>16&255]<<16|d[e>>>8&255]<<8|d[255&e],e^=a[E/f|0]<<24):f>6&&E%f==4&&(e=d[e>>>24]<<24|d[e>>>16&255]<<16|d[e>>>8&255]<<8|d[255&e]),t[E]=u=(t[E-f]^e)>>>0);for(y=0;y<n;y++)E=n-y,e=3&y?t[E]:t[E-4],s[y]=y<4||E<=4?e:p[d[e>>>24]]^v[d[e>>>16&255]]^g[d[e>>>8&255]]^r[d[255&e]],s[y]=s[y]>>>0}},x.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},x.decrypt=function(D,o,A){for(var m,f,E,y,u,e,n,t,s,d,a,l,p,v,g=this.keySize+6,r=this.invKeySchedule,i=this.invSBox,c=this.invSubMix,b=c[0],S=c[1],k=c[2],C=c[3],I=this.uint8ArrayToUint32Array_(A),O=I[0],P=I[1],F=I[2],M=I[3],B=new Int32Array(D),U=new Int32Array(B.length),G=this.networkToHostOrderSwap;o<B.length;){for(s=G(B[o]),d=G(B[o+1]),a=G(B[o+2]),l=G(B[o+3]),u=s^r[0],e=l^r[1],n=a^r[2],t=d^r[3],p=4,v=1;v<g;v++)m=b[u>>>24]^S[e>>16&255]^k[n>>8&255]^C[255&t]^r[p],f=b[e>>>24]^S[n>>16&255]^k[t>>8&255]^C[255&u]^r[p+1],E=b[n>>>24]^S[t>>16&255]^k[u>>8&255]^C[255&e]^r[p+2],y=b[t>>>24]^S[u>>16&255]^k[e>>8&255]^C[255&n]^r[p+3],u=m,e=f,n=E,t=y,p+=4;m=i[u>>>24]<<24^i[e>>16&255]<<16^i[n>>8&255]<<8^i[255&t]^r[p],f=i[e>>>24]<<24^i[n>>16&255]<<16^i[t>>8&255]<<8^i[255&u]^r[p+1],E=i[n>>>24]<<24^i[t>>16&255]<<16^i[u>>8&255]<<8^i[255&e]^r[p+2],y=i[t>>>24]<<24^i[u>>16&255]<<16^i[e>>8&255]<<8^i[255&n]^r[p+3],U[o]=G(m^O),U[o+1]=G(y^P),U[o+2]=G(E^F),U[o+3]=G(f^M),O=s,P=d,F=a,M=l,o+=4}return U.buffer},R}()},"./src/crypt/decrypter.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return o});var _=h("./src/crypt/aes-crypto.ts"),T=h("./src/crypt/fast-aes-key.ts"),L=h("./src/crypt/aes-decryptor.ts"),R=h("./src/utils/logger.ts"),x=h("./src/utils/mp4-tools.ts"),D=h("./src/utils/typed-array.ts"),o=function(){function A(f,E,y){var u=(y===void 0?{}:y).removePKCS7Padding,e=u===void 0||u;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=f,this.config=E,this.removePKCS7Padding=e,e)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var m=A.prototype;return m.destroy=function(){this.observer=null},m.isSync=function(){return this.config.enableSoftwareAES},m.flush=function(){var f=this.currentResult;if(f){var E=new Uint8Array(f);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(E):E}this.reset()},m.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},m.decrypt=function(f,E,y,u){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(f),E,y);var e=this.flush();e&&u(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(f),E,y).then(u)},m.softwareDecrypt=function(f,E,y){var u=this.currentIV,e=this.currentResult,n=this.remainderData;this.logOnce("JS AES decrypt"),n&&(f=Object(x.appendUint8Array)(n,f),this.remainderData=null);var t=this.getValidChunk(f);if(!t.length)return null;u&&(y=u);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new L.default),s.expandKey(E);var d=e;return this.currentResult=s.decrypt(t.buffer,0,y),this.currentIV=Object(D.sliceUint8)(t,-16).buffer,d||null},m.webCryptoDecrypt=function(f,E,y){var u=this,e=this.subtle;return this.key===E&&this.fastAesKey||(this.key=E,this.fastAesKey=new T.default(e,E)),this.fastAesKey.expandKey().then(function(n){return e?new _.default(e,y).decrypt(f.buffer,n):Promise.reject(new Error("web crypto not initialized"))}).catch(function(n){return u.onWebCryptoError(n,f,E,y)})},m.onWebCryptoError=function(f,E,y,u){return R.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",f),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(E,y,u)},m.getValidChunk=function(f){var E=f,y=f.length-f.length%16;return y!==f.length&&(E=Object(D.sliceUint8)(f,0,y),this.remainderData=Object(D.sliceUint8)(f,y)),E},m.logOnce=function(f){this.logEnabled&&(R.logger.log("[decrypter.ts]: "+f),this.logEnabled=!1)},A}()},"./src/crypt/fast-aes-key.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function T(L,R){this.subtle=void 0,this.key=void 0,this.subtle=L,this.key=R}return T.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":function(N,w,h){h.r(w);var _=h("./src/demux/base-audio-demuxer.ts"),T=h("./src/demux/adts.ts"),L=h("./src/utils/logger.ts"),R=h("./src/demux/id3.ts");function x(o,A){return(x=Object.setPrototypeOf||function(m,f){return m.__proto__=f,m})(o,A)}var D=function(o){var A,m;function f(y,u){var e;return(e=o.call(this)||this).observer=void 0,e.config=void 0,e.observer=y,e.config=u,e}m=o,(A=f).prototype=Object.create(m.prototype),A.prototype.constructor=A,x(A,m);var E=f.prototype;return E.resetInitSegment=function(y,u,e){o.prototype.resetInitSegment.call(this,y,u,e),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:y,duration:e,inputTimeScale:9e4,dropped:0}},f.probe=function(y){if(!y)return!1;for(var u=(R.getID3Data(y,0)||[]).length,e=y.length;u<e;u++)if(T.probe(y,u))return L.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(y,u){return T.canParse(y,u)},E.appendFrame=function(y,u,e){T.initTrackConfig(y,this.observer,u,e,y.manifestCodec);var n=T.appendFrame(y,u,e,this.initPTS,this.frameIndex);if(n&&n.missing===0)return n},f}(_.default);D.minProbeByteLength=9,w.default=D},"./src/demux/adts.ts":function(N,w,h){h.r(w),h.d(w,"getAudioConfig",function(){return R}),h.d(w,"isHeaderPattern",function(){return x}),h.d(w,"getHeaderLength",function(){return D}),h.d(w,"getFullFrameLength",function(){return o}),h.d(w,"canGetFrameLength",function(){return A}),h.d(w,"isHeader",function(){return m}),h.d(w,"canParse",function(){return f}),h.d(w,"probe",function(){return E}),h.d(w,"initTrackConfig",function(){return y}),h.d(w,"getFrameDuration",function(){return u}),h.d(w,"parseFrameHeader",function(){return e}),h.d(w,"appendFrame",function(){return n});var _=h("./src/utils/logger.ts"),T=h("./src/errors.ts"),L=h("./src/events.ts");function R(t,s,d,a){var l,p,v,g,r=navigator.userAgent.toLowerCase(),i=a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];l=1+((192&s[d+2])>>>6);var b=(60&s[d+2])>>>2;if(!(b>c.length-1))return v=(1&s[d+2])<<2,v|=(192&s[d+3])>>>6,_.logger.log("manifest codec:"+a+", ADTS type:"+l+", samplingIndex:"+b),/firefox/i.test(r)?b>=6?(l=5,g=new Array(4),p=b-3):(l=2,g=new Array(2),p=b):r.indexOf("android")!==-1?(l=2,g=new Array(2),p=b):(l=5,g=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&b>=6?p=b-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(b>=6&&v===1||/vivaldi/i.test(r))||!a&&v===1)&&(l=2,g=new Array(2)),p=b)),g[0]=l<<3,g[0]|=(14&b)>>1,g[1]|=(1&b)<<7,g[1]|=v<<3,l===5&&(g[1]|=(14&p)>>1,g[2]=(1&p)<<7,g[2]|=8,g[3]=0),{config:g,samplerate:c[b],channelCount:v,codec:"mp4a.40."+l,manifestCodec:i};t.trigger(L.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+b})}function x(t,s){return t[s]===255&&(246&t[s+1])==240}function D(t,s){return 1&t[s+1]?7:9}function o(t,s){return(3&t[s+3])<<11|t[s+4]<<3|(224&t[s+5])>>>5}function A(t,s){return s+5<t.length}function m(t,s){return s+1<t.length&&x(t,s)}function f(t,s){return A(t,s)&&x(t,s)&&o(t,s)<=t.length-s}function E(t,s){if(m(t,s)){var d=D(t,s);if(s+d>=t.length)return!1;var a=o(t,s);if(a<=d)return!1;var l=s+a;return l===t.length||m(t,l)}return!1}function y(t,s,d,a,l){if(!t.samplerate){var p=R(s,d,a,l);if(!p)return;t.config=p.config,t.samplerate=p.samplerate,t.channelCount=p.channelCount,t.codec=p.codec,t.manifestCodec=p.manifestCodec,_.logger.log("parsed codec:"+t.codec+", rate:"+p.samplerate+", channels:"+p.channelCount)}}function u(t){return 9216e4/t}function e(t,s,d,a,l){var p=D(t,s),v=o(t,s);if((v-=p)>0)return{headerLength:p,frameLength:v,stamp:d+a*l}}function n(t,s,d,a,l){var p=e(s,d,a,l,u(t.samplerate));if(p){var v,g=p.frameLength,r=p.headerLength,i=p.stamp,c=r+g,b=Math.max(0,d+c-s.length);b?(v=new Uint8Array(c-r)).set(s.subarray(d+r,s.length),0):v=s.subarray(d+r,d+c);var S={unit:v,pts:i};return b||t.samples.push(S),{sample:S,length:c,missing:b}}}},"./src/demux/base-audio-demuxer.ts":function(N,w,h){h.r(w),h.d(w,"initPTSFn",function(){return o});var _=h("./src/polyfills/number.ts"),T=h("./src/demux/id3.ts"),L=h("./src/demux/dummy-demuxed-track.ts"),R=h("./src/utils/mp4-tools.ts"),x=h("./src/utils/typed-array.ts"),D=function(){function A(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=A.prototype;return m.resetInitSegment=function(f,E,y){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(f,E){return!1},m.appendFrame=function(f,E,y){},m.demux=function(f,E){this.cachedData&&(f=Object(R.appendUint8Array)(this.cachedData,f),this.cachedData=null);var y,u,e=T.getID3Data(f,0),n=e?e.length:0,t=this._audioTrack,s=this._id3Track,d=e?T.getTimeStamp(e):void 0,a=f.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(d,E)),e&&e.length>0&&s.samples.push({pts:this.initPTS,dts:this.initPTS,data:e}),u=this.initPTS;n<a;){if(this.canParse(f,n)){var l=this.appendFrame(t,f,n);l?(this.frameIndex++,u=l.sample.pts,y=n+=l.length):n=a}else T.canParse(f,n)?(e=T.getID3Data(f,n),s.samples.push({pts:u,dts:u,data:e}),y=n+=e.length):n++;if(n===a&&y!==a){var p=Object(x.sliceUint8)(f,y);this.cachedData?this.cachedData=Object(R.appendUint8Array)(this.cachedData,p):this.cachedData=p}}return{audioTrack:t,avcTrack:Object(L.dummyTrack)(),id3Track:s,textTrack:Object(L.dummyTrack)()}},m.demuxSampleAes=function(f,E,y){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(f){var E=this.cachedData;return E&&(this.cachedData=null,this.demux(E,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},m.destroy=function(){},A}(),o=function(A,m){return Object(_.isFiniteNumber)(A)?90*A:9e4*m};w.default=D},"./src/demux/chunk-cache.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function T(){this.chunks=[],this.dataLength=0}var L=T.prototype;return L.push=function(R){this.chunks.push(R),this.dataLength+=R.length},L.flush=function(){var R,x=this.chunks,D=this.dataLength;return x.length?(R=x.length===1?x[0]:function(o,A){for(var m=new Uint8Array(A),f=0,E=0;E<o.length;E++){var y=o[E];m.set(y,f),f+=y.length}return m}(x,D),this.reset(),R):new Uint8Array(0)},L.reset=function(){this.chunks.length=0,this.dataLength=0},T}()},"./src/demux/dummy-demuxed-track.ts":function(N,w,h){function _(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}h.r(w),h.d(w,"dummyTrack",function(){return _})},"./src/demux/exp-golomb.ts":function(N,w,h){h.r(w);var _=h("./src/utils/logger.ts"),T=function(){function L(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var R=L.prototype;return R.loadWord=function(){var x=this.data,D=this.bytesAvailable,o=x.byteLength-D,A=new Uint8Array(4),m=Math.min(4,D);if(m===0)throw new Error("no bytes available");A.set(x.subarray(o,o+m)),this.word=new DataView(A.buffer).getUint32(0),this.bitsAvailable=8*m,this.bytesAvailable-=m},R.skipBits=function(x){var D;this.bitsAvailable>x?(this.word<<=x,this.bitsAvailable-=x):(x-=this.bitsAvailable,x-=(D=x>>3)>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=x,this.bitsAvailable-=x)},R.readBits=function(x){var D=Math.min(this.bitsAvailable,x),o=this.word>>>32-D;return x>32&&_.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),(D=x-D)>0&&this.bitsAvailable?o<<D|this.readBits(D):o},R.skipLZ=function(){var x;for(x=0;x<this.bitsAvailable;++x)if((this.word&2147483648>>>x)!=0)return this.word<<=x,this.bitsAvailable-=x,x;return this.loadWord(),x+this.skipLZ()},R.skipUEG=function(){this.skipBits(1+this.skipLZ())},R.skipEG=function(){this.skipBits(1+this.skipLZ())},R.readUEG=function(){var x=this.skipLZ();return this.readBits(x+1)-1},R.readEG=function(){var x=this.readUEG();return 1&x?1+x>>>1:-1*(x>>>1)},R.readBoolean=function(){return this.readBits(1)===1},R.readUByte=function(){return this.readBits(8)},R.readUShort=function(){return this.readBits(16)},R.readUInt=function(){return this.readBits(32)},R.skipScalingList=function(x){for(var D=8,o=8,A=0;A<x;A++)o!==0&&(o=(D+this.readEG()+256)%256),D=o===0?D:o},R.readSPS=function(){var x,D,o,A=0,m=0,f=0,E=0,y=this.readUByte.bind(this),u=this.readBits.bind(this),e=this.readUEG.bind(this),n=this.readBoolean.bind(this),t=this.skipBits.bind(this),s=this.skipEG.bind(this),d=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);y();var l=y();if(u(5),t(3),y(),d(),l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128){var p=e();if(p===3&&t(1),d(),d(),t(1),n())for(D=p!==3?8:12,o=0;o<D;o++)n()&&a(o<6?16:64)}d();var v=e();if(v===0)e();else if(v===1)for(t(1),s(),s(),x=e(),o=0;o<x;o++)s();d(),t(1);var g=e(),r=e(),i=u(1);i===0&&t(1),t(1),n()&&(A=e(),m=e(),f=e(),E=e());var c=[1,1];if(n()&&n())switch(y()){case 1:c=[1,1];break;case 2:c=[12,11];break;case 3:c=[10,11];break;case 4:c=[16,11];break;case 5:c=[40,33];break;case 6:c=[24,11];break;case 7:c=[20,11];break;case 8:c=[32,11];break;case 9:c=[80,33];break;case 10:c=[18,11];break;case 11:c=[15,11];break;case 12:c=[64,33];break;case 13:c=[160,99];break;case 14:c=[4,3];break;case 15:c=[3,2];break;case 16:c=[2,1];break;case 255:c=[y()<<8|y(),y()<<8|y()]}return{width:Math.ceil(16*(g+1)-2*A-2*m),height:(2-i)*(r+1)*16-(i?2:4)*(f+E),pixelRatio:c}},R.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();w.default=T},"./src/demux/id3.ts":function(N,w,h){h.r(w),h.d(w,"isHeader",function(){return T}),h.d(w,"isFooter",function(){return L}),h.d(w,"getID3Data",function(){return R}),h.d(w,"canParse",function(){return D}),h.d(w,"getTimeStamp",function(){return o}),h.d(w,"isTimeStampFrame",function(){return A}),h.d(w,"getID3Frames",function(){return f}),h.d(w,"decodeFrame",function(){return E}),h.d(w,"utf8ArrayToStr",function(){return t}),h.d(w,"testables",function(){return s});var _,T=function(d,a){return a+10<=d.length&&d[a]===73&&d[a+1]===68&&d[a+2]===51&&d[a+3]<255&&d[a+4]<255&&d[a+6]<128&&d[a+7]<128&&d[a+8]<128&&d[a+9]<128},L=function(d,a){return a+10<=d.length&&d[a]===51&&d[a+1]===68&&d[a+2]===73&&d[a+3]<255&&d[a+4]<255&&d[a+6]<128&&d[a+7]<128&&d[a+8]<128&&d[a+9]<128},R=function(d,a){for(var l=a,p=0;T(d,a);)p+=10,p+=x(d,a+6),L(d,a+10)&&(p+=10),a+=p;if(p>0)return d.subarray(l,l+p)},x=function(d,a){var l=0;return l=(127&d[a])<<21,l|=(127&d[a+1])<<14,l|=(127&d[a+2])<<7,l|=127&d[a+3]},D=function(d,a){return T(d,a)&&x(d,a+6)+10<=d.length-a},o=function(d){for(var a=f(d),l=0;l<a.length;l++){var p=a[l];if(A(p))return n(p)}},A=function(d){return d&&d.key==="PRIV"&&d.info==="com.apple.streaming.transportStreamTimestamp"},m=function(d){var a=String.fromCharCode(d[0],d[1],d[2],d[3]),l=x(d,4);return{type:a,size:l,data:d.subarray(10,10+l)}},f=function(d){for(var a=0,l=[];T(d,a);){for(var p=x(d,a+6),v=(a+=10)+p;a+8<v;){var g=m(d.subarray(a)),r=E(g);r&&l.push(r),a+=g.size+10}L(d,a)&&(a+=10)}return l},E=function(d){return d.type==="PRIV"?y(d):d.type[0]==="W"?e(d):u(d)},y=function(d){if(!(d.size<2)){var a=t(d.data,!0),l=new Uint8Array(d.data.subarray(a.length+1));return{key:d.type,info:a,data:l.buffer}}},u=function(d){if(!(d.size<2)){if(d.type==="TXXX"){var a=1,l=t(d.data.subarray(a),!0);a+=l.length+1;var p=t(d.data.subarray(a));return{key:d.type,info:l,data:p}}var v=t(d.data.subarray(1));return{key:d.type,data:v}}},e=function(d){if(d.type==="WXXX"){if(d.size<2)return;var a=1,l=t(d.data.subarray(a),!0);a+=l.length+1;var p=t(d.data.subarray(a));return{key:d.type,info:l,data:p}}var v=t(d.data);return{key:d.type,data:v}},n=function(d){if(d.data.byteLength===8){var a=new Uint8Array(d.data),l=1&a[3],p=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return p/=45,l&&(p+=4772185884e-2),Math.round(p)}},t=function(d,a){a===void 0&&(a=!1);var l=(_||self.TextDecoder===void 0||(_=new self.TextDecoder("utf-8")),_);if(l){var p=l.decode(d);if(a){var v=p.indexOf("\0");return v!==-1?p.substring(0,v):p}return p.replace(/\0/g,"")}for(var g,r,i,c=d.length,b="",S=0;S<c;){if((g=d[S++])===0&&a)return b;if(g!==0&&g!==3)switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(g);break;case 12:case 13:r=d[S++],b+=String.fromCharCode((31&g)<<6|63&r);break;case 14:r=d[S++],i=d[S++],b+=String.fromCharCode((15&g)<<12|(63&r)<<6|(63&i)<<0)}}return b},s={decodeTextFrame:u}},"./src/demux/mp3demuxer.ts":function(N,w,h){h.r(w);var _=h("./src/demux/base-audio-demuxer.ts"),T=h("./src/demux/id3.ts"),L=h("./src/utils/logger.ts"),R=h("./src/demux/mpegaudio.ts");function x(o,A){return(x=Object.setPrototypeOf||function(m,f){return m.__proto__=f,m})(o,A)}var D=function(o){var A,m;function f(){return o.apply(this,arguments)||this}m=o,(A=f).prototype=Object.create(m.prototype),A.prototype.constructor=A,x(A,m);var E=f.prototype;return E.resetInitSegment=function(y,u,e){o.prototype.resetInitSegment.call(this,y,u,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:y,duration:e,inputTimeScale:9e4,dropped:0}},f.probe=function(y){if(!y)return!1;for(var u=(T.getID3Data(y,0)||[]).length,e=y.length;u<e;u++)if(R.probe(y,u))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(y,u){return R.canParse(y,u)},E.appendFrame=function(y,u,e){if(this.initPTS!==null)return R.appendFrame(y,u,e,this.initPTS,this.frameIndex)},f}(_.default);D.minProbeByteLength=4,w.default=D},"./src/demux/mp4demuxer.ts":function(N,w,h){h.r(w);var _=h("./src/utils/mp4-tools.ts"),T=h("./src/demux/dummy-demuxed-track.ts"),L=function(){function R(D,o){this.remainderData=null,this.config=void 0,this.config=o}var x=R.prototype;return x.resetTimeStamp=function(){},x.resetInitSegment=function(){},x.resetContiguity=function(){},R.probe=function(D){return Object(_.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},x.demux=function(D){var o=D,A=Object(T.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(_.appendUint8Array)(this.remainderData,D));var m=Object(_.segmentValidRange)(o);this.remainderData=m.remainder,A.samples=m.valid||new Uint8Array}else A.samples=o;return{audioTrack:Object(T.dummyTrack)(),avcTrack:A,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},x.flush=function(){var D=Object(T.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(T.dummyTrack)(),avcTrack:D,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},x.demuxSampleAes=function(D,o,A){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},x.destroy=function(){},R}();L.minProbeByteLength=1024,w.default=L},"./src/demux/mpegaudio.ts":function(N,w,h){h.r(w),h.d(w,"appendFrame",function(){return D}),h.d(w,"parseHeader",function(){return o}),h.d(w,"isHeaderPattern",function(){return A}),h.d(w,"isHeader",function(){return m}),h.d(w,"canParse",function(){return f}),h.d(w,"probe",function(){return E});var _=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],x=[0,1,1,4];function D(y,u,e,n,t){if(!(e+24>u.length)){var s=o(u,e);if(s&&e+s.frameLength<=u.length){var d=n+t*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:u.subarray(e,e+s.frameLength),pts:d,dts:d};return y.config=[],y.channelCount=s.channelCount,y.samplerate=s.sampleRate,y.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}}function o(y,u){var e=y[u+1]>>3&3,n=y[u+1]>>1&3,t=y[u+2]>>4&15,s=y[u+2]>>2&3;if(e!==1&&t!==0&&t!==15&&s!==3){var d=y[u+2]>>1&1,a=y[u+3]>>6,l=1e3*T[14*(e===3?3-n:n===3?3:4)+t-1],p=L[3*(e===3?0:e===2?1:2)+s],v=a===3?1:2,g=R[e][n],r=x[n],i=8*g*r,c=Math.floor(g*l/p+d)*r;if(_===null){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_=b?parseInt(b[1]):0}return!!_&&_<=87&&n===2&&l>=224e3&&a===0&&(y[u+3]=128|y[u+3]),{sampleRate:p,channelCount:v,frameLength:c,samplesPerFrame:i}}}function A(y,u){return y[u]===255&&(224&y[u+1])==224&&(6&y[u+1])!=0}function m(y,u){return u+1<y.length&&A(y,u)}function f(y,u){return A(y,u)&&4<=y.length-u}function E(y,u){if(u+1<y.length&&A(y,u)){var e=o(y,u),n=4;e!=null&&e.frameLength&&(n=e.frameLength);var t=u+n;return t===y.length||m(y,t)}return!1}},"./src/demux/sample-aes.ts":function(N,w,h){h.r(w);var _=h("./src/crypt/decrypter.ts"),T=h("./src/demux/tsdemuxer.ts"),L=function(){function R(D,o,A){this.keyData=void 0,this.decrypter=void 0,this.keyData=A,this.decrypter=new _.default(D,o,{removePKCS7Padding:!1})}var x=R.prototype;return x.decryptBuffer=function(D,o){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,o)},x.decryptAacSample=function(D,o,A,m){var f=D[o].unit,E=f.subarray(16,f.length-f.length%16),y=E.buffer.slice(E.byteOffset,E.byteOffset+E.length),u=this;this.decryptBuffer(y,function(e){var n=new Uint8Array(e);f.set(n,16),m||u.decryptAacSamples(D,o+1,A)})},x.decryptAacSamples=function(D,o,A){for(;;o++){if(o>=D.length)return void A();if(!(D[o].unit.length<32)){var m=this.decrypter.isSync();if(this.decryptAacSample(D,o,A,m),!m)return}}},x.getAvcEncryptedData=function(D){for(var o=16*Math.floor((D.length-48)/160)+16,A=new Int8Array(o),m=0,f=32;f<=D.length-16;f+=160,m+=16)A.set(D.subarray(f,f+16),m);return A},x.getAvcDecryptedUnit=function(D,o){for(var A=new Uint8Array(o),m=0,f=32;f<=D.length-16;f+=160,m+=16)D.set(A.subarray(m,m+16),f);return D},x.decryptAvcSample=function(D,o,A,m,f,E){var y=Object(T.discardEPB)(f.data),u=this.getAvcEncryptedData(y),e=this;this.decryptBuffer(u.buffer,function(n){f.data=e.getAvcDecryptedUnit(y,n),E||e.decryptAvcSamples(D,o,A+1,m)})},x.decryptAvcSamples=function(D,o,A,m){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,A=0){if(o>=D.length)return void m();for(var f=D[o].units;!(A>=f.length);A++){var E=f[A];if(!(E.data.length<=48||E.type!==1&&E.type!==5)){var y=this.decrypter.isSync();if(this.decryptAvcSample(D,o,A,m,E,y),!y)return}}}},R}();w.default=L},"./src/demux/transmuxer-interface.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return m});var _=h("./node_modules/webworkify-webpack/index.js"),T=h("./src/events.ts"),L=h("./src/demux/transmuxer.ts"),R=h("./src/utils/logger.ts"),x=h("./src/errors.ts"),D=h("./src/utils/mediasource-helper.ts"),o=h("./node_modules/eventemitter3/index.js"),A=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function f(y,u,e,n){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=y,this.id=u,this.onTransmuxComplete=e,this.onFlush=n;var s=y.config,d=function(v,g){(g=g||{}).frag=t.frag,g.id=t.id,y.trigger(v,g)};this.observer=new o.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,d),this.observer.on(T.Events.ERROR,d);var a={mp4:A.isTypeSupported("video/mp4"),mpeg:A.isTypeSupported("audio/mpeg"),mp3:A.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(s.enableWorker&&typeof Worker!="undefined"){var p;R.logger.log("demuxing in webworker");try{p=this.worker=_("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(v){y.trigger(T.Events.ERROR,{type:x.ErrorTypes.OTHER_ERROR,details:x.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(v.message+"  ("+v.filename+":"+v.lineno+")")})},p.postMessage({cmd:"init",typeSupported:a,vendor:l,id:u,config:JSON.stringify(s)})}catch(v){R.logger.warn("Error in worker:",v),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new L.default(this.observer,a,s,l,u),this.worker=null}}else this.transmuxer=new L.default(this.observer,a,s,l,u)}var E=f.prototype;return E.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},E.push=function(y,u,e,n,t,s,d,a,l,p){var v=this;l.transmuxing.start=self.performance.now();var g=this.transmuxer,r=this.worker,i=s?s.start:t.start,c=t.decryptdata,b=this.frag,S=!(b&&t.cc===b.cc),k=!(b&&l.level===b.level),C=b?l.sn-b.sn:-1,I=this.part?l.part-this.part.index:1,O=!k&&(C===1||C===0&&I===1),P=self.performance.now();(k||C||t.stats.parsing.start===0)&&(t.stats.parsing.start=P),!s||!I&&O||(s.stats.parsing.start=P);var F=new L.TransmuxState(S,O,a,k,i);if(!O||S){R.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+S+`
        trackSwitch: `+k+`
        contiguous: `+O+`
        accurateTimeOffset: `+a+`
        timeOffset: `+i);var M=new L.TransmuxConfig(e,n,u,d,p);this.configureTransmuxer(M)}if(this.frag=t,this.part=s,r)r.postMessage({cmd:"demux",data:y,decryptdata:c,chunkMeta:l,state:F},y instanceof ArrayBuffer?[y]:[]);else if(g){var B=g.push(y,c,l,F);Object(L.isPromise)(B)?B.then(function(U){v.handleTransmuxComplete(U)}):this.handleTransmuxComplete(B)}},E.flush=function(y){var u=this;y.transmuxing.start=self.performance.now();var e=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:y});else if(e){var t=e.flush(y);Object(L.isPromise)(t)?t.then(function(s){u.handleFlushResult(s,y)}):this.handleFlushResult(t,y)}},E.handleFlushResult=function(y,u){var e=this;y.forEach(function(n){e.handleTransmuxComplete(n)}),this.onFlush(u)},E.onWorkerMessage=function(y){var u=y.data,e=this.hls;switch(u.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(u.data);break;case"flush":this.onFlush(u.data);break;default:u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,e.trigger(u.event,u.data)}},E.configureTransmuxer=function(y){var u=this.worker,e=this.transmuxer;u?u.postMessage({cmd:"configure",config:y}):e&&e.configure(y)},E.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},f}()},"./src/demux/transmuxer-worker.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return x});var _=h("./src/demux/transmuxer.ts"),T=h("./src/events.ts"),L=h("./src/utils/logger.ts"),R=h("./node_modules/eventemitter3/index.js");function x(m){var f=new R.EventEmitter,E=function(y,u){m.postMessage({event:y,data:u})};f.on(T.Events.FRAG_DECRYPTED,E),f.on(T.Events.ERROR,E),m.addEventListener("message",function(y){var u=y.data;switch(u.cmd){case"init":var e=JSON.parse(u.config);m.transmuxer=new _.default(f,u.typeSupported,e,u.vendor,u.id),Object(L.enableLogs)(e.debug),E("init",null);break;case"configure":m.transmuxer.configure(u.config);break;case"demux":var n=m.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(_.isPromise)(n)?n.then(function(d){D(m,d)}):D(m,n);break;case"flush":var t=u.chunkMeta,s=m.transmuxer.flush(t);Object(_.isPromise)(s)?s.then(function(d){A(m,d,t)}):A(m,s,t)}})}function D(m,f){if((E=f.remuxResult).audio||E.video||E.text||E.id3||E.initSegment){var E,y=[],u=f.remuxResult,e=u.audio,n=u.video;e&&o(y,e),n&&o(y,n),m.postMessage({event:"transmuxComplete",data:f},y)}}function o(m,f){f.data1&&m.push(f.data1.buffer),f.data2&&m.push(f.data2.buffer)}function A(m,f,E){f.forEach(function(y){D(m,y)}),m.postMessage({event:"flush",data:E})}},"./src/demux/transmuxer.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return t}),h.d(w,"isPromise",function(){return d}),h.d(w,"TransmuxConfig",function(){return a}),h.d(w,"TransmuxState",function(){return l});var _,T=h("./src/events.ts"),L=h("./src/errors.ts"),R=h("./src/crypt/decrypter.ts"),x=h("./src/demux/aacdemuxer.ts"),D=h("./src/demux/mp4demuxer.ts"),o=h("./src/demux/tsdemuxer.ts"),A=h("./src/demux/mp3demuxer.ts"),m=h("./src/remux/mp4-remuxer.ts"),f=h("./src/remux/passthrough-remuxer.ts"),E=h("./src/demux/chunk-cache.ts"),y=h("./src/utils/mp4-tools.ts"),u=h("./src/utils/logger.ts");try{_=self.performance.now.bind(self.performance)}catch{u.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var e=[{demux:o.default,remux:m.default},{demux:D.default,remux:f.default},{demux:x.default,remux:m.default},{demux:A.default,remux:m.default}],n=1024;e.forEach(function(p){var v=p.demux;n=Math.max(n,v.minProbeByteLength)});var t=function(){function p(g,r,i,c,b){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new E.default,this.observer=g,this.typeSupported=r,this.config=i,this.vendor=c,this.id=b}var v=p.prototype;return v.configure=function(g){this.transmuxConfig=g,this.decrypter&&this.decrypter.reset()},v.push=function(g,r,i,c){var b=this,S=i.transmuxing;S.executeStart=_();var k=new Uint8Array(g),C=this.cache,I=this.config,O=this.currentTransmuxState,P=this.transmuxConfig;c&&(this.currentTransmuxState=c);var F=function(ae,ie){var ue=null;return ae.byteLength>0&&ie!=null&&ie.key!=null&&ie.iv!==null&&ie.method!=null&&(ue=ie),ue}(k,r);if(F&&F.method==="AES-128"){var M=this.getDecrypter();if(!I.enableSoftwareAES)return this.decryptionPromise=M.webCryptoDecrypt(k,F.key.buffer,F.iv.buffer).then(function(ae){var ie=b.push(ae,null,i);return b.decryptionPromise=null,ie}),this.decryptionPromise;var B=M.softwareDecrypt(k,F.key.buffer,F.iv.buffer);if(!B)return S.executeEnd=_(),s(i);k=new Uint8Array(B)}var U=c||O,G=U.contiguous,K=U.discontinuity,H=U.trackSwitch,q=U.accurateTimeOffset,W=U.timeOffset,Y=P.audioCodec,Z=P.videoCodec,ee=P.defaultInitPts,re=P.duration,X=P.initSegmentData;if((K||H)&&this.resetInitSegment(X,Y,Z,re),K&&this.resetInitialTimestamp(ee),G||this.resetContiguity(),this.needsProbing(k,K,H)){if(C.dataLength){var ne=C.flush();k=Object(y.appendUint8Array)(ne,k)}this.configureTransmuxer(k,P)}var z=this.transmux(k,F,W,q,i),$=this.currentTransmuxState;return $.contiguous=!0,$.discontinuity=!1,$.trackSwitch=!1,S.executeEnd=_(),z},v.flush=function(g){var r=this,i=g.transmuxing;i.executeStart=_();var c=this.decrypter,b=this.cache,S=this.currentTransmuxState,k=this.decryptionPromise;if(k)return k.then(function(){return r.flush(g)});var C=[],I=S.timeOffset;if(c){var O=c.flush();O&&C.push(this.push(O,null,g))}var P=b.dataLength;b.reset();var F=this.demuxer,M=this.remuxer;if(!F||!M)return P>=n&&this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),i.executeEnd=_(),[s(g)];var B=F.flush(I);return d(B)?B.then(function(U){return r.flushRemux(C,U,g),C}):(this.flushRemux(C,B,g),C)},v.flushRemux=function(g,r,i){var c=r.audioTrack,b=r.avcTrack,S=r.id3Track,k=r.textTrack,C=this.currentTransmuxState,I=C.accurateTimeOffset,O=C.timeOffset;u.logger.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var P=this.remuxer.remux(c,b,S,k,O,I,!0,this.id);g.push({remuxResult:P,chunkMeta:i}),i.transmuxing.executeEnd=_()},v.resetInitialTimestamp=function(g){var r=this.demuxer,i=this.remuxer;r&&i&&(r.resetTimeStamp(g),i.resetTimeStamp(g))},v.resetContiguity=function(){var g=this.demuxer,r=this.remuxer;g&&r&&(g.resetContiguity(),r.resetNextTimestamp())},v.resetInitSegment=function(g,r,i,c){var b=this.demuxer,S=this.remuxer;b&&S&&(b.resetInitSegment(r,i,c),S.resetInitSegment(g,r,i))},v.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},v.transmux=function(g,r,i,c,b){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(g,r,i,c,b):this.transmuxUnencrypted(g,i,c,b)},v.transmuxUnencrypted=function(g,r,i,c){var b=this.demuxer.demux(g,r,!1,!this.config.progressive),S=b.audioTrack,k=b.avcTrack,C=b.id3Track,I=b.textTrack;return{remuxResult:this.remuxer.remux(S,k,C,I,r,i,!1,this.id),chunkMeta:c}},v.transmuxSampleAes=function(g,r,i,c,b){var S=this;return this.demuxer.demuxSampleAes(g,r,i).then(function(k){return{remuxResult:S.remuxer.remux(k.audioTrack,k.avcTrack,k.id3Track,k.textTrack,i,c,!1,S.id),chunkMeta:b}})},v.configureTransmuxer=function(g,r){for(var i,c=this.config,b=this.observer,S=this.typeSupported,k=this.vendor,C=r.audioCodec,I=r.defaultInitPts,O=r.duration,P=r.initSegmentData,F=r.videoCodec,M=0,B=e.length;M<B;M++)if(e[M].demux.probe(g)){i=e[M];break}i||(u.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),i={demux:D.default,remux:f.default});var U=this.demuxer,G=this.remuxer,K=i.remux,H=i.demux;G&&G instanceof K||(this.remuxer=new K(b,c,S,k)),U&&U instanceof H||(this.demuxer=new H(b,c,S),this.probe=H.probe),this.resetInitSegment(P,C,F,O),this.resetInitialTimestamp(I)},v.needsProbing=function(g,r,i){return!this.demuxer||!this.remuxer||r||i},v.getDecrypter=function(){var g=this.decrypter;return g||(g=this.decrypter=new R.default(this.observer,this.config)),g},p}(),s=function(p){return{remuxResult:{},chunkMeta:p}};function d(p){return"then"in p&&p.then instanceof Function}var a=function(p,v,g,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=p,this.videoCodec=v,this.initSegmentData=g,this.duration=r,this.defaultInitPts=i},l=function(p,v,g,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=p,this.contiguous=v,this.accurateTimeOffset=g,this.trackSwitch=r,this.timeOffset=i}},"./src/demux/tsdemuxer.ts":function(N,w,h){h.r(w),h.d(w,"discardEPB",function(){return d});var _=h("./src/demux/adts.ts"),T=h("./src/demux/mpegaudio.ts"),L=h("./src/demux/exp-golomb.ts"),R=h("./src/demux/id3.ts"),x=h("./src/demux/sample-aes.ts"),D=h("./src/events.ts"),o=h("./src/utils/mp4-tools.ts"),A=h("./src/utils/logger.ts"),m=h("./src/errors.ts"),f={video:1,audio:2,id3:3,text:4},E=function(){function a(p,v,g){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=p,this.config=v,this.typeSupported=g}a.probe=function(p){var v=a.syncOffset(p);return!(v<0||(v&&A.logger.warn("MPEG2-TS detected but first sync word found @ offset "+v+", junk ahead ?"),0))},a.syncOffset=function(p){for(var v=Math.min(1e3,p.length-564),g=0;g<v;){if(p[g]===71&&p[g+188]===71&&p[g+376]===71)return g;g++}return-1},a.createTrack=function(p,v){return{container:p==="video"||p==="audio"?"video/mp2t":void 0,type:p,id:f[p],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:p==="audio"?v:void 0}};var l=a.prototype;return l.resetInitSegment=function(p,v,g){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",g),this._audioTrack=a.createTrack("audio",g),this._id3Track=a.createTrack("id3",g),this._txtTrack=a.createTrack("text",g),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=p,this.videoCodec=v,this._duration=g},l.resetTimeStamp=function(){},l.resetContiguity=function(){var p=this._audioTrack,v=this._avcTrack,g=this._id3Track;p&&(p.pesData=null),v&&(v.pesData=null),g&&(g.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},l.demux=function(p,v,g,r){var i;g===void 0&&(g=!1),r===void 0&&(r=!1),g||(this.sampleAes=null);var c=this._avcTrack,b=this._audioTrack,S=this._id3Track,k=c.pid,C=c.pesData,I=b.pid,O=S.pid,P=b.pesData,F=S.pesData,M=!1,B=this.pmtParsed,U=this._pmtId,G=p.length;if(this.remainderData&&(G=(p=Object(o.appendUint8Array)(this.remainderData,p)).length,this.remainderData=null),G<188&&!r)return this.remainderData=p,{audioTrack:b,avcTrack:c,id3Track:S,textTrack:this._txtTrack};var K=Math.max(0,a.syncOffset(p));(G-=(G+K)%188)<p.byteLength&&!r&&(this.remainderData=new Uint8Array(p.buffer,G,p.buffer.byteLength-G));for(var H=K;H<G;H+=188)if(p[H]===71){var q=!!(64&p[H+1]),W=((31&p[H+1])<<8)+p[H+2],Y=void 0;if((48&p[H+3])>>4>1){if((Y=H+5+p[H+4])===H+188)continue}else Y=H+4;switch(W){case k:q&&(C&&(i=n(C))&&this.parseAVCPES(i,!1),C={data:[],size:0}),C&&(C.data.push(p.subarray(Y,H+188)),C.size+=H+188-Y);break;case I:q&&(P&&(i=n(P))&&(b.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),P={data:[],size:0}),P&&(P.data.push(p.subarray(Y,H+188)),P.size+=H+188-Y);break;case O:q&&(F&&(i=n(F))&&this.parseID3PES(i),F={data:[],size:0}),F&&(F.data.push(p.subarray(Y,H+188)),F.size+=H+188-Y);break;case 0:q&&(Y+=p[Y]+1),U=this._pmtId=u(p,Y);break;case U:q&&(Y+=p[Y]+1);var Z=e(p,Y,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,g);(k=Z.avc)>0&&(c.pid=k),(I=Z.audio)>0&&(b.pid=I,b.isAAC=Z.isAAC),(O=Z.id3)>0&&(S.pid=O),M&&!B&&(A.logger.log("reparse from beginning"),M=!1,H=K-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:M=!0}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});c.pesData=C,b.pesData=P,S.pesData=F;var ee={audioTrack:b,avcTrack:c,id3Track:S,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(ee),ee},l.flush=function(){var p,v=this.remainderData;return this.remainderData=null,p=v?this.demux(v,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(p),this.sampleAes?this.decrypt(p,this.sampleAes):p},l.extractRemainingSamples=function(p){var v,g=p.audioTrack,r=p.avcTrack,i=p.id3Track,c=r.pesData,b=g.pesData,S=i.pesData;c&&(v=n(c))?(this.parseAVCPES(v,!0),r.pesData=null):r.pesData=c,b&&(v=n(b))?(g.isAAC?this.parseAACPES(v):this.parseMPEGPES(v),g.pesData=null):(b!=null&&b.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=b),S&&(v=n(S))?(this.parseID3PES(v),i.pesData=null):i.pesData=S},l.demuxSampleAes=function(p,v,g){var r=this.demux(p,g,!0,!this.config.progressive),i=this.sampleAes=new x.default(this.observer,this.config,v);return this.decrypt(r,i)},l.decrypt=function(p,v){return new Promise(function(g){var r=p.audioTrack,i=p.avcTrack;r.samples&&r.isAAC?v.decryptAacSamples(r.samples,0,function(){i.samples?v.decryptAvcSamples(i.samples,0,0,function(){g(p)}):g(p)}):i.samples&&v.decryptAvcSamples(i.samples,0,0,function(){g(p)})})},l.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},l.parseAVCPES=function(p,v){var g,r=this,i=this._avcTrack,c=this.parseAVCNALu(p.data),b=this.avcSample,S=!1;p.data=null,b&&c.length&&!i.audFound&&(t(b,i),b=this.avcSample=y(!1,p.pts,p.dts,"")),c.forEach(function(k){switch(k.type){case 1:g=!0,b||(b=r.avcSample=y(!0,p.pts,p.dts,"")),b.frame=!0;var C=k.data;if(S&&C.length>4){var I=new L.default(C).readSliceType();I!==2&&I!==4&&I!==7&&I!==9||(b.key=!0)}break;case 5:g=!0,b||(b=r.avcSample=y(!0,p.pts,p.dts,"")),b.key=!0,b.frame=!0;break;case 6:g=!0;var O=new L.default(d(k.data));O.readUByte();for(var P=0,F=0,M=!1,B=0;!M&&O.bytesAvailable>1;){P=0;do P+=B=O.readUByte();while(B===255);F=0;do F+=B=O.readUByte();while(B===255);if(P===4&&O.bytesAvailable!==0){if(M=!0,O.readUByte()===181&&O.readUShort()===49&&O.readUInt()===1195456820&&O.readUByte()===3){for(var U=O.readUByte(),G=31&U,K=[U,O.readUByte()],H=0;H<G;H++)K.push(O.readUByte()),K.push(O.readUByte()),K.push(O.readUByte());s(r._txtTrack.samples,{type:3,pts:p.pts,bytes:K})}}else if(P===5&&O.bytesAvailable!==0){if(M=!0,F>16){for(var q=[],W=0;W<16;W++)q.push(O.readUByte().toString(16)),W!==3&&W!==5&&W!==7&&W!==9||q.push("-");for(var Y=F-16,Z=new Uint8Array(Y),ee=0;ee<Y;ee++)Z[ee]=O.readUByte();s(r._txtTrack.samples,{pts:p.pts,payloadType:P,uuid:q.join(""),userData:Object(R.utf8ArrayToStr)(Z),userDataBytes:Z})}}else if(F<O.bytesAvailable)for(var re=0;re<F;re++)O.readUByte()}break;case 7:if(g=!0,S=!0,!i.sps){var X=new L.default(k.data).readSPS();i.width=X.width,i.height=X.height,i.pixelRatio=X.pixelRatio,i.sps=[k.data],i.duration=r._duration;for(var ne=k.data.subarray(1,4),z="avc1.",$=0;$<3;$++){var ae=ne[$].toString(16);ae.length<2&&(ae="0"+ae),z+=ae}i.codec=z}break;case 8:g=!0,i.pps||(i.pps=[k.data]);break;case 9:g=!1,i.audFound=!0,b&&t(b,i),b=r.avcSample=y(!1,p.pts,p.dts,"");break;case 12:g=!1;break;default:g=!1,b&&(b.debug+="unknown NAL "+k.type+" ")}b&&g&&b.units.push(k)}),v&&b&&(t(b,i),this.avcSample=null)},l.getLastNalUnit=function(){var p,v,g=this.avcSample;if(!g||g.units.length===0){var r=this._avcTrack.samples;g=r[r.length-1]}if((p=g)!==null&&p!==void 0&&p.units){var i=g.units;v=i[i.length-1]}return v},l.parseAVCNALu=function(p){var v,g,r=p.byteLength,i=this._avcTrack,c=i.naluState||0,b=c,S=[],k=0,C=-1,I=0;for(c===-1&&(C=0,I=31&p[0],c=0,k=1);k<r;)if(v=p[k++],c)if(c!==1)if(v)if(v===1){if(C>=0){var O={data:p.subarray(C,k-c-1),type:I};S.push(O)}else{var P=this.getLastNalUnit();if(P&&(b&&k<=4-b&&P.state&&(P.data=P.data.subarray(0,P.data.byteLength-b)),(g=k-c-1)>0)){var F=new Uint8Array(P.data.byteLength+g);F.set(P.data,0),F.set(p.subarray(0,g),P.data.byteLength),P.data=F}}k<r?(C=k,I=31&p[k],c=0):c=-1}else c=0;else c=3;else c=v?0:2;else c=v?0:1;if(C>=0&&c>=0){var M={data:p.subarray(C,r),type:I,state:c};S.push(M)}if(S.length===0){var B=this.getLastNalUnit();if(B){var U=new Uint8Array(B.data.byteLength+p.byteLength);U.set(B.data,0),U.set(p,B.data.byteLength),B.data=U}}return i.naluState=c,S},l.parseAACPES=function(p){var v,g,r,i,c,b=0,S=this._audioTrack,k=this.aacOverFlow,C=p.data;if(k){this.aacOverFlow=null;var I=k.sample.unit.byteLength,O=Math.min(k.missing,I),P=I-O;k.sample.unit.set(C.subarray(0,O),P),S.samples.push(k.sample),b=k.missing}for(v=b,g=C.length;v<g-1&&!_.isHeader(C,v);v++);if(v===b||(v<g-1?(r="AAC PES did not start with ADTS header,offset:"+v,i=!1):(r="no ADTS header found in AAC PES",i=!0),A.logger.warn("parsing error:"+r),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:i,reason:r}),!i)){if(_.initTrackConfig(S,this.observer,C,v,this.audioCodec),p.pts!==void 0)c=p.pts;else{if(!k)return void A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var F=_.getFrameDuration(S.samplerate);c=k.sample.pts+F}for(var M=0;v<g;){if(_.isHeader(C,v)){if(v+5<g){var B=_.appendFrame(S,C,v,c,M);if(B){if(!B.missing){v+=B.length,M++;continue}this.aacOverFlow=B}}break}v++}}},l.parseMPEGPES=function(p){var v=p.data,g=v.length,r=0,i=0,c=p.pts;if(c!==void 0)for(;i<g;)if(T.isHeader(v,i)){var b=T.appendFrame(this._audioTrack,v,i,c,r);if(!b)break;i+=b.length,r++}else i++;else A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},l.parseID3PES=function(p){p.pts!==void 0?this._id3Track.samples.push(p):A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},a}();function y(a,l,p,v){return{key:a,frame:!1,pts:l,dts:p,units:[],debug:v,length:0}}function u(a,l){return(31&a[l+10])<<8|a[l+11]}function e(a,l,p,v){var g={audio:-1,avc:-1,id3:-1,isAAC:!0},r=l+3+((15&a[l+1])<<8|a[l+2])-4;for(l+=12+((15&a[l+10])<<8|a[l+11]);l<r;){var i=(31&a[l+1])<<8|a[l+2];switch(a[l]){case 207:if(!v){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:g.audio===-1&&(g.audio=i);break;case 21:g.id3===-1&&(g.id3=i);break;case 219:if(!v){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:g.avc===-1&&(g.avc=i);break;case 3:case 4:p?g.audio===-1&&(g.audio=i,g.isAAC=!1):A.logger.log("MPEG audio found, not supported in this browser");break;case 36:A.logger.warn("Unsupported HEVC stream type found")}l+=5+((15&a[l+3])<<8|a[l+4])}return g}function n(a){var l,p,v,g,r,i=0,c=a.data;if(!a||a.size===0)return null;for(;c[0].length<19&&c.length>1;){var b=new Uint8Array(c[0].length+c[1].length);b.set(c[0]),b.set(c[1],c[0].length),c[0]=b,c.splice(1,1)}if(((l=c[0])[0]<<16)+(l[1]<<8)+l[2]===1){if((p=(l[4]<<8)+l[5])&&p>a.size-6)return null;var S=l[7];192&S&&(g=536870912*(14&l[9])+4194304*(255&l[10])+16384*(254&l[11])+128*(255&l[12])+(254&l[13])/2,64&S?g-(r=536870912*(14&l[14])+4194304*(255&l[15])+16384*(254&l[16])+128*(255&l[17])+(254&l[18])/2)>54e5&&(A.logger.warn(Math.round((g-r)/9e4)+"s delta between PTS and DTS, align them"),g=r):r=g);var k=(v=l[8])+9;if(a.size<=k)return null;a.size-=k;for(var C=new Uint8Array(a.size),I=0,O=c.length;I<O;I++){var P=(l=c[I]).byteLength;if(k){if(k>P){k-=P;continue}l=l.subarray(k),P-=k,k=0}C.set(l,i),i+=P}return p&&(p-=v+3),{data:C,pts:g,dts:r,len:p}}return null}function t(a,l){if(a.units.length&&a.frame){if(a.pts===void 0){var p=l.samples,v=p.length;if(!v)return void l.dropped++;var g=p[v-1];a.pts=g.pts,a.dts=g.dts}l.samples.push(a)}a.debug.length&&A.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function s(a,l){var p=a.length;if(p>0){if(l.pts>=a[p-1].pts)a.push(l);else for(var v=p-1;v>=0;v--)if(l.pts<a[v].pts){a.splice(v,0,l);break}}else a.push(l)}function d(a){for(var l=a.byteLength,p=[],v=1;v<l-2;)a[v]===0&&a[v+1]===0&&a[v+2]===3?(p.push(v+2),v+=2):v++;if(p.length===0)return a;var g=l-p.length,r=new Uint8Array(g),i=0;for(v=0;v<g;i++,v++)i===p[0]&&(i++,p.shift()),r[v]=a[i];return r}E.minProbeByteLength=188,w.default=E},"./src/errors.ts":function(N,w,h){var _,T,L,R;h.r(w),h.d(w,"ErrorTypes",function(){return _}),h.d(w,"ErrorDetails",function(){return L}),(T=_||(_={})).NETWORK_ERROR="networkError",T.MEDIA_ERROR="mediaError",T.KEY_SYSTEM_ERROR="keySystemError",T.MUX_ERROR="muxError",T.OTHER_ERROR="otherError",(R=L||(L={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",R.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",R.KEY_SYSTEM_NO_SESSION="keySystemNoSession",R.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",R.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",R.MANIFEST_LOAD_ERROR="manifestLoadError",R.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",R.MANIFEST_PARSING_ERROR="manifestParsingError",R.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",R.LEVEL_EMPTY_ERROR="levelEmptyError",R.LEVEL_LOAD_ERROR="levelLoadError",R.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",R.LEVEL_SWITCH_ERROR="levelSwitchError",R.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",R.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",R.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",R.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",R.FRAG_LOAD_ERROR="fragLoadError",R.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",R.FRAG_DECRYPT_ERROR="fragDecryptError",R.FRAG_PARSING_ERROR="fragParsingError",R.REMUX_ALLOC_ERROR="remuxAllocError",R.KEY_LOAD_ERROR="keyLoadError",R.KEY_LOAD_TIMEOUT="keyLoadTimeOut",R.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",R.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",R.BUFFER_APPEND_ERROR="bufferAppendError",R.BUFFER_APPENDING_ERROR="bufferAppendingError",R.BUFFER_STALLED_ERROR="bufferStalledError",R.BUFFER_FULL_ERROR="bufferFullError",R.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",R.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",R.INTERNAL_EXCEPTION="internalException",R.INTERNAL_ABORTED="aborted",R.UNKNOWN="unknown"},"./src/events.ts":function(N,w,h){var _,T;h.r(w),h.d(w,"Events",function(){return _}),(T=_||(_={})).MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return t});var _=h("./node_modules/url-toolkit/src/url-toolkit.js"),T=h("./src/loader/playlist-loader.ts"),L=h("./src/loader/key-loader.ts"),R=h("./src/controller/id3-track-controller.ts"),x=h("./src/controller/latency-controller.ts"),D=h("./src/controller/level-controller.ts"),o=h("./src/controller/fragment-tracker.ts"),A=h("./src/controller/stream-controller.ts"),m=h("./src/is-supported.ts"),f=h("./src/utils/logger.ts"),E=h("./src/config.ts"),y=h("./node_modules/eventemitter3/index.js"),u=h("./src/events.ts"),e=h("./src/errors.ts");function n(s,d){for(var a=0;a<d.length;a++){var l=d[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}var t=function(){function s(v){v===void 0&&(v={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var g=this.config=Object(E.mergeConfig)(s.DefaultConfig,v);this.userConfig=v,Object(f.enableLogs)(g.debug),this._autoLevelCapping=-1,g.progressive&&Object(E.enableStreamingMode)(g);var r=g.abrController,i=g.bufferController,c=g.capLevelController,b=g.fpsController,S=this.abrController=new r(this),k=this.bufferController=new i(this),C=this.capLevelController=new c(this),I=new b(this),O=new T.default(this),P=new L.default(this),F=new R.default(this),M=this.levelController=new D.default(this),B=new o.FragmentTracker(this),U=this.streamController=new A.default(this,B);C.setStreamController(U),I.setStreamController(U);var G=[M,U];this.networkControllers=G;var K=[O,P,S,k,C,I,F,B];this.audioTrackController=this.createController(g.audioTrackController,null,G),this.createController(g.audioStreamController,B,G),this.subtitleTrackController=this.createController(g.subtitleTrackController,null,G),this.createController(g.subtitleStreamController,B,G),this.createController(g.timelineController,null,K),this.emeController=this.createController(g.emeController,null,K),this.latencyController=this.createController(x.default,null,K),this.coreComponents=K}s.isSupported=function(){return Object(m.isSupported)()};var d,a,l,p=s.prototype;return p.createController=function(v,g,r){if(v){var i=g?new v(this,g):new v(this);return r&&r.push(i),i}return null},p.on=function(v,g,r){r===void 0&&(r=this),this._emitter.on(v,g,r)},p.once=function(v,g,r){r===void 0&&(r=this),this._emitter.once(v,g,r)},p.removeAllListeners=function(v){this._emitter.removeAllListeners(v)},p.off=function(v,g,r,i){r===void 0&&(r=this),this._emitter.off(v,g,r,i)},p.listeners=function(v){return this._emitter.listeners(v)},p.emit=function(v,g,r){return this._emitter.emit(v,g,r)},p.trigger=function(v,g){if(this.config.debug)return this.emit(v,v,g);try{return this.emit(v,v,g)}catch(r){f.logger.error("An internal error happened while handling event "+v+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(u.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:v,error:r})}return!1},p.listenerCount=function(v){return this._emitter.listenerCount(v)},p.destroy=function(){f.logger.log("destroy"),this.trigger(u.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(v){return v.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(v){return v.destroy()}),this.coreComponents.length=0},p.attachMedia=function(v){f.logger.log("attachMedia"),this._media=v,this.trigger(u.Events.MEDIA_ATTACHING,{media:v})},p.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(u.Events.MEDIA_DETACHING,void 0),this._media=null},p.loadSource=function(v){this.stopLoad();var g=this.media,r=this.url,i=this.url=_.buildAbsoluteURL(self.location.href,v,{alwaysNormalize:!0});f.logger.log("loadSource:"+i),g&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(g)),this.trigger(u.Events.MANIFEST_LOADING,{url:v})},p.startLoad=function(v){v===void 0&&(v=-1),f.logger.log("startLoad("+v+")"),this.networkControllers.forEach(function(g){g.startLoad(v)})},p.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach(function(v){v.stopLoad()})},p.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},p.recoverMediaError=function(){f.logger.log("recoverMediaError");var v=this._media;this.detachMedia(),v&&this.attachMedia(v)},p.removeLevel=function(v,g){g===void 0&&(g=0),this.levelController.removeLevel(v,g)},d=s,l=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return u.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:E.hlsDefaultConfig},set:function(v){s.defaultConfig=v}}],(a=[{key:"levels",get:function(){var v=this.levelController.levels;return v||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(v){f.logger.log("set currentLevel:"+v),this.loadLevel=v,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(v){f.logger.log("set nextLevel:"+v),this.levelController.manualLevel=v,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(v){f.logger.log("set loadLevel:"+v),this.levelController.manualLevel=v}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(v){this.levelController.nextLoadLevel=v}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(v){f.logger.log("set firstLevel:"+v),this.levelController.firstLevel=v}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(v){f.logger.log("set startLevel:"+v),v!==-1&&(v=Math.max(v,this.minAutoLevel)),this.levelController.startLevel=v}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(v){var g=!!v;g!==this.config.capLevelToPlayerSize&&(g?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=g)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(v){this._autoLevelCapping!==v&&(f.logger.log("set autoLevelCapping:"+v),this._autoLevelCapping=v)}},{key:"bandwidthEstimate",get:function(){var v=this.abrController.bwEstimator;return v?v.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var v=this.levels,g=this.config.minAutoBitrate;if(!v)return 0;for(var r=v.length,i=0;i<r;i++)if(v[i].maxBitrate>g)return i;return 0}},{key:"maxAutoLevel",get:function(){var v=this.levels,g=this.autoLevelCapping;return g===-1&&v&&v.length?v.length-1:g}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(v){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,v)}},{key:"audioTracks",get:function(){var v=this.audioTrackController;return v?v.audioTracks:[]}},{key:"audioTrack",get:function(){var v=this.audioTrackController;return v?v.audioTrack:-1},set:function(v){var g=this.audioTrackController;g&&(g.audioTrack=v)}},{key:"subtitleTracks",get:function(){var v=this.subtitleTrackController;return v?v.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var v=this.subtitleTrackController;return v?v.subtitleTrack:-1},set:function(v){var g=this.subtitleTrackController;g&&(g.subtitleTrack=v)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var v=this.subtitleTrackController;return!!v&&v.subtitleDisplay},set:function(v){var g=this.subtitleTrackController;g&&(g.subtitleDisplay=v)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(v){this.config.lowLatencyMode=v}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&n(d.prototype,a),l&&n(d,l),s}();t.defaultConfig=void 0},"./src/is-supported.ts":function(N,w,h){h.r(w),h.d(w,"isSupported",function(){return L}),h.d(w,"changeTypeSupported",function(){return R});var _=h("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var x=Object(_.getMediaSource)();if(!x)return!1;var D=T(),o=x&&typeof x.isTypeSupported=="function"&&x.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),A=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!o&&!!A}function R(){var x,D=T();return typeof(D==null||(x=D.prototype)===null||x===void 0?void 0:x.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return m}),h.d(w,"LoadError",function(){return E});var _=h("./src/polyfills/number.ts"),T=h("./src/errors.ts");function L(y){var u=typeof Map=="function"?new Map:void 0;return(L=function(e){if(e===null||(n=e,Function.toString.call(n).indexOf("[native code]")===-1))return e;var n;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(e))return u.get(e);u.set(e,t)}function t(){return R(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),D(t,e)})(y)}function R(y,u,e){return(R=x()?Reflect.construct:function(n,t,s){var d=[null];d.push.apply(d,t);var a=new(Function.bind.apply(n,d));return s&&D(a,s.prototype),a}).apply(null,arguments)}function x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(y,u){return(D=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(y,u)}function o(y){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)})(y)}var A=Math.pow(2,17),m=function(){function y(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var u=y.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(e,n){var t=this,s=e.url;if(!s)return Promise.reject(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var d=this.config,a=d.fLoader,l=d.loader;return new Promise(function(p,v){t.loader&&t.loader.destroy();var g=t.loader=e.loader=a?new a(d):new l(d),r=f(e),i={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:A};e.stats=g.stats,g.load(r,i,{onSuccess:function(c,b,S,k){t.resetLoader(e,g),p({frag:e,part:null,payload:c.data,networkDetails:k})},onError:function(c,b,S){t.resetLoader(e,g),v(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:c,networkDetails:S}))},onAbort:function(c,b,S){t.resetLoader(e,g),v(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:S}))},onTimeout:function(c,b,S){t.resetLoader(e,g),v(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:S}))},onProgress:function(c,b,S,k){n&&n({frag:e,part:null,payload:S,networkDetails:k})}})})},u.loadPart=function(e,n,t){var s=this;this.abort();var d=this.config,a=d.fLoader,l=d.loader;return new Promise(function(p,v){s.loader&&s.loader.destroy();var g=s.loader=e.loader=a?new a(d):new l(d),r=f(e,n),i={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:A};n.stats=g.stats,g.load(r,i,{onSuccess:function(c,b,S,k){s.resetLoader(e,g),s.updateStatsFromPart(e,n);var C={frag:e,part:n,payload:c.data,networkDetails:k};t(C),p(C)},onError:function(c,b,S){s.resetLoader(e,g),v(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:n,response:c,networkDetails:S}))},onAbort:function(c,b,S){e.stats.aborted=n.stats.aborted,s.resetLoader(e,g),v(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:n,networkDetails:S}))},onTimeout:function(c,b,S){s.resetLoader(e,g),v(new E({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:n,networkDetails:S}))}})})},u.updateStatsFromPart=function(e,n){var t=e.stats,s=n.stats,d=s.total;if(t.loaded+=s.loaded,d){var a=Math.round(e.duration/n.duration),l=Math.min(Math.round(t.loaded/d),a),p=(a-l)*Math.round(t.loaded/l);t.total=t.loaded+p}else t.total=Math.max(t.loaded,t.total);var v=t.loading,g=s.loading;v.start?v.first+=g.first-g.start:(v.start=g.start,v.first=g.first),v.end=g.end},u.resetLoader=function(e,n){e.loader=null,this.loader===n&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),n.destroy()},y}();function f(y,u){u===void 0&&(u=null);var e=u||y,n={frag:y,part:u,responseType:"arraybuffer",url:e.url,rangeStart:0,rangeEnd:0},t=e.byteRangeStartOffset,s=e.byteRangeEndOffset;return Object(_.isFiniteNumber)(t)&&Object(_.isFiniteNumber)(s)&&(n.rangeStart=t,n.rangeEnd=s),n}var E=function(y){var u,e;function n(t){for(var s,d=arguments.length,a=new Array(d>1?d-1:0),l=1;l<d;l++)a[l-1]=arguments[l];return(s=y.call.apply(y,[this].concat(a))||this).data=void 0,s.data=t,s}return e=y,(u=n).prototype=Object.create(e.prototype),u.prototype.constructor=u,D(u,e),n}(L(Error))},"./src/loader/fragment.ts":function(N,w,h){h.r(w),h.d(w,"ElementaryStreamTypes",function(){return _}),h.d(w,"BaseSegment",function(){return y}),h.d(w,"Fragment",function(){return u}),h.d(w,"Part",function(){return e});var _,T,L=h("./src/polyfills/number.ts"),R=h("./node_modules/url-toolkit/src/url-toolkit.js"),x=h("./src/utils/logger.ts"),D=h("./src/loader/level-key.ts"),o=h("./src/loader/load-stats.ts");function A(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,m(n,t)}function m(n,t){return(m=Object.setPrototypeOf||function(s,d){return s.__proto__=d,s})(n,t)}function f(n,t){for(var s=0;s<t.length;s++){var d=t[s];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(n,d.key,d)}}function E(n,t,s){return t&&f(n.prototype,t),s&&f(n,s),n}(T=_||(_={})).AUDIO="audio",T.VIDEO="video",T.AUDIOVIDEO="audiovideo";var y=function(){function n(t){var s;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((s={})[_.AUDIO]=null,s[_.VIDEO]=null,s[_.AUDIOVIDEO]=null,s),this.baseurl=t}return n.prototype.setByteRange=function(t,s){var d=t.split("@",2),a=[];d.length===1?a[0]=s?s.byteRangeEndOffset:0:a[0]=parseInt(d[1]),a[1]=parseInt(d[0])+a[0],this._byteRange=a},E(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(R.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),n}(),u=function(n){function t(d,a){var l;return(l=n.call(this,a)||this)._decryptdata=null,l.rawProgramDateTime=null,l.programDateTime=null,l.tagList=[],l.duration=0,l.sn=0,l.levelkey=void 0,l.type=void 0,l.loader=null,l.level=-1,l.cc=0,l.startPTS=void 0,l.endPTS=void 0,l.appendedPTS=void 0,l.startDTS=void 0,l.endDTS=void 0,l.start=0,l.deltaPTS=void 0,l.maxStartPTS=void 0,l.minEndPTS=void 0,l.stats=new o.LoadStats,l.urlId=0,l.data=void 0,l.bitrateTest=!1,l.title=null,l.initSegment=null,l.type=d,l}A(t,n);var s=t.prototype;return s.createInitializationVector=function(d){for(var a=new Uint8Array(16),l=12;l<16;l++)a[l]=d>>8*(15-l)&255;return a},s.setDecryptDataFromLevelKey=function(d,a){var l=d;return(d==null?void 0:d.method)==="AES-128"&&d.uri&&!d.iv&&((l=D.LevelKey.fromURI(d.uri)).method=d.method,l.iv=this.createInitializationVector(a),l.keyFormat="identity"),l},s.setElementaryStreamInfo=function(d,a,l,p,v,g){g===void 0&&(g=!1);var r=this.elementaryStreams,i=r[d];i?(i.startPTS=Math.min(i.startPTS,a),i.endPTS=Math.max(i.endPTS,l),i.startDTS=Math.min(i.startDTS,p),i.endDTS=Math.max(i.endDTS,v)):r[d]={startPTS:a,endPTS:l,startDTS:p,endDTS:v,partial:g}},s.clearElementaryStreamInfo=function(){var d=this.elementaryStreams;d[_.AUDIO]=null,d[_.VIDEO]=null,d[_.AUDIOVIDEO]=null},E(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var d=this.sn;typeof d!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&x.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),d=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,d)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(L.isFiniteNumber)(this.programDateTime))return null;var d=Object(L.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*d}},{key:"encrypted",get:function(){var d;return!((d=this.decryptdata)===null||d===void 0||!d.keyFormat||!this.decryptdata.uri)}}]),t}(y),e=function(n){function t(s,d,a,l,p){var v;(v=n.call(this,a)||this).fragOffset=0,v.duration=0,v.gap=!1,v.independent=!1,v.relurl=void 0,v.fragment=void 0,v.index=void 0,v.stats=new o.LoadStats,v.duration=s.decimalFloatingPoint("DURATION"),v.gap=s.bool("GAP"),v.independent=s.bool("INDEPENDENT"),v.relurl=s.enumeratedString("URI"),v.fragment=d,v.index=l;var g=s.enumeratedString("BYTERANGE");return g&&v.setByteRange(g,p),p&&(v.fragOffset=p.fragOffset+p.duration),v}return A(t,n),E(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var s=this.elementaryStreams;return!!(s.audio||s.video||s.audiovideo)}}]),t}(y)},"./src/loader/key-loader.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return R});var _=h("./src/events.ts"),T=h("./src/errors.ts"),L=h("./src/utils/logger.ts"),R=function(){function x(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var D=x.prototype;return D._registerListeners=function(){this.hls.on(_.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(_.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var A=this.loaders[o];A&&A.destroy()}this.loaders={}},D.onKeyLoading=function(o,A){var m=A.frag,f=m.type,E=this.loaders[f];if(m.decryptdata){var y=m.decryptdata.uri;if(y!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(E&&(L.logger.warn("abort previous key loader for type:"+f),E.abort()),!y)return void L.logger.warn("key uri is falsy");var e=u.loader,n=m.loader=this.loaders[f]=new e(u);this.decrypturl=y,this.decryptkey=null;var t={url:y,frag:m,responseType:"arraybuffer"},s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.load(t,s,d)}else this.decryptkey&&(m.decryptdata.key=this.decryptkey,this.hls.trigger(_.Events.KEY_LOADED,{frag:m}))}else L.logger.warn("Missing decryption data on fragment in onKeyLoading")},D.loadsuccess=function(o,A,m){var f=m.frag;f.decryptdata?(this.decryptkey=f.decryptdata.key=new Uint8Array(o.data),f.loader=null,delete this.loaders[f.type],this.hls.trigger(_.Events.KEY_LOADED,{frag:f})):L.logger.error("after key load, decryptdata unset")},D.loaderror=function(o,A){var m=A.frag,f=m.loader;f&&f.abort(),delete this.loaders[m.type],this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:m,response:o})},D.loadtimeout=function(o,A){var m=A.frag,f=m.loader;f&&f.abort(),delete this.loaders[m.type],this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:m})},x}()},"./src/loader/level-details.ts":function(N,w,h){h.r(w),h.d(w,"LevelDetails",function(){return L});var _=h("./src/polyfills/number.ts");function T(R,x){for(var D=0;D<x.length;D++){var o=x[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(R,o.key,o)}}var L=function(){function R(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var x,D;return R.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var A=this.lastPartSn-o.lastPartSn,m=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!m||!!A,this.advanced=this.endSN>o.endSN||A>0||A===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},x=R,(D=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(_.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&T(x.prototype,D),R}()},"./src/loader/level-key.ts":function(N,w,h){h.r(w),h.d(w,"LevelKey",function(){return L});var _=h("./node_modules/url-toolkit/src/url-toolkit.js");function T(R,x){for(var D=0;D<x.length;D++){var o=x[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(R,o.key,o)}}var L=function(){function R(o,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=A?Object(_.buildAbsoluteURL)(o,A,{alwaysNormalize:!0}):o}var x,D;return R.fromURL=function(o,A){return new R(o,A)},R.fromURI=function(o){return new R(o)},x=R,(D=[{key:"uri",get:function(){return this._uri}}])&&T(x.prototype,D),R}()},"./src/loader/load-stats.ts":function(N,w,h){h.r(w),h.d(w,"LoadStats",function(){return _});var _=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return e});var _=h("./src/polyfills/number.ts"),T=h("./node_modules/url-toolkit/src/url-toolkit.js"),L=h("./src/loader/fragment.ts"),R=h("./src/loader/level-details.ts"),x=h("./src/loader/level-key.ts"),D=h("./src/utils/attr-list.ts"),o=h("./src/utils/logger.ts"),A=h("./src/utils/codecs.ts"),m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,f=/#EXT-X-MEDIA:(.*)/g,E=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i,e=function(){function d(){}return d.findGroup=function(a,l){for(var p=0;p<a.length;p++){var v=a[p];if(v.id===l)return v}},d.convertAVC1ToAVCOTI=function(a){var l=a.split(".");if(l.length>2){var p=l.shift()+".";return p+=parseInt(l.shift()).toString(16),p+=("000"+parseInt(l.shift()).toString(16)).substr(-4)}return a},d.resolve=function(a,l){return T.buildAbsoluteURL(l,a,{alwaysNormalize:!0})},d.parseMasterPlaylist=function(a,l){var p,v=[],g={},r=!1;for(m.lastIndex=0;(p=m.exec(a))!=null;)if(p[1]){var i=new D.AttrList(p[1]),c={attrs:i,bitrate:i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),name:i.NAME,url:d.resolve(p[2],l)},b=i.decimalResolution("RESOLUTION");b&&(c.width=b.width,c.height=b.height),n((i.CODECS||"").split(/[ ,]+/).filter(function(k){return k}),c),c.videoCodec&&c.videoCodec.indexOf("avc1")!==-1&&(c.videoCodec=d.convertAVC1ToAVCOTI(c.videoCodec)),v.push(c)}else if(p[3]){var S=new D.AttrList(p[3]);S["DATA-ID"]&&(r=!0,g[S["DATA-ID"]]=S)}return{levels:v,sessionData:r?g:null}},d.parseMasterPlaylistMedia=function(a,l,p,v){var g;v===void 0&&(v=[]);var r=[],i=0;for(f.lastIndex=0;(g=f.exec(a))!==null;){var c=new D.AttrList(g[1]);if(c.TYPE===p){var b={attrs:c,bitrate:0,id:i++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:p,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?d.resolve(c.URI,l):""};if(v.length){var S=d.findGroup(v,b.groupId)||v[0];t(b,S,"audioCodec"),t(b,S,"textCodec")}r.push(b)}}return r},d.parseLevelPlaylist=function(a,l,p,v,g){var r,i,c,b=new R.LevelDetails(l),S=b.fragments,k=null,C=0,I=0,O=0,P=0,F=null,M=new L.Fragment(v,l),B=-1,U=!1;for(E.lastIndex=0,b.m3u8=a;(r=E.exec(a))!==null;){U&&(U=!1,(M=new L.Fragment(v,l)).start=O,M.sn=C,M.cc=P,M.level=p,k&&(M.initSegment=k,M.rawProgramDateTime=k.rawProgramDateTime));var G=r[1];if(G){M.duration=parseFloat(G);var K=(" "+r[2]).slice(1);M.title=K||null,M.tagList.push(K?["INF",G,K]:["INF",G])}else if(r[3])Object(_.isFiniteNumber)(M.duration)&&(M.start=O,c&&(M.levelkey=c),M.sn=C,M.level=p,M.cc=P,M.urlId=g,S.push(M),M.relurl=(" "+r[3]).slice(1),s(M,F),F=M,O+=M.duration,C++,I=0,U=!0);else if(r[4]){var H=(" "+r[4]).slice(1);F?M.setByteRange(H,F):M.setByteRange(H)}else if(r[5])M.rawProgramDateTime=(" "+r[5]).slice(1),M.tagList.push(["PROGRAM-DATE-TIME",M.rawProgramDateTime]),B===-1&&(B=S.length);else{if(!(r=r[0].match(y))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<r.length&&r[i]===void 0;i++);var q=(" "+r[i]).slice(1),W=(" "+r[i+1]).slice(1),Y=r[i+2]?(" "+r[i+2]).slice(1):"";switch(q){case"PLAYLIST-TYPE":b.type=W.toUpperCase();break;case"MEDIA-SEQUENCE":C=b.startSN=parseInt(W);break;case"SKIP":var Z=new D.AttrList(W),ee=Z.decimalInteger("SKIPPED-SEGMENTS");if(Object(_.isFiniteNumber)(ee)){b.skippedSegments=ee;for(var re=ee;re--;)S.unshift(null);C+=ee}var X=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");X&&(b.recentlyRemovedDateranges=X.split("	"));break;case"TARGETDURATION":b.targetduration=parseFloat(W);break;case"VERSION":b.version=parseInt(W);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"#":(W||Y)&&M.tagList.push(Y?[W,Y]:[W]);break;case"DIS":P++;case"GAP":M.tagList.push([q]);break;case"BITRATE":M.tagList.push([q,W]);break;case"DISCONTINUITY-SEQ":P=parseInt(W);break;case"KEY":var ne,z=new D.AttrList(W),$=z.enumeratedString("METHOD"),ae=z.URI,ie=z.hexadecimalInteger("IV"),ue=z.enumeratedString("KEYFORMATVERSIONS"),ve=z.enumeratedString("KEYID"),ge=(ne=z.enumeratedString("KEYFORMAT"))!=null?ne:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(ge)>-1){o.logger.warn("Keyformat "+ge+" is not supported from the manifest");continue}if(ge!=="identity")continue;$&&(c=x.LevelKey.fromURL(l,ae),ae&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf($)>=0&&(c.method=$,c.keyFormat=ge,ve&&(c.keyID=ve),ue&&(c.keyFormatVersions=ue),c.iv=ie));break;case"START":var me=new D.AttrList(W).decimalFloatingPoint("TIME-OFFSET");Object(_.isFiniteNumber)(me)&&(b.startTimeOffset=me);break;case"MAP":var le=new D.AttrList(W);M.relurl=le.URI,le.BYTERANGE&&M.setByteRange(le.BYTERANGE),M.level=p,M.sn="initSegment",c&&(M.levelkey=c),M.initSegment=null,k=M,U=!0;break;case"SERVER-CONTROL":var oe=new D.AttrList(W);b.canBlockReload=oe.bool("CAN-BLOCK-RELOAD"),b.canSkipUntil=oe.optionalFloat("CAN-SKIP-UNTIL",0),b.canSkipDateRanges=b.canSkipUntil>0&&oe.bool("CAN-SKIP-DATERANGES"),b.partHoldBack=oe.optionalFloat("PART-HOLD-BACK",0),b.holdBack=oe.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Me=new D.AttrList(W);b.partTarget=Me.decimalFloatingPoint("PART-TARGET");break;case"PART":var ye=b.partList;ye||(ye=b.partList=[]);var Ae=I>0?ye[ye.length-1]:void 0,Ne=I++,De=new L.Part(new D.AttrList(W),M,l,Ne,Ae);ye.push(De),M.duration+=De.duration;break;case"PRELOAD-HINT":var be=new D.AttrList(W);b.preloadHint=be;break;case"RENDITION-REPORT":var Ke=new D.AttrList(W);b.renditionReports=b.renditionReports||[],b.renditionReports.push(Ke);break;default:o.logger.warn("line parsed but not handled: "+r)}}}F&&!F.relurl?(S.pop(),O-=F.duration,b.partList&&(b.fragmentHint=F)):b.partList&&(s(M,F),M.cc=P,b.fragmentHint=M);var Be=S.length,Se=S[0],Ve=S[Be-1];if((O+=b.skippedSegments*b.targetduration)>0&&Be&&Ve){b.averagetargetduration=O/Be;var Ue=Ve.sn;b.endSN=Ue!=="initSegment"?Ue:0,Se&&(b.startCC=Se.cc,Se.initSegment||b.fragments.every(function(Re){return Re.relurl&&(Le=Re.relurl,u.test((_e=(Ee=T.parseURL(Le))===null||Ee===void 0?void 0:Ee.path)!=null?_e:""));var Le,_e,Ee})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(M=new L.Fragment(v,l)).relurl=Ve.relurl,M.level=p,M.sn="initSegment",Se.initSegment=M,b.needSidxRanges=!0))}else b.endSN=0,b.startCC=0;return b.fragmentHint&&(O+=b.fragmentHint.duration),b.totalduration=O,b.endCC=P,B>0&&function(Re,Le){for(var _e=Re[Le],Ee=Le;Ee--;){var xe=Re[Ee];if(!xe)return;xe.programDateTime=_e.programDateTime-1e3*xe.duration,_e=xe}}(S,B),b},d}();function n(d,a){["video","audio","text"].forEach(function(l){var p=d.filter(function(g){return Object(A.isCodecType)(g,l)});if(p.length){var v=p.filter(function(g){return g.lastIndexOf("avc1",0)===0||g.lastIndexOf("mp4a",0)===0});a[l+"Codec"]=v.length>0?v[0]:p[0],d=d.filter(function(g){return p.indexOf(g)===-1})}}),a.unknownCodecs=d}function t(d,a,l){var p=a[l];p&&(d[l]=p)}function s(d,a){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):a!=null&&a.programDateTime&&(d.programDateTime=a.endProgramDateTime),Object(_.isFiniteNumber)(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),L=h("./src/errors.ts"),R=h("./src/utils/logger.ts"),x=h("./src/utils/mp4-tools.ts"),D=h("./src/loader/m3u8-parser.ts"),o=h("./src/types/loader.ts"),A=h("./src/utils/attr-list.ts");function m(E,y){var u=E.url;return u!==void 0&&u.indexOf("data:")!==0||(u=y.url),u}var f=function(){function E(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var y=E.prototype;return y.registerListeners=function(){var u=this.hls;u.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.unregisterListeners=function(){var u=this.hls;u.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.createInternalLoader=function(u){var e=this.hls.config,n=e.pLoader,t=e.loader,s=new(n||t)(e);return u.loader=s,this.loaders[u.type]=s,s},y.getInternalLoader=function(u){return this.loaders[u.type]},y.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},y.destroyInternalLoaders=function(){for(var u in this.loaders){var e=this.loaders[u];e&&e.destroy(),this.resetInternalLoader(u)}},y.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},y.onManifestLoading=function(u,e){var n=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})},y.onLevelLoading=function(u,e){var n=e.id,t=e.level,s=e.url,d=e.deliveryDirectives;this.load({id:n,groupId:null,level:t,responseType:"text",type:o.PlaylistContextType.LEVEL,url:s,deliveryDirectives:d})},y.onAudioTrackLoading=function(u,e){var n=e.id,t=e.groupId,s=e.url,d=e.deliveryDirectives;this.load({id:n,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:d})},y.onSubtitleTrackLoading=function(u,e){var n=e.id,t=e.groupId,s=e.url,d=e.deliveryDirectives;this.load({id:n,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:d})},y.load=function(u){var e,n,t,s,d,a,l=this.hls.config,p=this.getInternalLoader(u);if(p){var v=p.context;if(v&&v.url===u.url)return void R.logger.trace("[playlist-loader]: playlist request ongoing");R.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),p.abort()}switch(u.type){case o.PlaylistContextType.MANIFEST:n=l.manifestLoadingMaxRetry,t=l.manifestLoadingTimeOut,s=l.manifestLoadingRetryDelay,d=l.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:n=0,t=l.levelLoadingTimeOut;break;default:n=l.levelLoadingMaxRetry,t=l.levelLoadingTimeOut,s=l.levelLoadingRetryDelay,d=l.levelLoadingMaxRetryTimeout}if(p=this.createInternalLoader(u),(e=u.deliveryDirectives)!==null&&e!==void 0&&e.part&&(u.type===o.PlaylistContextType.LEVEL&&u.level!==null?a=this.hls.levels[u.level].details:u.type===o.PlaylistContextType.AUDIO_TRACK&&u.id!==null?a=this.hls.audioTracks[u.id].details:u.type===o.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(a=this.hls.subtitleTracks[u.id].details),a)){var g=a.partTarget,r=a.targetduration;g&&r&&(t=Math.min(1e3*Math.max(3*g,.8*r),t))}var i={timeout:t,maxRetry:n,retryDelay:s,maxRetryDelay:d,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};p.load(u,i,c)},y.loadsuccess=function(u,e,n,t){if(t===void 0&&(t=null),n.isSidxRequest)return this.handleSidxRequest(u,n),void this.handlePlaylistLoaded(u,e,n,t);this.resetInternalLoader(n.type);var s=u.data;s.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,e,n,t):this.handleMasterPlaylist(u,e,n,t)):this.handleManifestParsingError(u,n,"no EXTM3U delimiter",t)},y.loaderror=function(u,e,n){n===void 0&&(n=null),this.handleNetworkError(e,n,!1,u)},y.loadtimeout=function(u,e,n){n===void 0&&(n=null),this.handleNetworkError(e,n,!0)},y.handleMasterPlaylist=function(u,e,n,t){var s=this.hls,d=u.data,a=m(u,n),l=D.default.parseMasterPlaylist(d,a),p=l.levels,v=l.sessionData;if(p.length){var g=p.map(function(S){return{id:S.attrs.AUDIO,audioCodec:S.audioCodec}}),r=p.map(function(S){return{id:S.attrs.SUBTITLES,textCodec:S.textCodec}}),i=D.default.parseMasterPlaylistMedia(d,a,"AUDIO",g),c=D.default.parseMasterPlaylistMedia(d,a,"SUBTITLES",r),b=D.default.parseMasterPlaylistMedia(d,a,"CLOSED-CAPTIONS");i.length&&(i.some(function(S){return!S.url})||!p[0].audioCodec||p[0].attrs.AUDIO||(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),i.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))),s.trigger(T.Events.MANIFEST_LOADED,{levels:p,audioTracks:i,subtitles:c,captions:b,url:a,stats:e,networkDetails:t,sessionData:v})}else this.handleManifestParsingError(u,n,"no level found in manifest",t)},y.handleTrackOrLevelPlaylist=function(u,e,n,t){var s=this.hls,d=n.id,a=n.level,l=n.type,p=m(u,n),v=Object(_.isFiniteNumber)(d)?d:0,g=Object(_.isFiniteNumber)(a)?a:v,r=function(k){switch(k.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(n),i=D.default.parseLevelPlaylist(u.data,p,g,r,v);if(i.fragments.length){if(l===o.PlaylistContextType.MANIFEST){var c={attrs:new A.AttrList({}),bitrate:0,details:i,name:"",url:p};s.trigger(T.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:p,stats:e,networkDetails:t,sessionData:null})}if(e.parsing.end=performance.now(),i.needSidxRanges){var b,S=(b=i.fragments[0].initSegment)===null||b===void 0?void 0:b.url;this.load({url:S,isSidxRequest:!0,type:l,level:a,levelDetails:i,id:d,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=i,this.handlePlaylistLoaded(u,e,n,t)}else s.trigger(T.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof n.level=="number"?n.level:void 0})},y.handleSidxRequest=function(u,e){var n=Object(x.parseSegmentIndex)(new Uint8Array(u.data));if(n){var t=n.references,s=e.levelDetails;t.forEach(function(d,a){var l=d.info,p=s.fragments[a];p.byteRange.length===0&&p.setByteRange(String(1+l.end-l.start)+"@"+String(l.start)),p.initSegment&&p.initSegment.setByteRange(String(n.moovEndOffset)+"@0")})}},y.handleManifestParsingError=function(u,e,n,t){this.hls.trigger(T.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===o.PlaylistContextType.MANIFEST,url:u.url,reason:n,response:u,context:e,networkDetails:t})},y.handleNetworkError=function(u,e,n,t){n===void 0&&(n=!1),R.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var s=L.ErrorDetails.UNKNOWN,d=!1,a=this.getInternalLoader(u);switch(u.type){case o.PlaylistContextType.MANIFEST:s=n?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case o.PlaylistContextType.LEVEL:s=n?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case o.PlaylistContextType.AUDIO_TRACK:s=n?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:s=n?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,d=!1}a&&this.resetInternalLoader(u.type);var l={type:L.ErrorTypes.NETWORK_ERROR,details:s,fatal:d,url:u.url,loader:a,context:u,networkDetails:e};t&&(l.response=t),this.hls.trigger(T.Events.ERROR,l)},y.handlePlaylistLoaded=function(u,e,n,t){var s=n.type,d=n.level,a=n.id,l=n.groupId,p=n.loader,v=n.levelDetails,g=n.deliveryDirectives;if(v!=null&&v.targetduration){if(p)switch(v.live&&(p.getCacheAge&&(v.ageHeader=p.getCacheAge()||0),p.getCacheAge&&!isNaN(v.ageHeader)||(v.ageHeader=0)),s){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:v,level:d||0,id:a||0,stats:e,networkDetails:t,deliveryDirectives:g});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:v,id:a||0,groupId:l||"",stats:e,networkDetails:t,deliveryDirectives:g});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:v,id:a||0,groupId:l||"",stats:e,networkDetails:t,deliveryDirectives:g})}}else this.handleManifestParsingError(u,n,"invalid target duration",t)},E}();w.default=f},"./src/polyfills/number.ts":function(N,w,h){h.r(w),h.d(w,"isFiniteNumber",function(){return _}),h.d(w,"MAX_SAFE_INTEGER",function(){return T});var _=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(N,w,h){h.r(w);var _=function(){function T(){}return T.getSilentFrame=function(L,R){switch(L){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},T}();w.default=_},"./src/remux/mp4-generator.ts":function(N,w,h){h.r(w);var _=Math.pow(2,32)-1,T=function(){function L(){}return L.init=function(){var R;for(R in L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},L.types)L.types.hasOwnProperty(R)&&(L.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var x=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:x,audio:D};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),A=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=A,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),f=new Uint8Array([97,118,99,49]),E=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,m,E,m,f),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,o))},L.box=function(R){for(var x=8,D=arguments.length,o=new Array(D>1?D-1:0),A=1;A<D;A++)o[A-1]=arguments[A];for(var m=o.length,f=m;m--;)x+=o[m].byteLength;var E=new Uint8Array(x);for(E[0]=x>>24&255,E[1]=x>>16&255,E[2]=x>>8&255,E[3]=255&x,E.set(R,4),m=0,x=8;m<f;m++)E.set(o[m],x),x+=o[m].byteLength;return E},L.hdlr=function(R){return L.box(L.types.hdlr,L.HDLR_TYPES[R])},L.mdat=function(R){return L.box(L.types.mdat,R)},L.mdhd=function(R,x){x*=R;var D=Math.floor(x/(_+1)),o=Math.floor(x%(_+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},L.mdia=function(R){return L.box(L.types.mdia,L.mdhd(R.timescale,R.duration),L.hdlr(R.type),L.minf(R))},L.mfhd=function(R){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},L.minf=function(R){return R.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(R)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(R))},L.moof=function(R,x,D){return L.box(L.types.moof,L.mfhd(R),L.traf(D,x))},L.moov=function(R){for(var x=R.length,D=[];x--;)D[x]=L.trak(R[x]);return L.box.apply(null,[L.types.moov,L.mvhd(R[0].timescale,R[0].duration)].concat(D).concat(L.mvex(R)))},L.mvex=function(R){for(var x=R.length,D=[];x--;)D[x]=L.trex(R[x]);return L.box.apply(null,[L.types.mvex].concat(D))},L.mvhd=function(R,x){x*=R;var D=Math.floor(x/(_+1)),o=Math.floor(x%(_+1)),A=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,A)},L.sdtp=function(R){var x,D,o=R.samples||[],A=new Uint8Array(4+o.length);for(x=0;x<o.length;x++)D=o[x].flags,A[x+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return L.box(L.types.sdtp,A)},L.stbl=function(R){return L.box(L.types.stbl,L.stsd(R),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(R){var x,D,o,A=[],m=[];for(x=0;x<R.sps.length;x++)o=(D=R.sps[x]).byteLength,A.push(o>>>8&255),A.push(255&o),A=A.concat(Array.prototype.slice.call(D));for(x=0;x<R.pps.length;x++)o=(D=R.pps[x]).byteLength,m.push(o>>>8&255),m.push(255&o),m=m.concat(Array.prototype.slice.call(D));var f=L.box(L.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|R.sps.length].concat(A).concat([R.pps.length]).concat(m))),E=R.width,y=R.height,u=R.pixelRatio[0],e=R.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,E>>8&255,255&E,y>>8&255,255&y,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,e>>24,e>>16&255,e>>8&255,255&e])))},L.esds=function(R){var x=R.config.length;return new Uint8Array([0,0,0,0,3,23+x,0,1,0,4,15+x,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([x]).concat(R.config).concat([6,1,2]))},L.mp4a=function(R){var x=R.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,x>>8&255,255&x,0,0]),L.box(L.types.esds,L.esds(R)))},L.mp3=function(R){var x=R.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,x>>8&255,255&x,0,0]))},L.stsd=function(R){return R.type==="audio"?R.isAAC||R.codec!=="mp3"?L.box(L.types.stsd,L.STSD,L.mp4a(R)):L.box(L.types.stsd,L.STSD,L.mp3(R)):L.box(L.types.stsd,L.STSD,L.avc1(R))},L.tkhd=function(R){var x=R.id,D=R.duration*R.timescale,o=R.width,A=R.height,m=Math.floor(D/(_+1)),f=Math.floor(D%(_+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,255&x,0,0,0,0,m>>24,m>>16&255,m>>8&255,255&m,f>>24,f>>16&255,f>>8&255,255&f,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,A>>8&255,255&A,0,0]))},L.traf=function(R,x){var D=L.sdtp(R),o=R.id,A=Math.floor(x/(_+1)),m=Math.floor(x%(_+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,A>>24,A>>16&255,A>>8&255,255&A,m>>24,m>>16&255,m>>8&255,255&m])),L.trun(R,D.length+16+20+8+16+8+8),D)},L.trak=function(R){return R.duration=R.duration||4294967295,L.box(L.types.trak,L.tkhd(R),L.mdia(R))},L.trex=function(R){var x=R.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,255&x,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(R,x){var D,o,A,m,f,E,y=R.samples||[],u=y.length,e=12+16*u,n=new Uint8Array(e);for(x+=8+e,n.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,x>>>24&255,x>>>16&255,x>>>8&255,255&x],0),D=0;D<u;D++)A=(o=y[D]).duration,m=o.size,f=o.flags,E=o.cts,n.set([A>>>24&255,A>>>16&255,A>>>8&255,255&A,m>>>24&255,m>>>16&255,m>>>8&255,255&m,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,E>>>24&255,E>>>16&255,E>>>8&255,255&E],12+16*D);return L.box(L.types.trun,n)},L.initSegment=function(R){L.types||L.init();var x=L.moov(R),D=new Uint8Array(L.FTYP.byteLength+x.byteLength);return D.set(L.FTYP),D.set(x,L.FTYP.byteLength),D},L}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0,w.default=T},"./src/remux/mp4-remuxer.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return u}),h.d(w,"normalizePts",function(){return e});var _=h("./src/polyfills/number.ts"),T=h("./src/remux/aac-helper.ts"),L=h("./src/remux/mp4-generator.ts"),R=h("./src/events.ts"),x=h("./src/errors.ts"),D=h("./src/utils/logger.ts"),o=h("./src/types/loader.ts"),A=h("./src/utils/timescale-conversion.ts");function m(){return(m=Object.assign||function(s){for(var d=1;d<arguments.length;d++){var a=arguments[d];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(s[l]=a[l])}return s}).apply(this,arguments)}var f=null,E=null,y=!1,u=function(){function s(a,l,p,v){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=l,this.typeSupported=p,this.ISGenerated=!1,f===null){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);f=g?parseInt(g[1]):0}if(E===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);E=r?parseInt(r[1]):0}y=!!f&&f<75||!!E&&E<600}var d=s.prototype;return d.destroy=function(){},d.resetTimeStamp=function(a){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},d.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},d.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},d.getVideoStartPts=function(a){var l=!1,p=a.reduce(function(v,g){var r=g.pts-v;return r<-4294967296?(l=!0,e(v,g.pts)):r>0?v:g.pts},a[0].pts);return l&&D.logger.debug("PTS rollover detected"),p},d.remux=function(a,l,p,v,g,r,i,c){var b,S,k,C,I,O,P=g,F=g,M=a.pid>-1,B=l.pid>-1,U=l.samples.length,G=a.samples.length>0,K=U>1;if((!M||G)&&(!B||K)||this.ISGenerated||i){this.ISGenerated||(k=this.generateIS(a,l,g));var H=this.isVideoContiguous,q=-1;if(K&&(q=function(re){for(var X=0;X<re.length;X++)if(re[X].key)return X;return-1}(l.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(O=!0,q>0){D.logger.warn("[mp4-remuxer]: Dropped "+q+" out of "+U+" video samples due to a missing keyframe");var W=this.getVideoStartPts(l.samples);l.samples=l.samples.slice(q),l.dropped+=q,F+=(l.samples[0].pts-W)/(l.timescale||9e4)}else q===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+U+" video samples"),O=!1);if(this.ISGenerated){if(G&&K){var Y=this.getVideoStartPts(l.samples),Z=(e(a.samples[0].pts,Y)-Y)/l.inputTimeScale;P+=Math.max(0,Z),F+=Math.max(0,-Z)}if(G){if(a.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),k=this.generateIS(a,l,g)),S=this.remuxAudio(a,P,this.isAudioContiguous,r,B||K||c===o.PlaylistLevelType.AUDIO?F:void 0),K){var ee=S?S.endPTS-S.startPTS:0;l.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),k=this.generateIS(a,l,g)),b=this.remuxVideo(l,F,H,ee)}}else K&&(b=this.remuxVideo(l,F,H,0));b&&(b.firstKeyFrame=q,b.independent=q!==-1)}}return this.ISGenerated&&(p.samples.length&&(I=this.remuxID3(p,g)),v.samples.length&&(C=this.remuxText(v,g))),{audio:S,video:b,initSegment:k,independent:O,text:C,id3:I}},d.generateIS=function(a,l,p){var v,g,r,i=a.samples,c=l.samples,b=this.typeSupported,S={},k=!Object(_.isFiniteNumber)(this._initPTS),C="audio/mp4";if(k&&(v=g=1/0),a.config&&i.length&&(a.timescale=a.samplerate,a.isAAC||(b.mpeg?(C="audio/mpeg",a.codec=""):b.mp3&&(a.codec="mp3")),S.audio={id:"audio",container:C,codec:a.codec,initSegment:!a.isAAC&&b.mpeg?new Uint8Array(0):L.default.initSegment([a]),metadata:{channelCount:a.channelCount}},k&&(r=a.inputTimeScale,v=g=i[0].pts-Math.round(r*p))),l.sps&&l.pps&&c.length&&(l.timescale=l.inputTimeScale,S.video={id:"main",container:"video/mp4",codec:l.codec,initSegment:L.default.initSegment([l]),metadata:{width:l.width,height:l.height}},k)){r=l.inputTimeScale;var I=this.getVideoStartPts(c),O=Math.round(r*p);g=Math.min(g,e(c[0].dts,I)-O),v=Math.min(v,I-O)}if(Object.keys(S).length)return this.ISGenerated=!0,k&&(this._initPTS=v,this._initDTS=g),{tracks:S,initPTS:v,timescale:r}},d.remuxVideo=function(a,l,p,v){var g,r,i,c=a.inputTimeScale,b=a.samples,S=[],k=b.length,C=this._initPTS,I=this.nextAvcDts,O=8,P=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,M=0,B=!1;p&&I!==null||(I=l*c-(b[0].pts-e(b[0].dts,b[0].pts)));for(var U=0;U<k;U++){var G=b[U];G.pts=e(G.pts-C,I),G.dts=e(G.dts-C,I),G.dts>G.pts&&(M=Math.max(Math.min(M,G.pts-G.dts),-18e3)),G.dts<b[U>0?U-1:U].dts&&(B=!0)}B&&b.sort(function(Ee,xe){var mt=Ee.dts-xe.dts,yt=Ee.pts-xe.pts;return mt||yt}),r=b[0].dts,i=b[b.length-1].dts;var K=Math.round((i-r)/(k-1));if(M<0){if(M<-2*K){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(A.toMsFromMpegTsClock)(-K,!0)+" ms");for(var H=M,q=0;q<k;q++)b[q].dts=H=Math.max(H,b[q].pts-K),b[q].pts=Math.max(H,b[q].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(A.toMsFromMpegTsClock)(M,!0)+" ms to overcome this issue");for(var W=0;W<k;W++)b[W].dts=b[W].dts+M}r=b[0].dts}if(p){var Y=r-I,Z=Y>K;if(Z||Y<-1){Z?D.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(Y,!0)+" ms ("+Y+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(-Y,!0)+" ms ("+Y+"dts) overlapping between fragments detected"),r=I;var ee=b[0].pts-Y;b[0].dts=r,b[0].pts=ee,D.logger.log("Video: First PTS/DTS adjusted: "+Object(A.toMsFromMpegTsClock)(ee,!0)+"/"+Object(A.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(A.toMsFromMpegTsClock)(Y,!0)+" ms")}}y&&(r=Math.max(0,r));for(var re=0,X=0,ne=0;ne<k;ne++){for(var z=b[ne],$=z.units,ae=$.length,ie=0,ue=0;ue<ae;ue++)ie+=$[ue].data.length;X+=ie,re+=ae,z.length=ie,z.dts=Math.max(z.dts,r),z.pts=Math.max(z.pts,z.dts,0),P=Math.min(z.pts,P),F=Math.max(z.pts,F)}i=b[k-1].dts;var ve,ge=X+4*re+8;try{ve=new Uint8Array(ge)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:x.ErrorTypes.MUX_ERROR,details:x.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating video mdat "+ge})}var me=new DataView(ve.buffer);me.setUint32(0,ge),ve.set(L.default.types.mdat,4);for(var le=0;le<k;le++){for(var oe=b[le],Me=oe.units,ye=0,Ae=0,Ne=Me.length;Ae<Ne;Ae++){var De=Me[Ae],be=De.data,Ke=De.data.byteLength;me.setUint32(O,Ke),O+=4,ve.set(be,O),O+=Ke,ye+=4+Ke}if(le<k-1)g=b[le+1].dts-oe.dts;else{var Be=this.config,Se=oe.dts-b[le>0?le-1:le].dts;if(Be.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ve=Math.floor(Be.maxBufferHole*c),Ue=(v?P+v*c:this.nextAudioPts)-oe.pts;Ue>Ve?((g=Ue-Se)<0&&(g=Se),D.logger.log("[mp4-remuxer]: It is approximately "+Ue/90+" ms to the next segment; using duration "+g/90+" ms for the last video frame.")):g=Se}else g=Se}var Re=Math.round(oe.pts-oe.dts);S.push(new n(oe.key,g,ye,Re))}if(S.length&&f&&f<70){var Le=S[0].flags;Le.dependsOn=2,Le.isNonSync=0}console.assert(g!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=I=i+g,this.isVideoContiguous=!0;var _e={data1:L.default.moof(a.sequenceNumber++,r,m({},a,{samples:S})),data2:ve,startPTS:P/c,endPTS:(F+g)/c,startDTS:r/c,endDTS:I/c,type:"video",hasAudio:!1,hasVideo:!0,nb:S.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(ve.length,"MDAT length must not be zero"),_e},d.remuxAudio=function(a,l,p,v,g){var r=a.inputTimeScale,i=r/(a.samplerate?a.samplerate:r),c=a.isAAC?1024:1152,b=c*i,S=this._initPTS,k=!a.isAAC&&this.typeSupported.mpeg,C=[],I=a.samples,O=k?0:8,P=this.nextAudioPts||-1,F=l*r;if(this.isAudioContiguous=p=p||I.length&&P>0&&(v&&Math.abs(F-P)<9e3||Math.abs(e(I[0].pts-S,F)-P)<20*b),I.forEach(function(be){be.pts=e(be.pts-S,F)}),!p||P<0){if(!(I=I.filter(function(be){return be.pts>=0})).length)return;P=g===0?0:v?Math.max(0,F):I[0].pts}if(a.isAAC)for(var M=g!==void 0,B=this.config.maxAudioFramesDrift,U=0,G=P;U<I.length;U++){var K=I[U],H=K.pts,q=H-G,W=Math.abs(1e3*q/r);if(q<=-B*b&&M)U===0&&(D.logger.warn("Audio frame @ "+(H/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*q/r)+" ms."),this.nextAudioPts=P=G=H);else if(q>=B*b&&W<1e4&&M){var Y=Math.round(q/b);(G=H-Y*b)<0&&(Y--,G+=b),U===0&&(this.nextAudioPts=P=G),D.logger.warn("[mp4-remuxer]: Injecting "+Y+" audio frame @ "+(G/r).toFixed(3)+"s due to "+Math.round(1e3*q/r)+" ms gap.");for(var Z=0;Z<Y;Z++){var ee=Math.max(G,0),re=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);re||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),re=K.unit.subarray()),I.splice(U,0,{unit:re,pts:ee}),G+=b,U++}}K.pts=G,G+=b}for(var X,ne=null,z=null,$=0,ae=I.length;ae--;)$+=I[ae].unit.byteLength;for(var ie=0,ue=I.length;ie<ue;ie++){var ve=I[ie],ge=ve.unit,me=ve.pts;if(z!==null)C[ie-1].duration=Math.round((me-z)/i);else{if(p&&a.isAAC&&(me=P),ne=me,!($>0))return;$+=O;try{X=new Uint8Array($)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:x.ErrorTypes.MUX_ERROR,details:x.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:$,reason:"fail allocating audio mdat "+$})}k||(new DataView(X.buffer).setUint32(0,$),X.set(L.default.types.mdat,4))}X.set(ge,O);var le=ge.byteLength;O+=le,C.push(new n(!0,c,le,0)),z=me}var oe=C.length;if(oe){var Me=C[C.length-1];this.nextAudioPts=P=z+i*Me.duration;var ye=k?new Uint8Array(0):L.default.moof(a.sequenceNumber++,ne/i,m({},a,{samples:C}));a.samples=[];var Ae=ne/r,Ne=P/r,De={data1:ye,data2:X,startPTS:Ae,endPTS:Ne,startDTS:Ae,endDTS:Ne,type:"audio",hasAudio:!0,hasVideo:!1,nb:oe};return this.isAudioContiguous=!0,console.assert(X.length,"MDAT length must not be zero"),De}},d.remuxEmptyAudio=function(a,l,p,v){var g=a.inputTimeScale,r=g/(a.samplerate?a.samplerate:g),i=this.nextAudioPts,c=(i!==null?i:v.startDTS*g)+this._initDTS,b=v.endDTS*g+this._initDTS,S=1024*r,k=Math.ceil((b-c)/S),C=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),C){for(var I=[],O=0;O<k;O++){var P=c+O*S;I.push({unit:C,pts:P,dts:P})}return a.samples=I,this.remuxAudio(a,l,p,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},d.remuxID3=function(a,l){var p=a.samples.length;if(p){for(var v=a.inputTimeScale,g=this._initPTS,r=this._initDTS,i=0;i<p;i++){var c=a.samples[i];c.pts=e(c.pts-g,l*v)/v,c.dts=e(c.dts-r,l*v)/v}var b=a.samples;return a.samples=[],{samples:b}}},d.remuxText=function(a,l){var p=a.samples.length;if(p){for(var v=a.inputTimeScale,g=this._initPTS,r=0;r<p;r++){var i=a.samples[r];i.pts=e(i.pts-g,l*v)/v}a.samples.sort(function(b,S){return b.pts-S.pts});var c=a.samples;return a.samples=[],{samples:c}}},s}();function e(s,d){var a;if(d===null)return s;for(a=d<s?-8589934592:8589934592;Math.abs(s-d)>4294967296;)s+=a;return s}var n=function(s,d,a,l){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=d,this.size=a,this.cts=l,this.flags=new t(s)},t=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1}},"./src/remux/passthrough-remuxer.ts":function(N,w,h){h.r(w);var _=h("./src/polyfills/number.ts"),T=h("./src/utils/mp4-tools.ts"),L=h("./src/loader/fragment.ts"),R=h("./src/utils/logger.ts"),x=function(){function A(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=A.prototype;return m.destroy=function(){},m.resetTimeStamp=function(f){this.initPTS=f,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(f,E,y){this.audioCodec=E,this.videoCodec=y,this.generateInitSegment(f),this.emitInitSegment=!0},m.generateInitSegment=function(f){var E=this.audioCodec,y=this.videoCodec;if(!f||!f.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var u=this.initData=Object(T.parseInitSegment)(f);E||(E=o(u.audio,L.ElementaryStreamTypes.AUDIO)),y||(y=o(u.video,L.ElementaryStreamTypes.VIDEO));var e={};u.audio&&u.video?e.audiovideo={container:"video/mp4",codec:E+","+y,initSegment:f,id:"main"}:u.audio?e.audio={container:"audio/mp4",codec:E,initSegment:f,id:"audio"}:u.video?e.video={container:"video/mp4",codec:y,initSegment:f,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},m.remux=function(f,E,y,u,e){var n=this.initPTS,t=this.lastEndDTS,s={audio:void 0,video:void 0,text:u,id3:y,initSegment:void 0};Object(_.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var d=E.samples;if(!d||!d.length)return s;var a={initPTS:void 0,timescale:1},l=this.initData;if(l&&l.length||(this.generateInitSegment(d),l=this.initData),!l||!l.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(a.tracks=this.initTracks,this.emitInitSegment=!1),Object(_.isFiniteNumber)(n)||(this.initPTS=a.initPTS=n=D(l,d,t));var p=Object(T.getDuration)(d,l),v=t,g=p+v;Object(T.offsetStartDTS)(l,d,n),p>0?this.lastEndDTS=g:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!l.audio,i=!!l.video,c="";r&&(c+="audio"),i&&(c+="video");var b={data1:d,startPTS:v,startDTS:v,endPTS:g,endDTS:g,type:c,hasAudio:r,hasVideo:i,nb:1,dropped:0};return s.audio=b.type==="audio"?b:void 0,s.video=b.type!=="audio"?b:void 0,s.text=u,s.id3=y,s.initSegment=a,s},A}(),D=function(A,m,f){return Object(T.getStartDTS)(A,m)-f};function o(A,m){var f=A==null?void 0:A.codec;return f&&f.length>4?f:f==="hvc1"?"hvc1.1.c.L120.90":f==="av01"?"av01.0.04M.08":f==="avc1"||m===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}w.default=x},"./src/task-loop.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=T.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},L.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},L.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},T}()},"./src/types/level.ts":function(N,w,h){function _(o,A){for(var m=0;m<A.length;m++){var f=A[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(o,f.key,f)}}var T,L;function R(o,A){var m=o.canSkipUntil,f=o.canSkipDateRanges,E=o.endSN;return m&&(A!==void 0?A-E:0)<m?f?T.v2:T.Yes:T.No}h.r(w),h.d(w,"HlsSkip",function(){return T}),h.d(w,"getSkipValue",function(){return R}),h.d(w,"HlsUrlParameters",function(){return x}),h.d(w,"Level",function(){return D}),(L=T||(T={})).No="",L.Yes="YES",L.v2="v2";var x=function(){function o(A,m,f){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=A,this.part=m,this.skip=f}return o.prototype.addDirectives=function(A){var m=new self.URL(A);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},o}(),D=function(){function o(f){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[f.url],this.attrs=f.attrs,this.bitrate=f.bitrate,f.details&&(this.details=f.details),this.id=f.id||0,this.name=f.name,this.width=f.width||0,this.height=f.height||0,this.audioCodec=f.audioCodec,this.videoCodec=f.videoCodec,this.unknownCodecs=f.unknownCodecs,this.codecSet=[f.videoCodec,f.audioCodec].filter(function(E){return E}).join(",").replace(/\.[^.,]+/g,"")}var A,m;return A=o,(m=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(f){var E=f%this.url.length;this._urlId!==E&&(this.details=void 0,this._urlId=E)}}])&&_(A.prototype,m),o}()},"./src/types/loader.ts":function(N,w,h){var _,T,L,R;h.r(w),h.d(w,"PlaylistContextType",function(){return _}),h.d(w,"PlaylistLevelType",function(){return L}),(T=_||(_={})).MANIFEST="manifest",T.LEVEL="level",T.AUDIO_TRACK="audioTrack",T.SUBTITLE_TRACK="subtitleTrack",(R=L||(L={})).MAIN="main",R.AUDIO="audio",R.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(N,w,h){h.r(w),h.d(w,"ChunkMetadata",function(){return _});var _=function(T,L,R,x,D,o){x===void 0&&(x=0),D===void 0&&(D=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=T,this.sn=L,this.id=R,this.size=x,this.part=D,this.partial=o}},"./src/utils/attr-list.ts":function(N,w,h){h.r(w),h.d(w,"AttrList",function(){return L});var _=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function R(D){for(var o in typeof D=="string"&&(D=R.parseAttrList(D)),D)D.hasOwnProperty(o)&&(this[o]=D[o])}var x=R.prototype;return x.decimalInteger=function(D){var o=parseInt(this[D],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},x.hexadecimalInteger=function(D){if(this[D]){var o=(this[D]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var A=new Uint8Array(o.length/2),m=0;m<o.length/2;m++)A[m]=parseInt(o.slice(2*m,2*m+2),16);return A}return null},x.hexadecimalIntegerAsNumber=function(D){var o=parseInt(this[D],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},x.decimalFloatingPoint=function(D){return parseFloat(this[D])},x.optionalFloat=function(D,o){var A=this[D];return A?parseFloat(A):o},x.enumeratedString=function(D){return this[D]},x.bool=function(D){return this[D]==="YES"},x.decimalResolution=function(D){var o=_.exec(this[D]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},R.parseAttrList=function(D){var o,A={};for(T.lastIndex=0;(o=T.exec(D))!==null;){var m=o[2];m.indexOf('"')===0&&m.lastIndexOf('"')===m.length-1&&(m=m.slice(1,-1)),A[o[1]]=m}return A},R}()},"./src/utils/binary-search.ts":function(N,w,h){h.r(w),w.default={search:function(_,T){for(var L=0,R=_.length-1,x=null,D=null;L<=R;){var o=T(D=_[x=(L+R)/2|0]);if(o>0)L=x+1;else{if(!(o<0))return D;R=x-1}}return null}}},"./src/utils/buffer-helper.ts":function(N,w,h){h.r(w),h.d(w,"BufferHelper",function(){return L});var _=h("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function R(){}return R.isBuffered=function(x,D){try{if(x){for(var o=R.getBuffered(x),A=0;A<o.length;A++)if(D>=o.start(A)&&D<=o.end(A))return!0}}catch{}return!1},R.bufferInfo=function(x,D,o){try{if(x){var A,m=R.getBuffered(x),f=[];for(A=0;A<m.length;A++)f.push({start:m.start(A),end:m.end(A)});return this.bufferedInfo(f,D,o)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},R.bufferedInfo=function(x,D,o){D=Math.max(0,D),x.sort(function(a,l){var p=a.start-l.start;return p||l.end-a.end});var A=[];if(o)for(var m=0;m<x.length;m++){var f=A.length;if(f){var E=A[f-1].end;x[m].start-E<o?x[m].end>E&&(A[f-1].end=x[m].end):A.push(x[m])}else A.push(x[m])}else A=x;for(var y,u=0,e=D,n=D,t=0;t<A.length;t++){var s=A[t].start,d=A[t].end;if(D+o>=s&&D<d)e=s,u=(n=d)-D;else if(D+o<s){y=s;break}}return{len:u,start:e||0,end:n||0,nextStart:y}},R.getBuffered=function(x){try{return x.buffered}catch(D){return _.logger.log("failed to get media.buffered",D),T}},R}()},"./src/utils/cea-608-parser.ts":function(N,w,h){h.r(w),h.d(w,"Row",function(){return s}),h.d(w,"CaptionScreen",function(){return d});var _,T,L=h("./src/utils/logger.ts"),R={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},x=function(g){var r=g;return R.hasOwnProperty(g)&&(r=R[g]),String.fromCharCode(r)},D=15,o=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},E={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(T=_||(_={}))[T.ERROR=0]="ERROR",T[T.TEXT=1]="TEXT",T[T.WARNING=2]="WARNING",T[T.INFO=2]="INFO",T[T.DEBUG=3]="DEBUG",T[T.DATA=3]="DATA";var u=function(){function g(){this.time=null,this.verboseLevel=_.ERROR}return g.prototype.log=function(r,i){this.verboseLevel>=r&&L.logger.log(this.time+" ["+r+"] "+i)},g}(),e=function(g){for(var r=[],i=0;i<g.length;i++)r.push(g[i].toString(16));return r},n=function(){function g(i,c,b,S,k){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=c||!1,this.italics=b||!1,this.background=S||"black",this.flash=k||!1}var r=g.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(i){for(var c=["foreground","underline","italics","background","flash"],b=0;b<c.length;b++){var S=c[b];i.hasOwnProperty(S)&&(this[S]=i[S])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash},r.copy=function(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),t=function(){function g(i,c,b,S,k,C){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new n(c,b,S,k,C)}var r=g.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(i,c){this.uchar=i,this.penState.copy(c)},r.setPenState=function(i){this.penState.copy(i)},r.equals=function(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)},r.copy=function(i){this.uchar=i.uchar,this.penState.copy(i.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),s=function(){function g(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<o;c++)this.chars.push(new t);this.logger=i,this.pos=0,this.currPenState=new n}var r=g.prototype;return r.equals=function(i){for(var c=!0,b=0;b<o;b++)if(!this.chars[b].equals(i.chars[b])){c=!1;break}return c},r.copy=function(i){for(var c=0;c<o;c++)this.chars[c].copy(i.chars[c])},r.isEmpty=function(){for(var i=!0,c=0;c<o;c++)if(!this.chars[c].isEmpty()){i=!1;break}return i},r.setCursor=function(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(i){var c=this.pos+i;if(i>1)for(var b=this.pos+1;b<c+1;b++)this.chars[b].setPenState(this.currPenState);this.setCursor(c)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(i){i>=144&&this.backSpace();var c=x(i);this.pos>=o?this.logger.log(_.ERROR,"Cannot insert "+i.toString(16)+" ("+c+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(c,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(i){var c;for(c=i;c<o;c++)this.chars[c].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var i=[],c=!0,b=0;b<o;b++){var S=this.chars[b].uchar;S!==" "&&(c=!1),i.push(S)}return c?"":i.join("")},r.setPenStyles=function(i){this.currPenState.setStyles(i),this.chars[this.pos].setPenState(this.currPenState)},g}(),d=function(){function g(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<D;c++)this.rows.push(new s(i));this.logger=i,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=g.prototype;return r.reset=function(){for(var i=0;i<D;i++)this.rows[i].clear();this.currRow=14},r.equals=function(i){for(var c=!0,b=0;b<D;b++)if(!this.rows[b].equals(i.rows[b])){c=!1;break}return c},r.copy=function(i){for(var c=0;c<D;c++)this.rows[c].copy(i.rows[c])},r.isEmpty=function(){for(var i=!0,c=0;c<D;c++)if(!this.rows[c].isEmpty()){i=!1;break}return i},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(i){this.rows[this.currRow].insertChar(i)},r.setPen=function(i){this.rows[this.currRow].setPenStyles(i)},r.moveCursor=function(i){this.rows[this.currRow].moveCursor(i)},r.setCursor=function(i){this.logger.log(_.INFO,"setCursor: "+i),this.rows[this.currRow].setCursor(i)},r.setPAC=function(i){this.logger.log(_.INFO,"pacData = "+JSON.stringify(i));var c=i.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1&&(c=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==c){for(var b=0;b<D;b++)this.rows[b].clear();var S=this.currRow+1-this.nrRollUpRows,k=this.lastOutputScreen;if(k){var C=k.rows[S].cueStartTime,I=this.logger.time;if(C&&I!==null&&C<I)for(var O=0;O<this.nrRollUpRows;O++)this.rows[c-this.nrRollUpRows+O+1].copy(k.rows[S+O])}}this.currRow=c;var P=this.rows[this.currRow];if(i.indent!==null){var F=i.indent,M=Math.max(F-1,0);P.setCursor(i.indent),i.color=P.chars[M].penState.foreground}var B={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(i){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)},r.setRollUpRows=function(i){this.nrRollUpRows=i},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(_.TEXT,this.getDisplayText());var i=this.currRow+1-this.nrRollUpRows,c=this.rows.splice(i,1)[0];c.clear(),this.rows.splice(this.currRow,0,c),this.logger.log(_.INFO,"Rolling up")}else this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(i){i=i||!1;for(var c=[],b="",S=-1,k=0;k<D;k++){var C=this.rows[k].getTextString();C&&(S=k+1,i?c.push("Row "+S+": '"+C+"'"):c.push(C.trim()))}return c.length>0&&(b=i?"["+c.join(" | ")+"]":c.join(`
`)),b},r.getTextAndFormat=function(){return this.rows},g}(),a=function(){function g(i,c,b){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new d(b),this.nonDisplayedMemory=new d(b),this.lastOutputScreen=new d(b),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=b}var r=g.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(i){this.outputFilter=i},r.setPAC=function(i){this.writeScreen.setPAC(i)},r.setBkgData=function(i){this.writeScreen.setBkgData(i)},r.setMode=function(i){i!==this.mode&&(this.mode=i,this.logger.log(_.INFO,"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)},r.insertChars=function(i){for(var c=0;c<i.length;c++)this.writeScreen.insertChar(i[c]);var b=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,b+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(_.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(i){this.logger.log(_.INFO,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)},r.ccFON=function(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(i){this.logger.log(_.INFO,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)},r.ccMIDROW=function(i){var c={flash:!1};if(c.underline=i%2==1,c.italics=i>=46,c.italics)c.foreground="white";else{var b=Math.floor(i/2)-16;c.foreground=["white","green","blue","cyan","red","yellow","magenta"][b]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(c)),this.writeScreen.setPen(c)},r.outputDataUpdate=function(i){i===void 0&&(i=!1);var c=this.logger.time;c!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,c,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:c):this.cueStartTime=c,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))},g}(),l=function(){function g(i,c,b){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var S=new u;this.channels=[null,new a(i,c,S),new a(i+1,b,S)],this.cmdHistory={a:null,b:null},this.logger=S}var r=g.prototype;return r.getHandler=function(i){return this.channels[i].getHandler()},r.setHandler=function(i,c){this.channels[i].setHandler(c)},r.addData=function(i,c){var b,S,k,C=!1;this.logger.time=i;for(var I=0;I<c.length;I+=2)if(S=127&c[I],k=127&c[I+1],S!==0||k!==0){if(this.logger.log(_.DATA,"["+e([c[I],c[I+1]])+"] -> ("+e([S,k])+")"),(b=this.parseCmd(S,k))||(b=this.parseMidrow(S,k)),b||(b=this.parsePAC(S,k)),b||(b=this.parseBackgroundAttributes(S,k)),!b&&(C=this.parseChars(S,k))){var O=this.currentChannel;O&&O>0?this.channels[O].insertChars(C):this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}b||C||this.logger.log(_.WARNING,"Couldn't parse cleaned data "+e([S,k])+" orig: "+e([c[I],c[I+1]]))}},r.parseCmd=function(i,c){var b=this.cmdHistory;if(!((i===20||i===28||i===21||i===29)&&c>=32&&c<=47||(i===23||i===31)&&c>=33&&c<=35))return!1;if(v(i,c,b))return p(null,null,b),this.logger.log(_.DEBUG,"Repeated command ("+e([i,c])+") is dropped"),!0;var S=i===20||i===21||i===23?1:2,k=this.channels[S];return i===20||i===21||i===28||i===29?c===32?k.ccRCL():c===33?k.ccBS():c===34?k.ccAOF():c===35?k.ccAON():c===36?k.ccDER():c===37?k.ccRU(2):c===38?k.ccRU(3):c===39?k.ccRU(4):c===40?k.ccFON():c===41?k.ccRDC():c===42?k.ccTR():c===43?k.ccRTD():c===44?k.ccEDM():c===45?k.ccCR():c===46?k.ccENM():c===47&&k.ccEOC():k.ccTO(c-32),p(i,c,b),this.currentChannel=S,!0},r.parseMidrow=function(i,c){var b=0;if((i===17||i===25)&&c>=32&&c<=47){if((b=i===17?1:2)!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[b];return!!S&&(S.ccMIDROW(c),this.logger.log(_.DEBUG,"MIDROW ("+e([i,c])+")"),!0)}return!1},r.parsePAC=function(i,c){var b,S=this.cmdHistory;if(!((i>=17&&i<=23||i>=25&&i<=31)&&c>=64&&c<=127||(i===16||i===24)&&c>=64&&c<=95))return!1;if(v(i,c,S))return p(null,null,S),!0;var k=i<=23?1:2;b=c>=64&&c<=95?k===1?A[i]:f[i]:k===1?m[i]:E[i];var C=this.channels[k];return!!C&&(C.setPAC(this.interpretPAC(b,c)),p(i,c,S),this.currentChannel=k,!0)},r.interpretPAC=function(i,c){var b,S={color:null,italics:!1,indent:null,underline:!1,row:i};return b=c>95?c-96:c-64,S.underline=(1&b)==1,b<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(b/2)]:b<=15?(S.italics=!0,S.color="white"):S.indent=4*Math.floor((b-16)/2),S},r.parseChars=function(i,c){var b,S,k=null,C=null;if(i>=25?(b=2,C=i-8):(b=1,C=i),C>=17&&C<=19?(S=C===17?c+80:C===18?c+112:c+144,this.logger.log(_.INFO,"Special char '"+x(S)+"' in channel "+b),k=[S]):i>=32&&i<=127&&(k=c===0?[i]:[i,c]),k){var I=e(k);this.logger.log(_.DEBUG,"Char codes =  "+I.join(",")),p(i,c,this.cmdHistory)}return k},r.parseBackgroundAttributes=function(i,c){var b;if(!((i===16||i===24)&&c>=32&&c<=47||(i===23||i===31)&&c>=45&&c<=47))return!1;var S={};i===16||i===24?(b=Math.floor((c-32)/2),S.background=y[b],c%2==1&&(S.background=S.background+"_semi")):c===45?S.background="transparent":(S.foreground="black",c===47&&(S.underline=!0));var k=i<=23?1:2;return this.channels[k].setBkgData(S),p(i,c,this.cmdHistory),!0},r.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var c=this.channels[i];c&&c.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(i){for(var c=0;c<this.channels.length;c++){var b=this.channels[c];b&&b.cueSplitAtTime(i)}},g}();function p(g,r,i){i.a=g,i.b=r}function v(g,r,i){return i.a===g&&i.b===r}w.default=l},"./src/utils/codecs.ts":function(N,w,h){h.r(w),h.d(w,"isCodecType",function(){return T}),h.d(w,"isCodecSupportedInMp4",function(){return L});var _={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(R,x){var D=_[x];return!!D&&D[R.slice(0,4)]===!0}function L(R,x){return MediaSource.isTypeSupported((x||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function(N,w,h){h.r(w);var _=h("./src/utils/vttparser.ts"),T=h("./src/utils/webvtt-parser.ts"),L=h("./src/utils/texttrack-utils.ts"),R=/\s/,x={newCue:function(D,o,A,m){for(var f,E,y,u,e,n=[],t=self.VTTCue||self.TextTrackCue,s=0;s<m.rows.length;s++)if(y=!0,u=0,e="",!(f=m.rows[s]).isEmpty()){for(var d=0;d<f.chars.length;d++)R.test(f.chars[d].uchar)&&y?u++:(e+=f.chars[d].uchar,y=!1);f.cueStartTime=o,o===A&&(A+=1e-4),u>=16?u--:u++;var a=Object(_.fixLineBreaks)(e.trim()),l=Object(T.generateCueId)(o,A,a);D&&D.cues&&D.cues.getCueById(l)||((E=new t(o,A,a)).id=l,E.line=s+1,E.align="left",E.position=10+Math.min(80,10*Math.floor(8*u/32)),n.push(E))}return D&&n.length&&(n.sort(function(p,v){return p.line==="auto"||v.line==="auto"?0:p.line>8&&v.line>8?v.line-p.line:p.line-v.line}),n.forEach(function(p){return Object(L.addCueToTrack)(D,p)})),n}};w.default=x},"./src/utils/discontinuities.ts":function(N,w,h){h.r(w),h.d(w,"findFirstFragWithCC",function(){return R}),h.d(w,"shouldAlignOnDiscontinuities",function(){return x}),h.d(w,"findDiscontinuousReferenceFrag",function(){return D}),h.d(w,"adjustSlidingStart",function(){return A}),h.d(w,"alignStream",function(){return m}),h.d(w,"alignPDT",function(){return f});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/logger.ts"),L=h("./src/controller/level-helper.ts");function R(E,y){for(var u=null,e=0,n=E.length;e<n;e++){var t=E[e];if(t&&t.cc===y){u=t;break}}return u}function x(E,y,u){return!(!y.details||!(u.endCC>u.startCC||E&&E.cc<u.startCC))}function D(E,y){var u=E.fragments,e=y.fragments;if(e.length&&u.length){var n=R(u,e[0].cc);if(n&&(!n||n.startPTS))return n;T.logger.log("No frag in previous level to align on")}else T.logger.log("No fragments to align")}function o(E,y){if(E){var u=E.start+y;E.start=E.startPTS=u,E.endPTS=u+E.duration}}function A(E,y){for(var u=y.fragments,e=0,n=u.length;e<n;e++)o(u[e],E);y.fragmentHint&&o(y.fragmentHint,E),y.alignedSliding=!0}function m(E,y,u){y&&(function(e,n,t){if(x(e,t,n)){var s=D(t.details,n);s&&Object(_.isFiniteNumber)(s.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+n.url),A(s.start,n))}}(E,u,y),!u.alignedSliding&&y.details&&f(u,y.details),u.alignedSliding||!y.details||u.skippedSegments||Object(L.adjustSliding)(y.details,u))}function f(E,y){if(y.fragments.length&&E.hasProgramDateTime&&y.hasProgramDateTime){var u=y.fragments[0].programDateTime,e=E.fragments[0].programDateTime,n=(e-u)/1e3+y.fragments[0].start;n&&Object(_.isFiniteNumber)(n)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(e-u)+"ms, sliding:"+n.toFixed(3)+" "+E.url+" "),A(n,E))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(N,w,h){h.r(w);var _=h("./src/utils/ewma.ts"),T=function(){function L(x,D,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _.default(x),this.fast_=new _.default(D)}var R=L.prototype;return R.update=function(x,D){var o=this.slow_,A=this.fast_;this.slow_.halfLife!==x&&(this.slow_=new _.default(x,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new _.default(D,A.getEstimate(),A.getTotalWeight()))},R.sample=function(x,D){var o=(x=Math.max(x,this.minDelayMs_))/1e3,A=8*D/o;this.fast_.sample(o,A),this.slow_.sample(o,A)},R.canEstimate=function(){var x=this.fast_;return x&&x.getTotalWeight()>=this.minWeight_},R.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function(){},L}();w.default=T},"./src/utils/ewma.ts":function(N,w,h){h.r(w);var _=function(){function T(R,x,D){x===void 0&&(x=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=x,this.totalWeight_=D}var L=T.prototype;return L.sample=function(R,x){var D=Math.pow(this.alpha_,R);this.estimate_=x*(1-D)+D*this.estimate_,this.totalWeight_+=R},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},T}();w.default=_},"./src/utils/fetch-loader.ts":function(N,w,h){h.r(w),h.d(w,"fetchSupported",function(){return m});var _=h("./src/polyfills/number.ts"),T=h("./src/loader/load-stats.ts"),L=h("./src/demux/chunk-cache.ts");function R(u){var e=typeof Map=="function"?new Map:void 0;return(R=function(n){if(n===null||(t=n,Function.toString.call(t).indexOf("[native code]")===-1))return n;var t;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,s)}function s(){return x(n,arguments,A(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),o(s,n)})(u)}function x(u,e,n){return(x=D()?Reflect.construct:function(t,s,d){var a=[null];a.push.apply(a,s);var l=new(Function.bind.apply(t,a));return d&&o(l,d.prototype),l}).apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(u,e){return(o=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(u,e)}function A(u){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(u)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var f=function(){function u(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||E,this.controller=new self.AbortController,this.stats=new T.LoadStats}var e=u.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var n=this.response;n&&n.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(n,t,s){var d=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var l=function(r,i){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:i};return r.rangeEnd&&(c.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),c}(n,this.controller.signal),p=s.onProgress,v=n.responseType==="arraybuffer",g=v?"byteLength":"length";this.context=n,this.config=t,this.callbacks=s,this.request=this.fetchSetup(n,l),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){d.abortInternal(),s.onTimeout(a,n,d.response)},t.timeout),self.fetch(this.request).then(function(r){if(d.response=d.loader=r,!r.ok){var i=r.status,c=r.statusText;throw new y(c||"fetch, bad network response",i,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),p&&Object(_.isFiniteNumber)(t.highWaterMark)?d.loadProgressively(r,a,n,t.highWaterMark,p):v?r.arrayBuffer():r.text()}).then(function(r){var i=d.response;self.clearTimeout(d.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=r[g];var c={url:i.url,data:r};p&&!Object(_.isFiniteNumber)(t.highWaterMark)&&p(a,n,r,i),s.onSuccess(c,a,n,i)}).catch(function(r){if(self.clearTimeout(d.requestTimeout),!a.aborted){var i=r.code||0;s.onError({code:i,text:r.message},n,r.details)}})},e.getCacheAge=function(){var n=null;if(this.response){var t=this.response.headers.get("age");n=t?parseFloat(t):null}return n},e.loadProgressively=function(n,t,s,d,a){d===void 0&&(d=0);var l=new L.default,p=n.body.getReader();return function v(){return p.read().then(function(g){if(g.done)return l.dataLength&&a(t,s,l.flush(),n),Promise.resolve(new ArrayBuffer(0));var r=g.value,i=r.length;return t.loaded+=i,i<d||l.dataLength?(l.push(r),l.dataLength>=d&&a(t,s,l.flush(),n)):a(t,s,r,n),v()}).catch(function(){return Promise.reject()})}()},u}();function E(u,e){return new self.Request(u.url,e)}var y=function(u){var e,n;function t(s,d,a){var l;return(l=u.call(this,s)||this).code=void 0,l.details=void 0,l.code=d,l.details=a,l}return n=u,(e=t).prototype=Object.create(n.prototype),e.prototype.constructor=e,o(e,n),t}(R(Error));w.default=f},"./src/utils/imsc1-ttml-parser.ts":function(N,w,h){h.r(w),h.d(w,"IMSC1_CODEC",function(){return A}),h.d(w,"parseIMSC1",function(){return y});var _=h("./src/utils/mp4-tools.ts"),T=h("./src/utils/vttparser.ts"),L=h("./src/utils/vttcue.ts"),R=h("./src/demux/id3.ts"),x=h("./src/utils/timescale-conversion.ts"),D=h("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&(a[v]=p[v])}return a}).apply(this,arguments)}var A="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,f=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(a,l,p,v,g){var r=Object(_.findBox)(new Uint8Array(a),["mdat"]);if(r.length!==0){var i=r[0],c=Object(R.utf8ArrayToStr)(new Uint8Array(a,i.start,i.end-i.start)),b=Object(x.toTimescaleFromScale)(l,1,p);try{v(function(S,k){var C=new DOMParser().parseFromString(S,"text/xml").getElementsByTagName("tt")[0];if(!C)throw new Error("Invalid ttml");var I={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},O=Object.keys(I).reduce(function(U,G){return U[G]=C.getAttribute("ttp:"+G)||I[G],U},{}),P=C.getAttribute("xml:space")!=="preserve",F=e(u(C,"styling","style")),M=e(u(C,"layout","region")),B=u(C,"body","[begin]");return[].map.call(B,function(U){var G=n(U,P);if(!G||!U.hasAttribute("begin"))return null;var K=d(U.getAttribute("begin"),O),H=d(U.getAttribute("dur"),O),q=d(U.getAttribute("end"),O);if(K===null)throw s(U);if(q===null){if(H===null)throw s(U);q=K+H}var W=new L.default(K-k,q-k,G);W.id=Object(D.generateCueId)(W.startTime,W.endTime,W.text);var Y=M[U.getAttribute("region")],Z=F[U.getAttribute("style")];W.position=10,W.size=80;var ee=function(ne,z){var $="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(ae,ie){var ue=t(z,$,ie)||t(ne,$,ie);return ue&&(ae[ie]=ue),ae},{})}(Y,Z),re=ee.textAlign;if(re){var X=E[re];X&&(W.lineAlign=X),W.align=re}return o(W,ee),W}).filter(function(U){return U!==null})}(c,b))}catch(S){g(S)}}else g(new Error("Could not parse IMSC1 mdat"))}function u(a,l,p){var v=a.getElementsByTagName(l)[0];return v?[].slice.call(v.querySelectorAll(p)):[]}function e(a){return a.reduce(function(l,p){var v=p.getAttribute("xml:id");return v&&(l[v]=p),l},{})}function n(a,l){return[].slice.call(a.childNodes).reduce(function(p,v,g){var r;return v.nodeName==="br"&&g?p+`
`:(r=v.childNodes)!==null&&r!==void 0&&r.length?n(v,l):l?p+v.textContent.trim().replace(/\s+/g," "):p+v.textContent},"")}function t(a,l,p){return a.hasAttributeNS(l,p)?a.getAttributeNS(l,p):null}function s(a){return new Error("Could not parse ttml timestamp "+a)}function d(a,l){if(!a)return null;var p=Object(T.parseTimeStamp)(a);return p===null&&(m.test(a)?p=function(v,g){var r=m.exec(v),i=(0|r[4])+(0|r[5])/g.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/g.frameRate}(a,l):f.test(a)&&(p=function(v,g){var r=f.exec(v),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/g.frameRate;case"t":return i/g.tickRate}return i}(a,l))),p}},"./src/utils/logger.ts":function(N,w,h){h.r(w),h.d(w,"enableLogs",function(){return x}),h.d(w,"logger",function(){return D});var _=function(){},T={trace:_,debug:_,log:_,warn:_,info:_,error:_},L=T;function R(o){var A=self.console[o];return A?A.bind(self.console,"["+o+"] >"):_}function x(o){if(self.console&&o===!0||typeof o=="object"){(function(A){for(var m=arguments.length,f=new Array(m>1?m-1:0),E=1;E<m;E++)f[E-1]=arguments[E];f.forEach(function(y){L[y]=A[y]?A[y].bind(A):R(y)})})(o,"debug","log","info","warn","error");try{L.log()}catch{L=T}}else L=T}var D=T},"./src/utils/mediakeys-helper.ts":function(N,w,h){var _,T;h.r(w),h.d(w,"KeySystems",function(){return _}),h.d(w,"requestMediaKeySystemAccess",function(){return L}),(T=_||(_={})).WIDEVINE="com.widevine.alpha",T.PLAYREADY="com.microsoft.playready";var L=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(N,w,h){function _(){return self.MediaSource||self.WebKitMediaSource}h.r(w),h.d(w,"getMediaSource",function(){return _})},"./src/utils/mp4-tools.ts":function(N,w,h){h.r(w),h.d(w,"bin2str",function(){return x}),h.d(w,"readUint16",function(){return D}),h.d(w,"readUint32",function(){return o}),h.d(w,"writeUint32",function(){return A}),h.d(w,"findBox",function(){return m}),h.d(w,"parseSegmentIndex",function(){return f}),h.d(w,"parseInitSegment",function(){return E}),h.d(w,"getStartDTS",function(){return y}),h.d(w,"getDuration",function(){return u}),h.d(w,"computeRawDurationFromSamples",function(){return e}),h.d(w,"offsetStartDTS",function(){return n}),h.d(w,"segmentValidRange",function(){return t}),h.d(w,"appendUint8Array",function(){return s});var _=h("./src/utils/typed-array.ts"),T=h("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,R=[].push;function x(d){return String.fromCharCode.apply(null,d)}function D(d,a){"data"in d&&(a+=d.start,d=d.data);var l=d[a]<<8|d[a+1];return l<0?65536+l:l}function o(d,a){"data"in d&&(a+=d.start,d=d.data);var l=d[a]<<24|d[a+1]<<16|d[a+2]<<8|d[a+3];return l<0?4294967296+l:l}function A(d,a,l){"data"in d&&(a+=d.start,d=d.data),d[a]=l>>24,d[a+1]=l>>16&255,d[a+2]=l>>8&255,d[a+3]=255&l}function m(d,a){var l,p,v,g=[];if(!a.length)return g;"data"in d?(l=d.data,p=d.start,v=d.end):(p=0,v=(l=d).byteLength);for(var r=p;r<v;){var i=o(l,r),c=i>1?r+i:v;if(x(l.subarray(r+4,r+8))===a[0])if(a.length===1)g.push({data:l,start:r+8,end:c});else{var b=m({data:l,start:r+8,end:c},a.slice(1));b.length&&R.apply(g,b)}r=c}return g}function f(d){var a=m(d,["moov"])[0],l=a?a.end:null,p=m(d,["sidx"]);if(!p||!p[0])return null;var v=[],g=p[0],r=g.data[0],i=r===0?8:16,c=o(g,i);i+=4,i+=r===0?8:16,i+=2;var b=g.end+0,S=D(g,i);i+=2;for(var k=0;k<S;k++){var C=i,I=o(g,C);C+=4;var O=2147483647&I;if((2147483648&I)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var P=o(g,C);C+=4,v.push({referenceSize:O,subsegmentDuration:P,info:{duration:P/c,start:b,end:b+O-1}}),b+=O,i=C+=4}return{earliestPresentationTime:0,timescale:c,version:r,referencesCount:S,references:v,moovEndOffset:l}}function E(d){for(var a=[],l=m(d,["moov","trak"]),p=0;p<l.length;p++){var v=l[p],g=m(v,["tkhd"])[0];if(g){var r=g.data[g.start],i=r===0?12:20,c=o(g,i),b=m(v,["mdia","mdhd"])[0];if(b){var S=o(b,i=(r=b.data[b.start])===0?12:20),k=m(v,["mdia","hdlr"])[0];if(k){var C=x(k.data.subarray(k.start+8,k.start+12)),I={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[C];if(I){var O=m(v,["mdia","minf","stbl","stsd"])[0],P=void 0;O&&(P=x(O.data.subarray(O.start+12,O.start+16))),a[c]={timescale:S,type:I},a[I]={timescale:S,id:c,codec:P}}}}}}return m(d,["moov","mvex","trex"]).forEach(function(F){var M=o(F,4),B=a[M];B&&(B.default={duration:o(F,12),flags:o(F,20)})}),a}function y(d,a){return m(a,["moof","traf"]).reduce(function(l,p){var v=m(p,["tfdt"])[0],g=v.data[v.start],r=m(p,["tfhd"]).reduce(function(i,c){var b=o(c,4),S=d[b];if(S){var k=o(v,4);g===1&&(k*=Math.pow(2,32),k+=o(v,8));var C=k/(S.timescale||9e4);if(isFinite(C)&&(i===null||C<i))return C}return i},null);return r!==null&&isFinite(r)&&(l===null||r<l)?r:l},null)||0}function u(d,a){for(var l=0,p=0,v=0,g=m(d,["moof","traf"]),r=0;r<g.length;r++){var i=g[r],c=m(i,["tfhd"])[0],b=a[o(c,4)];if(b){var S=b.default,k=o(c,0)|(S==null?void 0:S.flags),C=S==null?void 0:S.duration;8&k&&(C=o(c,2&k?12:8));for(var I=b.timescale||9e4,O=m(i,["trun"]),P=0;P<O.length;P++)l=C?C*o(O[P],4):e(O[P]),b.type===T.ElementaryStreamTypes.VIDEO?p+=l/I:b.type===T.ElementaryStreamTypes.AUDIO&&(v+=l/I)}}if(p===0&&v===0){var F=f(d);if(F!=null&&F.references)return F.references.reduce(function(M,B){return M+B.info.duration||0},0)}return p||v}function e(d){var a=o(d,0),l=8;1&a&&(l+=4),4&a&&(l+=4);for(var p=0,v=o(d,4),g=0;g<v;g++)256&a&&(p+=o(d,l),l+=4),512&a&&(l+=4),1024&a&&(l+=4),2048&a&&(l+=4);return p}function n(d,a,l){m(a,["moof","traf"]).forEach(function(p){m(p,["tfhd"]).forEach(function(v){var g=o(v,4),r=d[g];if(r){var i=r.timescale||9e4;m(p,["tfdt"]).forEach(function(c){var b=c.data[c.start],S=o(c,4);if(b===0)A(c,4,S-l*i);else{S*=Math.pow(2,32),S+=o(c,8),S-=l*i,S=Math.max(S,0);var k=Math.floor(S/(L+1)),C=Math.floor(S%(L+1));A(c,4,k),A(c,8,C)}})}})})}function t(d){var a={valid:null,remainder:null},l=m(d,["moof"]);if(!l)return a;if(l.length<2)return a.remainder=d,a;var p=l[l.length-1];return a.valid=Object(_.sliceUint8)(d,0,p.start-8),a.remainder=Object(_.sliceUint8)(d,p.start-8),a}function s(d,a){var l=new Uint8Array(d.length+a.length);return l.set(d),l.set(a,d.length),l}},"./src/utils/output-filter.ts":function(N,w,h){h.r(w),h.d(w,"default",function(){return _});var _=function(){function T(R,x){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=x}var L=T.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(R,x,D){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=x,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[]},T}()},"./src/utils/texttrack-utils.ts":function(N,w,h){h.r(w),h.d(w,"sendAddTrackEvent",function(){return T}),h.d(w,"addCueToTrack",function(){return L}),h.d(w,"clearCurrentCues",function(){return R}),h.d(w,"removeCuesInRange",function(){return x}),h.d(w,"getCuesInRange",function(){return D});var _=h("./src/utils/logger.ts");function T(o,A){var m;try{m=new Event("addtrack")}catch{(m=document.createEvent("Event")).initEvent("addtrack",!1,!1)}m.track=o,A.dispatchEvent(m)}function L(o,A){var m=o.mode;if(m==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(A.id))try{if(o.addCue(A),!o.cues.getCueById(A.id))throw new Error("addCue is failed for: "+A)}catch(E){_.logger.debug("[texttrack-utils]: "+E);var f=new self.TextTrackCue(A.startTime,A.endTime,A.text);f.id=A.id,o.addCue(f)}m==="disabled"&&(o.mode=m)}function R(o){var A=o.mode;if(A==="disabled"&&(o.mode="hidden"),o.cues)for(var m=o.cues.length;m--;)o.removeCue(o.cues[m]);A==="disabled"&&(o.mode=A)}function x(o,A,m){var f=o.mode;if(f==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var E=D(o.cues,A,m),y=0;y<E.length;y++)o.removeCue(E[y]);f==="disabled"&&(o.mode=f)}function D(o,A,m){var f=[],E=function(n,t){if(t<n[0].startTime)return 0;var s=n.length-1;if(t>n[s].endTime)return-1;for(var d=0,a=s;d<=a;){var l=Math.floor((a+d)/2);if(t<n[l].startTime)a=l-1;else{if(!(t>n[l].startTime&&d<s))return l;d=l+1}}return n[d].startTime-t<t-n[a].startTime?d:a}(o,A);if(E>-1)for(var y=E,u=o.length;y<u;y++){var e=o[y];if(e.startTime>=A&&e.endTime<=m)f.push(e);else if(e.startTime>m)return f}return f}},"./src/utils/time-ranges.ts":function(N,w,h){h.r(w),w.default={toString:function(_){for(var T="",L=_.length,R=0;R<L;R++)T+="["+_.start(R).toFixed(3)+","+_.end(R).toFixed(3)+"]";return T}}},"./src/utils/timescale-conversion.ts":function(N,w,h){function _(x,D,o,A){o===void 0&&(o=1),A===void 0&&(A=!1);var m=x*D*o;return A?Math.round(m):m}function T(x,D,o,A){return o===void 0&&(o=1),A===void 0&&(A=!1),_(x,D,1/o,A)}function L(x,D){return D===void 0&&(D=!1),_(x,1e3,1/9e4,D)}function R(x,D){return D===void 0&&(D=1),_(x,9e4,1/D)}h.r(w),h.d(w,"toTimescaleFromBase",function(){return _}),h.d(w,"toTimescaleFromScale",function(){return T}),h.d(w,"toMsFromMpegTsClock",function(){return L}),h.d(w,"toMpegTsClockFromTimescale",function(){return R})},"./src/utils/typed-array.ts":function(N,w,h){function _(T,L,R){return Uint8Array.prototype.slice?T.slice(L,R):new Uint8Array(Array.prototype.slice.call(T,L,R))}h.r(w),h.d(w,"sliceUint8",function(){return _})},"./src/utils/vttcue.ts":function(N,w,h){h.r(w),w.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var _=["","lr","rl"],T=["start","middle","end","left","right"];function L(o,A){if(typeof A!="string"||!Array.isArray(o))return!1;var m=A.toLowerCase();return!!~o.indexOf(m)&&m}function R(o){return L(T,o)}function x(o){for(var A=arguments.length,m=new Array(A>1?A-1:0),f=1;f<A;f++)m[f-1]=arguments[f];for(var E=1;E<arguments.length;E++){var y=arguments[E];for(var u in y)o[u]=y[u]}return o}function D(o,A,m){var f=this,E={enumerable:!0};f.hasBeenReset=!1;var y="",u=!1,e=o,n=A,t=m,s=null,d="",a=!0,l="auto",p="start",v=50,g="middle",r=50,i="middle";Object.defineProperty(f,"id",x({},E,{get:function(){return y},set:function(c){y=""+c}})),Object.defineProperty(f,"pauseOnExit",x({},E,{get:function(){return u},set:function(c){u=!!c}})),Object.defineProperty(f,"startTime",x({},E,{get:function(){return e},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");e=c,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",x({},E,{get:function(){return n},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");n=c,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",x({},E,{get:function(){return t},set:function(c){t=""+c,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",x({},E,{get:function(){return s},set:function(c){s=c,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",x({},E,{get:function(){return d},set:function(c){var b=function(S){return L(_,S)}(c);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");d=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",x({},E,{get:function(){return a},set:function(c){a=!!c,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",x({},E,{get:function(){return l},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");l=c,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",x({},E,{get:function(){return p},set:function(c){var b=R(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");p=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",x({},E,{get:function(){return v},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",x({},E,{get:function(){return g},set:function(c){var b=R(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");g=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",x({},E,{get:function(){return r},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",x({},E,{get:function(){return i},set:function(c){var b=R(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");i=b,this.hasBeenReset=!0}})),f.displayState=void 0}return D.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(N,w,h){h.r(w),h.d(w,"parseTimeStamp",function(){return L}),h.d(w,"fixLineBreaks",function(){return m}),h.d(w,"VTTParser",function(){return f});var _=h("./src/utils/vttcue.ts"),T=function(){function E(){}return E.prototype.decode=function(y,u){if(!y)return"";if(typeof y!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(y))},E}();function L(E){function y(e,n,t,s){return 3600*(0|e)+60*(0|n)+(0|t)+parseFloat(s||0)}var u=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return u?parseFloat(u[2])>59?y(u[2],u[3],0,u[4]):y(u[1],u[2],u[3],u[4]):null}var R=function(){function E(){this.values=Object.create(null)}var y=E.prototype;return y.set=function(u,e){this.get(u)||e===""||(this.values[u]=e)},y.get=function(u,e,n){return n?this.has(u)?this.values[u]:e[n]:this.has(u)?this.values[u]:e},y.has=function(u){return u in this.values},y.alt=function(u,e,n){for(var t=0;t<n.length;++t)if(e===n[t]){this.set(u,e);break}},y.integer=function(u,e){/^-?\d+$/.test(e)&&this.set(u,parseInt(e,10))},y.percent=function(u,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var n=parseFloat(e);if(n>=0&&n<=100)return this.set(u,n),!0}return!1},E}();function x(E,y,u,e){var n=e?E.split(e):[E];for(var t in n)if(typeof n[t]=="string"){var s=n[t].split(u);s.length===2&&y(s[0],s[1])}}var D=new _.default(0,0,""),o=D.align==="middle"?"middle":"center";function A(E,y,u){var e=E;function n(){var s=L(E);if(s===null)throw new Error("Malformed timestamp: "+e);return E=E.replace(/^[^\sa-zA-Z-]+/,""),s}function t(){E=E.replace(/^\s+/,"")}if(t(),y.startTime=n(),t(),E.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);E=E.substr(3),t(),y.endTime=n(),t(),function(s,d){var a=new R;x(s,function(v,g){var r;switch(v){case"region":for(var i=u.length-1;i>=0;i--)if(u[i].id===g){a.set(v,u[i].region);break}break;case"vertical":a.alt(v,g,["rl","lr"]);break;case"line":r=g.split(","),a.integer(v,r[0]),a.percent(v,r[0])&&a.set("snapToLines",!1),a.alt(v,r[0],["auto"]),r.length===2&&a.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=g.split(","),a.percent(v,r[0]),r.length===2&&a.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":a.percent(v,g);break;case"align":a.alt(v,g,["start",o,"end","left","right"])}},/:/,/\s/),d.region=a.get("region",null),d.vertical=a.get("vertical","");var l=a.get("line","auto");l==="auto"&&D.line===-1&&(l=-1),d.line=l,d.lineAlign=a.get("lineAlign","start"),d.snapToLines=a.get("snapToLines",!0),d.size=a.get("size",100),d.align=a.get("align",o);var p=a.get("position","auto");p==="auto"&&D.position===50&&(p=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=p}(E,y)}function m(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var f=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=E.prototype;return y.parse=function(u){var e=this;function n(){var l=e.buffer,p=0;for(l=m(l);p<l.length&&l[p]!=="\r"&&l[p]!==`
`;)++p;var v=l.substr(0,p);return l[p]==="\r"&&++p,l[p]===`
`&&++p,e.buffer=l.substr(p),v}u&&(e.buffer+=e.decoder.decode(u,{stream:!0}));try{var t="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var s=(t=n()).match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var d=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(d?d=!1:t=n(),e.state){case"HEADER":/:/.test(t)?x(t,function(l,p){},/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new _.default(0,0,""),e.state="CUE",t.indexOf("-->")===-1){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{A(t,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=t.indexOf("-->")!==-1;if(!t||a&&(d=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=t;continue;case"BADCUE":t||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){u.onparsingerror&&u.onparsingerror(e)}return u.onflush&&u.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":function(N,w,h){h.r(w),h.d(w,"generateCueId",function(){return m}),h.d(w,"parseWebVTT",function(){return f});var _=h("./src/polyfills/number.ts"),T=h("./src/utils/vttparser.ts"),L=h("./src/demux/id3.ts"),R=h("./src/utils/timescale-conversion.ts"),x=h("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,o=function(E,y,u){return u===void 0&&(u=0),E.substr(u,y.length)===y},A=function(E){for(var y=5381,u=E.length;u;)y=33*y^E.charCodeAt(--u);return(y>>>0).toString()};function m(E,y,u){return A(E.toString())+A(y.toString())+A(u)}function f(E,y,u,e,n,t,s,d){var a,l=new T.VTTParser,p=Object(L.utf8ArrayToStr)(new Uint8Array(E)).trim().replace(D,`
`).split(`
`),v=[],g=Object(R.toMpegTsClockFromTimescale)(y,u),r="00:00.000",i=0,c=0,b=!0,S=!1;l.oncue=function(k){var C=e[n],I=e.ccOffset,O=(i-g)/9e4;if(C!=null&&C.new&&(c!==void 0?I=e.ccOffset=C.start:function(B,U,G){var K=B[U],H=B[K.prevCC];if(!H||!H.new&&K.new)return B.ccOffset=B.presentationOffset=K.start,void(K.new=!1);for(;(q=H)!==null&&q!==void 0&&q.new;){var q;B.ccOffset+=K.start-H.start,K.new=!1,H=B[(K=H).prevCC]}B.presentationOffset=G}(e,n,O)),O&&(I=O-e.presentationOffset),S){var P=k.endTime-k.startTime,F=Object(x.normalizePts)(9e4*(k.startTime+I-c),9e4*t)/9e4;k.startTime=F,k.endTime=F+P}var M=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(M)),k.id||(k.id=m(k.startTime,k.endTime,M)),k.endTime>0&&v.push(k)},l.onparsingerror=function(k){a=k},l.onflush=function(){a?d(a):s(v)},p.forEach(function(k){if(b){if(o(k,"X-TIMESTAMP-MAP=")){b=!1,S=!0,k.substr(16).split(",").forEach(function(C){o(C,"LOCAL:")?r=C.substr(6):o(C,"MPEGTS:")&&(i=parseInt(C.substr(7)))});try{c=function(C){var I=parseInt(C.substr(-3)),O=parseInt(C.substr(-6,2)),P=parseInt(C.substr(-9,2)),F=C.length>9?parseInt(C.substr(0,C.indexOf(":"))):0;if(!(Object(_.isFiniteNumber)(I)&&Object(_.isFiniteNumber)(O)&&Object(_.isFiniteNumber)(P)&&Object(_.isFiniteNumber)(F)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+C);return I+=1e3*O,(I+=6e4*P)+36e5*F}(r)/1e3}catch(C){S=!1,a=C}return}k===""&&(b=!1)}l.parse(k+`
`)}),l.flush()}},"./src/utils/xhr-loader.ts":function(N,w,h){h.r(w);var _=h("./src/utils/logger.ts"),T=h("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,R=function(){function x(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var D=x.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},D.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(o,A,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=A,this.callbacks=m,this.retryDelay=A.retryDelay,this.loadInternal()},D.loadInternal=function(){var o=this.config,A=this.context;if(o){var m=this.loader=new self.XMLHttpRequest,f=this.stats;f.loading.first=0,f.loaded=0;var E=this.xhrSetup;try{if(E)try{E(m,A.url)}catch{m.open("GET",A.url,!0),E(m,A.url)}m.readyState||m.open("GET",A.url,!0)}catch(y){return void this.callbacks.onError({code:m.status,text:y.message},A,m)}A.rangeEnd&&m.setRequestHeader("Range","bytes="+A.rangeStart+"-"+(A.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=A.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),m.send()}},D.readystatechange=function(){var o=this.context,A=this.loader,m=this.stats;if(o&&A){var f=A.readyState,E=this.config;if(!m.aborted&&f>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),f===4){A.onreadystatechange=null,A.onprogress=null;var y=A.status;if(y>=200&&y<300){var u,e;if(m.loading.end=Math.max(self.performance.now(),m.loading.first),e=o.responseType==="arraybuffer"?(u=A.response).byteLength:(u=A.responseText).length,m.loaded=m.total=e,!this.callbacks)return;var n=this.callbacks.onProgress;if(n&&n(m,o,u,A),!this.callbacks)return;var t={url:A.responseURL,data:u};this.callbacks.onSuccess(t,m,o,A)}else m.retry>=E.maxRetry||y>=400&&y<499?(_.logger.error(y+" while loading "+o.url),this.callbacks.onError({code:y,text:A.statusText},o,A)):(_.logger.warn(y+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,E.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),E.timeout)}},D.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(o){var A=this.stats;A.loaded=o.loaded,o.lengthComputable&&(A.total=o.total)},D.getCacheAge=function(){var o=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var A=this.loader.getResponseHeader("age");o=A?parseFloat(A):null}return o},x}();w.default=R}}).default);var Ze=xt(ht.exports);const It={name:"d-icon"},pe=Object.assign(It,{props:{icon:String,size:[Number,String]},setup:function(N){const w=N,h=Oe(()=>({fontSize:/^\d+$/.test(w.size)?w.size+"px":w.size}));return(_,T)=>(Q(),J("i",{class:Ie(["d-icon iconfont",N.icon]),style:we(j(h))},null,6))}});pe.__scopeId="data-v-0c690e66";Pe("data-v-4cb76d59");const wt={class:"d-player-top"},Ct={class:"top-title"},Ot={class:"top-title"};Fe();const Pt={props:{title:{default:""}},setup(N){Date.prototype.format=function(_){let T={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var L in T)new RegExp("("+L+")").test(_)&&(_=_.replace(RegExp.$1,RegExp.$1.length==1?T[L]:("00"+T[L]).substr((""+T[L]).length)));return _};let w=ke("00:00:00");w.value=new Date().format("hh:mm:ss");let h=null;return h=setInterval(()=>{w.value=new Date().format("hh:mm:ss")},1e3),ct(()=>{clearInterval(h)}),(_,T)=>(Q(),J("div",wt,[V("p",Ct,se(N.title||""),1),V("p",Ot,se(j(w)),1)]))},__scopeId:"data-v-4cb76d59"};Pe("data-v-ac2469ec");const Ft={class:"d-status"},Mt={class:"d-flex-center"},Nt={class:"d-flex-center"},Bt=Te("5X\u901F\u64AD\u653E\u4E2D ");Fe();var vt=je({props:["state"],setup:N=>(w,h)=>fe((Q(),J("div",Ft,[fe(V("li",Mt,[te(pe,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(N.state.volume==0?"mute":N.state.volume>.5?"up":"down")},null,8,["icon"]),Te(" "+se(~~(100*N.state.volume))+"% ",1)],512),[[he,N.state.handleType=="volume"]]),fe(V("li",Nt,[te(pe,{size:"12",icon:"icon-play"}),te(pe,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Bt],512),[[he,N.state.handleType=="playbackRate"||N.state.isMultiplesPlay]])],512)),[[he,N.state.handleType||N.state.isMultiplesPlay]])});vt.__scopeId="data-v-ac2469ec",Pe("data-v-385f7870");const Ut=["checked","true-value","false-value"],Gt=V("span",{class:"d-switch_action"},null,-1);Fe();var qe=je({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(N,{emit:w}){const h=N;it(R=>({"014e5dc0":N.width,e4e32852:N.activeColor}));const _=ke(null),T=Oe(()=>h.modelValue===h.trueValue),L=()=>{ft(()=>{const R=_.value.checked;w("update:modelValue",R),w("change",R)})};return(R,x)=>(Q(),J("div",{class:Ie(["d-switch",{"is-checked":j(T)}])},[V("input",{class:"d-switch__input",ref:_,type:"checkbox",checked:j(T),onChange:L,"true-value":N.trueValue,"false-value":N.falseValue},null,40,Ut),Gt],2))}});qe.__scopeId="data-v-385f7870",Pe("data-v-b2384226");const jt={key:0},Kt=V("i",{class:"rotating iconfont icon-loading f50"},null,-1),Vt=[V("i",{class:"rotating iconfont icon-loading f50"},null,-1),V("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Ht=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),Te("\u91CD\u65B0\u64AD\u653E ")],Wt=[V("i",{class:"iconfont icon-replay f24 mr5"},null,-1),Te("\u8BF7\u6C42\u9519\u8BEF ")];Fe();var gt=je({props:{loadType:String,text:{type:String,default:""}},setup(N){const w=N,{proxy:h}=Et(),_=["loadstart","waiting","ended","error","stalled"],T=()=>{h.$parent.play()},L=Oe(()=>{let R="background: rgba(0, 0, 0, .1);z-index:1";return w.loadType=="loadstart"&&(R="background: rgba(0, 0, 0, 1);;z-index:3"),R});return(R,x)=>fe((Q(),J("div",{class:"d-loading",style:we(j(L))},[V("div",null,[N.loadType=="loadstart"?(Q(),J("span",jt,[Kt,V("p",null,se(N.text),1)])):de("",!0),fe(V("span",null,Vt,512),[[he,N.loadType=="waiting"]]),fe(V("span",null,[V("p",{onClick:T,class:"d-flex-x d-pointer"},Ht)],512),[[he,N.loadType=="ended"]]),fe(V("span",null,[V("p",{onClick:T,class:"d-flex-x d-pointer"},Wt)],512),[[he,N.loadType=="error"||N.loadType=="stalled"]])])],4)),[[he,_.includes(N.loadType)]])}});gt.__scopeId="data-v-b2384226";const Ce=function(N,w,h,_=!1){N&&w&&h&&N.addEventListener(w,h,_)},ce=function(N,w,h,_=!1){N&&w&&h&&N.removeEventListener(w,h,_)};Pe("data-v-5a794390");const qt=["onMousedown"];Fe();var Ge=je(rt(tt({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(N,{emit:w}){const h=N;it(e=>({"5242b67b":N.size}));const _=ke(null),T=ke(null),L=Ye({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),R=Oe(()=>{let e=h.modelValue<0?0:h.modelValue>1?1:h.modelValue;return h.vertical?`height:${100*e}%`:`width:${100*e}%`}),x=Oe(()=>{let e=h.preload<0?0:h.preload>1?1:h.preload;return h.vertical?`height:${100*e}%`:`width:${100*e}%`}),D=Oe(()=>{let e=L.hoverPosition<0?0:L.hoverPosition>1?1:L.hoverPosition;return h.vertical?`bottom:${100*e}%`:`left:${100*e}%`}),o=e=>{e.preventDefault()},A=e=>{h.disabled||(e.preventDefault(),L.dragging=!0,f(e),Ce(window,"mousemove",y),Ce(window,"touchmove",y),Ce(window,"mouseup",u),Ce(window,"touchend",u))},m=e=>{if(!h.hover)return;let n=E(e);if(w("onMousemove",e,n),L.hoverPosition=n,h.vertical)return;let t=_.value,s=T.value.clientWidth/2,d=e.clientX-t.getBoundingClientRect().left;d<s?L.hoverTipsLeft=s-d+"px":t.clientWidth-d<s?L.hoverTipsLeft=t.clientWidth-d-s+"px":L.hoverTipsLeft="50%"},f=e=>{let n=E(e);w("update:modelValue",n),w("change",e,n)},E=e=>{let n=_.value,t=0;if(h.vertical){let s=n.clientHeight;t=(n.getBoundingClientRect().bottom-e.clientY)/s}else t=(e.clientX-n.getBoundingClientRect().left)/n.clientWidth;return t<0?0:t>1?1:t},y=e=>{f(e)},u=e=>{L.dragging&&(ce(window,"mousemove",y),ce(window,"touchmove",y),ce(window,"mouseup",u),ce(window,"touchend",u),ce(window,"contextmenu",u),setTimeout(()=>{L.dragging=!1},0))};return(e,n)=>(Q(),J("div",{ref:_,class:Ie(["d-slider",{"is-vertical":h.vertical}]),onMousedown:At(A,["stop"]),onContextmenu:o},[V("div",{class:"d-slider__runway",onMousemove:m},[fe(V("div",{class:"d-slider__cursor",style:we(j(D))},[fe(V("div",{class:"d-slider__tips",ref:T,style:we({left:j(L).hoverTipsLeft})},se(h.hoverText),5),[[he,h.hoverText]])],4),[[he,h.hover]]),V("div",{class:"d-slider__preload",style:we(j(x))},null,4),V("div",{class:"d-slider__bar",style:we(j(R))},null,4)],32)],42,qt))}}));Ge.__scopeId="data-v-5a794390";Pe("data-v-570fa0d1");const Yt={key:0,class:"d-player-dialog"},zt={class:"d-player-dialog-body"},Xt={class:"d-player-dialog-title"},Qt={class:"d-player-hotkey-panel"},Zt={class:"d-player-filter-panel"},Jt={class:"d-player-filter-panel-item"},$t=V("span",null,"\u9971\u548C\u5EA6",-1),er={class:"d-player-filter-panel-item"},tr=V("span",null,"\u4EAE\u5EA6",-1),rr={class:"d-player-filter-panel-item"},ir=V("span",null,"\u5BF9\u6BD4\u5EA6",-1),ar={key:0,class:"d-player-contextmenu"},nr=["dplayerKeyCode"],sr=V("input",{class:"d-player-copyText"},null,-1);Fe();var pt=je({setup(N){const w=Ye({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),h=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],_=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],T=Ye({saturate:.392,brightness:.392,contrast:.392}),L=Oe(()=>({left:w.mouseX+"px",top:w.mouseY+"px"}));dt(T,A=>{let m=document.querySelector("#dPlayerVideo"),f=(2.55*A.saturate).toFixed(2),E=(2.55*A.brightness).toFixed(2),y=(2.55*A.contrast).toFixed(2);m.style.filter=`saturate(${f}) brightness(${E}) contrast(${y})`});const R=()=>{T.saturate=.392,T.brightness=.392,T.contrast=.392},x=A=>{A.key=="Escape"&&o(0)},D=A=>{A.preventDefault(),Ce(window,"keydown",x),Ce(window,"click",o);let m=document.querySelector("#refPlayerWrap"),f=m.clientWidth;m.clientHeight,w.mouseX=A.clientX-m.getBoundingClientRect().left,f-w.mouseX<130&&(w.mouseX=w.mouseX+(f-w.mouseX-130)),w.mouseY=A.clientY-m.getBoundingClientRect().top,w.show=!0},o=A=>{let m=A.path[0].tagName=="LI",f=A.path[0].attributes.dplayerKeyCode&&A.path[0].attributes.dplayerKeyCode.value,E=h.map(y=>y.key);if(m&&E.includes(f))if(w.dialogTitle=A.path[0].innerText,w.dialogType=f,f=="copy"){let y=document.querySelector(".d-player-copyText");y.value=window.location.href,y.select(),document.execCommand("copy"),w.dialogType=""}else f=="version"&&(w.dialogType="");w.show=!1,ce(window,"keydown",x),ce(window,"click",o)};return ut(()=>{let A=document.querySelector("#refPlayerWrap");ce(window,"keydown",x),ce(window,"click",o),ce(A,"contextmenu",D),Ce(A,"contextmenu",D)}),ct(()=>{let A=document.querySelector("#refPlayerWrap");ce(window,"keydown",x),ce(window,"click",o),ce(A,"contextmenu",D)}),(A,m)=>(Q(),J("div",null,[te(et,{name:"d-fade-in"},{default:$e(()=>[j(w).dialogType?(Q(),J("div",Yt,[V("div",zt,[V("h5",Xt,[Te(se(j(w).dialogTitle)+" ",1),V("i",{onClick:m[0]||(m[0]=f=>j(w).dialogType=!1),class:"icon icon-close"},"X")]),fe(V("ul",Qt,[(Q(),J(ze,null,Xe(_,f=>V("li",{class:"d-player-hotkey-panel-item",key:f.key},[V("span",null,se(f.key),1),V("span",null,se(f.label),1)])),64))],512),[[he,j(w).dialogType=="hotkey"]]),fe(V("ul",Zt,[V("li",Jt,[$t,te(Ge,{class:"filter-panel-slider",size:"5px",modelValue:j(T).saturate,"onUpdate:modelValue":m[1]||(m[1]=f=>j(T).saturate=f)},null,8,["modelValue"]),V("span",null,se(Math.round(255*j(T).saturate)),1)]),V("li",er,[tr,te(Ge,{class:"filter-panel-slider",size:"5px",modelValue:j(T).brightness,"onUpdate:modelValue":m[2]||(m[2]=f=>j(T).brightness=f)},null,8,["modelValue"]),V("span",null,se(Math.round(255*j(T).brightness)),1)]),V("li",rr,[ir,te(Ge,{class:"filter-panel-slider",size:"5px",modelValue:j(T).contrast,"onUpdate:modelValue":m[3]||(m[3]=f=>j(T).contrast=f)},null,8,["modelValue"]),V("span",null,se(Math.round(255*j(T).contrast)),1)]),V("span",{onClick:R,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[he,j(w).dialogType=="filter"]])])])):de("",!0)]),_:1}),j(w).show?(Q(),J("div",ar,[V("ul",{class:"d-player-contextmenu-body",style:we(j(L))},[(Q(),J(ze,null,Xe(h,f=>V("li",{dplayerKeyCode:f.key,key:f.key},se(f.label),9,nr)),64))],4),sr])):de("",!0)]))}});pt.__scopeId="data-v-570fa0d1";const Je=N=>{let w=~~(N/3600),h=~~(N%3600/60),_=~~(N%60);return w=w<10?"0"+w:w,h=h<10?"0"+h:h,_=_<10?"0"+_:_,`${w}:${h}:${_}`},We="ontouchstart"in window,lt=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],or={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};Pe("data-v-01791e9e");const lr={class:"d-player-video",id:"dPlayerVideo"},dr=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],ur={class:"d-player-lightoff"},cr={key:1,class:"d-player-state"},fr={class:"d-play-btn"},hr=["onKeyup","onKeydown"],vr={class:"d-control-progress"},gr={class:"d-tool-bar"},pr={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},mr=V("span",{style:{margin:"0 3px"}},"/",-1),yr={class:"total-time"},Er={class:"d-tool-bar"},Tr={key:0,class:"d-tool-item quality-btn"},br={class:"d-tool-item-main"},Sr={class:"speed-main",style:{"text-align":"center"}},Ar=["onClick"],Lr={key:1,class:"d-tool-item speedRate-btn"},kr={class:"d-tool-item-main"},Dr={class:"speed-main"},Rr=["onClick"],_r={key:2,class:"d-tool-item volume-btn"},xr={class:"d-tool-item-main volume-box",style:{width:"52px"}},Ir={class:"volume-text-size"},wr={key:3,class:"d-tool-item setting-btn"},Cr={class:"d-tool-item-main"},Or={class:"speed-main"},Pr=Te(" \u955C\u50CF\u753B\u9762 "),Fr=Te(" \u5FAA\u73AF\u64AD\u653E "),Mr=Te(" \u5173\u706F\u6A21\u5F0F "),Nr=V("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Br=V("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Ur=V("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Fe();var Qe=je(rt(tt({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:or,emits:[...lt,"mirrorChange","loopChange","lightOffChange"],setup:function(N,{expose:w,emit:h}){const _=N;it(I=>({"51d4439c":j(E),"77e758a6":I.width,b8a1afc0:I.height}));const T=new Ze({fragLoadingTimeOut:2e3}),L=ke(null),R=ke(null),x=ke(null),D=ke(null),o=Ye(rt(tt({dVideo:null},_),{muted:_.muted,playBtnState:_.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),A=(...I)=>O=>I.reverse().reduce((P,F)=>F(P),O),m=lt.reduce((I,O)=>{var P;return I[`on${P=O,P.charAt(0).toUpperCase()+P.slice(1)}`]=F=>{o.loadStateType=O,h(O,F)},I},{});m.onCanplay=A(m.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),m.onEnded=A(m.onEnded,()=>{o.playBtnState="replay"}),m.onDurationchange=I=>{h("durationchange",I),_.currentTime!=0&&(o.dVideo.currentTime=_.currentTime),m.onTimeupdate(I)},m.onProgress=I=>{console.log("\u7F13\u51B2\u4E2D..."),h("progress",I);let O=I.target.duration,P=I.target.buffered,F=I.target.buffered.length&&I.target.buffered.end(P-1);o.preloadBar=F/O},m.onTimeupdate=I=>{h("timeupdate",I);let O=I.duration||I.target.duration||0,P=I.currentTime||I.target.currentTime;o.playProgress=P/O,o.currentTime=Je(P),o.totalTime=Je(O)},m.onError=A(m.onError,()=>{o.playBtnState="replay"});let f=Tt();for(let I in f)m[I]=f[I];const E=(y=o.color,`${parseInt("0x"+y.slice(1,3))},${parseInt("0x"+y.slice(3,5))},${parseInt("0x"+y.slice(5,7))}`);var y;const u=ot(500,()=>{o.handleType=""}),e=I=>{I.preventDefault(),I.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",u()},n=I=>{_.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,m.onTimeupdate(o.dVideo),d())},t=I=>{I.preventDefault();let O=I.type;if(I.key=="ArrowRight"){if(d(),O=="keyup"){if(clearTimeout(o.longPressTimeout),!_.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,m.onTimeupdate(o.dVideo))}else if(O=="keydown"){if(!_.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",u()},500)}}},s=()=>{We||D.value.focus()},d=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},a=()=>{o.dVideo.pause(),o.playBtnState="play"},l=I=>{I&&I.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?d():o.playBtnState=="pause"&&a()},p=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},v=(I,O)=>{let P=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=P*O,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},g=(I,O)=>{o.progressCursorTime=Je(o.dVideo.duration*O)},r=ot(2500,()=>{o.isVideoHovering=!1}),i=I=>{o.isVideoHovering=!0,r()},c=I=>{h("mirrorChange",I,o.dVideo)},b=I=>{h("loopChange",I,o.dVideo)},S=I=>{h("lightOffChange",I,o.dVideo)},k=()=>{var I;I=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(O=>{console.log(O,"Video failed to leave Picture-in-Picture mode.")}):I.requestPictureInPicture().catch(O=>{console.log(O,"Video failed to enter Picture-in-Picture mode.")})},C=()=>{o.fullScreen=(I=>{let O=document,P=O.webkitIsFullScreen||O.fullscreen;return P?(document.exitFullscreen||O.webkitExitFullScreen).call(O):(I.requestFullscreen||I.webkitRequestFullScreen).call(I),!P})(L.value)};return dt(()=>_.src,()=>{ft(()=>{o.dVideo.canPlayType(_.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=_.autoPlay:Ze.isSupported()&&(T.detachMedia(),T.attachMedia(o.dVideo),T.on(Ze.Events.MEDIA_ATTACHED,()=>{T.loadSource(_.src),T.on("hlsManifestParsed",(I,O)=>{console.log(O),o.currentLevel=O.level,o.qualityLevels=O.levels||[]})}),T.on("hlsLevelSwitching",(I,O)=>{console.log(O),console.log("LEVEL_SWITCHING")}),T.on("hlsLevelSwitched",(I,O)=>{o.currentLevel=O.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),ut(()=>{o.dVideo=R,s()}),w({play:d,pause:a,togglePlay:l}),(I,O)=>(Q(),J("div",{ref:L,id:"refPlayerWrap",class:Ie(["d-player-wrap",{"web-full-screen":j(o).webFullScreen,"is-lightoff":j(o).lightOff,"d-player-wrap-hover":j(o).playBtnState=="play"||j(o).isVideoHovering}]),onMousemove:i},[V("div",lr,[V("video",bt({ref:R,class:["d-player-video-main",{"video-mirror":j(o).mirror}],id:"dPlayerVideoMain",controls:!(!j(We)||!j(o).speed),"webkit-playsinline":_.playsinline,playsinline:_.playsinline},j(m),{volume:j(o).volume,muted:j(o).muted,loop:j(o).loop,preload:I.preload,width:"100%",height:"100%",src:_.src,poster:_.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,dr)]),te(et,{name:"d-fade-in"},{default:$e(()=>[fe(V("div",ur,null,512),[[he,j(o).lightOff]])]),_:1}),j(o).fullScreen?(Q(),St(Pt,{key:0,title:_.title},null,8,["title"])):de("",!0),j(We)?de("",!0):(Q(),J("div",cr,[te(et,{name:"d-scale-out"},{default:$e(()=>[fe(V("div",fr,[te(pe,{icon:"icon-play",size:40})],512),[[he,j(o).playBtnState=="play"]])]),_:1}),te(vt,{state:j(o)},null,8,["state"])])),j(We)?de("",!0):(Q(),J("input",{key:2,type:"input",readonly:"readonly",ref:D,onDblclick:C,onKeyup:[He(C,["f"]),O[0]||(O[0]=He(P=>j(o).webFullScreen=!1,["esc"])),t],onClick:l,onKeydown:[He(l,["space"]),He(n,["arrow-left"]),He(e,["arrow-up","arrow-down"]),t],class:"d-player-input",maxlength:"0"},null,40,hr)),te(gt,{loadType:j(o).loadStateType},null,8,["loadType"]),te(pt),!j(We)&&j(o).control?(Q(),J("div",{key:3,class:"d-player-control",ref:x},[V("div",vr,[te(Ge,{class:"d-progress-bar",onOnMousemove:g,onChange:v,disabled:!j(o).speed,hoverText:j(o).progressCursorTime,modelValue:j(o).playProgress,"onUpdate:modelValue":O[1]||(O[1]=P=>j(o).playProgress=P),preload:j(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),V("div",{class:"d-control-tool",onClick:s},[V("div",gr,[V("div",{class:"d-tool-item",onClick:l},[te(pe,{size:"24",icon:`icon-${j(o).playBtnState}`},null,8,["icon"])]),_.controlBtns.includes("audioTrack")?(Q(),J("div",pr,[V("span",null,se(j(o).currentTime),1),mr,V("span",yr,se(j(o).totalTime),1)])):de("",!0)]),V("div",Er,[j(o).qualityLevels.length&&_.controlBtns.includes("quality")?(Q(),J("div",Tr,[Te(se(j(o).qualityLevels.length&&(j(o).qualityLevels[j(o).currentLevel]||{}).height)+"P ",1),V("div",br,[V("ul",Sr,[(Q(!0),J(ze,null,Xe(j(o).qualityLevels,(P,F)=>(Q(),J("li",{class:Ie({"speed-active":j(o).currentLevel==F}),onClick:M=>((B,U)=>{T.currentLevel=U,o.currentLevel=U})(0,F),key:P},se(P.height)+"P",11,Ar))),128))])])])):de("",!0),_.controlBtns.includes("speedRate")?(Q(),J("div",Lr,[Te(se(j(o).speedActive=="1.0"?"\u500D\u901F":j(o).speedActive+"x")+" ",1),V("div",kr,[V("ul",Dr,[(Q(!0),J(ze,null,Xe(j(o).speedRate,P=>(Q(),J("li",{class:Ie({"speed-active":j(o).speedActive==P}),onClick:F=>(M=>{o.speedActive=M,o.dVideo.playbackRate=M})(P),key:P},se(P)+"x",11,Rr))),128))])])])):de("",!0),_.controlBtns.includes("volume")?(Q(),J("div",_r,[V("div",xr,[V("div",{class:Ie(["volume-main",{"is-muted":j(o).muted}])},[V("span",Ir,se(j(o).muted?0:~~(100*j(o).volume))+"%",1),te(Ge,{onChange:O[2]||(O[2]=P=>j(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:j(o).volume,"onUpdate:modelValue":O[3]||(O[3]=P=>j(o).volume=P)},null,8,["modelValue"])],2)]),V("span",{onClick:p,style:{display:"flex"}},[te(pe,{size:"20",icon:"icon-volume-"+(j(o).volume==0||j(o).muted?"mute":j(o).volume>.5?"up":"down")},null,8,["icon"])])])):de("",!0),_.controlBtns.includes("setting")?(Q(),J("div",wr,[te(pe,{size:"20",class:"rotateHover",icon:"icon-settings"}),V("div",Cr,[V("ul",Or,[V("li",null,[Pr,te(qe,{onChange:c,modelValue:j(o).mirror,"onUpdate:modelValue":O[4]||(O[4]=P=>j(o).mirror=P)},null,8,["modelValue"])]),V("li",null,[Fr,te(qe,{onChange:b,modelValue:j(o).loop,"onUpdate:modelValue":O[5]||(O[5]=P=>j(o).loop=P)},null,8,["modelValue"])]),V("li",null,[Mr,te(qe,{onChange:S,modelValue:j(o).lightOff,"onUpdate:modelValue":O[6]||(O[6]=P=>j(o).lightOff=P)},null,8,["modelValue"])])])])])):de("",!0),_.controlBtns.includes("pip")?(Q(),J("div",{key:4,class:"d-tool-item pip-btn",onClick:k},[te(pe,{size:"20",icon:"icon-pip"}),Nr])):de("",!0),_.controlBtns.includes("pageFullScreen")?(Q(),J("div",{key:5,class:"d-tool-item pip-btn",onClick:O[7]||(O[7]=P=>j(o).webFullScreen=!j(o).webFullScreen)},[te(pe,{size:"20",icon:"icon-web-screen"}),Br])):de("",!0),_.controlBtns.includes("fullScreen")?(Q(),J("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:C},[Ur,te(pe,{size:"20",icon:"icon-screen"})])):de("",!0)])])],512)):de("",!0)],34))}}));function Gr(N){N.component(Qe.name,Qe)}Qe.__scopeId="data-v-01791e9e",Qe.install=Gr;export{Qe as g};
